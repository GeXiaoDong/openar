!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var a in r)("object"==typeof exports?exports:t)[a]=r[a]}}(this,function(){return function(t){function e(a){if(r[a])return r[a].exports;var i=r[a]={i:a,l:!1,exports:{}};return t[a].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var r={};return e.m=t,e.c=r,e.d=function(t,r,a){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:a})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,r){"use strict";(function(t){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a(r(2)),f=a(r(6));t.ARView=i.default,t.ARDebugger=f.default,e.default={ARView:i.default,ARDebugger:f.default}}).call(e,r(1))},function(t,e){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),i=r(3),f=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.renderer=e,this.renderer.autoClear=!1,this.sceneCamera=r,this.cameraOrientation=null,this.cameraMotion=null,this.prevFrame=null,this.scene=new THREE.Scene,this.loaded=!1,this.camera=new THREE.OrthographicCamera(-1,1,1,-1),this.camera.position.z=1,this.init(),this.initListeners()}return a(t,[{key:"init",value:function(){var t=this;this.video=document.createElement("video"),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then(function(e){t.video.src=window.URL.createObjectURL(e)}),this.videoTexture=new THREE.VideoTexture(this.video),this.videoTexture.minFilter=THREE.LinearFilter,this.videoTexture.magFilter=THREE.LinearFilter;var e=new THREE.SpriteMaterial({map:this.videoTexture});this.screen=new THREE.Sprite(e),this.screen.scale.set(2,2),this.scene.add(this.screen)}},{key:"initListeners",value:function(){window.addEventListener("deviceorientation",this.handleOrientation.bind(this)),window.addEventListener("devicemotion",this.handleMotion.bind(this))}},{key:"handleOrientation",value:function(t){if(null!==this.cameraOrientation){var e=t.alpha-this.cameraOrientation.alpha,r=t.beta-this.cameraOrientation.beta,a=t.gamma-this.cameraOrientation.gamma,i=Math.cos(e)*r+Math.sin(e)*a,f=Math.sin(e)*r+Math.cos(e)*a;this.sceneCamera.rotation.x+=i,this.sceneCamera.rotation.y+=f}this.cameraOrientation=t}},{key:"handleMotion",value:function(t){this.cameraMotion=t}},{key:"update",value:function(){this.renderer.clear(),this.renderer.render(this.scene,this.camera),this.renderer.clearDepth(),this.loaded&&this.processFrame()}},{key:"processFrame",value:function(){var t=renderer.context,e=new Uint8Array(t.drawingBufferWidth*t.drawingBufferHeight*4);t.readPixels(0,0,t.drawingBufferWidth,t.drawingBufferHeight,t.RGBA,t.UNSIGNED_BYTE,e),null!==this.prevFrame&&(this.transform=(0,i.motionEstimation)(this.prevFrame,e,t.drawingBufferWidth,t.drawingBufferHeight)),this.prevFrame=e}}]),t}();e.default=f},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.motionEstimation=void 0;var a=function(t){return t&&t.__esModule?t:{default:t}}(r(4));e.motionEstimation=a.default},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(t){return t&&t.__esModule?t:{default:t}}(r(5));a.default.fast_corners.set_threshold(20),e.default=function(t,e,r,i){var f=new a.default.pyramid_t(3),o=new a.default.pyramid_t(3);f.allocate(r,i,a.default.U8_t|a.default.C1_t),o.allocate(r,i,a.default.U8_t|a.default.C1_t),a.default.imgproc.grayscale(e,r,i,f.data[0],a.default.COLOR_RGBA2GRAY),a.default.imgproc.grayscale(t,r,i,o.data[0],a.default.COLOR_RGBA2GRAY),f.build(f.data[0],!1),o.build(o.data[0],!1);for(var n=[],s=[],c=0;c<r*i;c++)s[c]=new a.default.keypoint_t;for(var u=a.default.fast_corners.detect(o.data[0],s,3),h=[],d=0;d<u;d++)h.push(s[d].x),h.push(s[d].y);var l=[];a.default.optical_flow_lk.track(o,f,h,n,u,15,30,l,.01,1e-4);var _=a.default.motion_estimator.ransac,v=new a.default.motion_model.homography2d,p=new a.default.matrix_t(3,3,a.default.F32_t|a.default.C1_t);return _(new a.default.ransac_params_t(4,3,.5,.99),v,h,n,u,p,l,1e3),p}},function(t,e){var r=r||{REVISION:"ALPHA"};!function(t){"use strict";var e=256,a=512,i=1024,f=new Int32Array([-1,1,4,-1,4,-1,-1,-1,8,-1,-1,-1,-1,-1,-1,-1,8]),o=function(t){return 65280&t},n=function(t){return 255&t},s=function(t){return f[(65280&t)>>8]},c=function(){return function(t,e){this.size=-8&(t+7|0),void 0===e?this.buffer=new ArrayBuffer(this.size):(this.buffer=e,this.size=e.length),this.u8=new Uint8Array(this.buffer),this.i32=new Int32Array(this.buffer),this.f32=new Float32Array(this.buffer),this.f64=new Float64Array(this.buffer)}}(),u=function(){function t(t,r,f,s){this.type=0|o(f),this.channel=0|n(f),this.cols=0|t,this.rows=0|r,void 0===s?this.allocate():(this.buffer=s,this.data=this.type&e?this.buffer.u8:this.type&a?this.buffer.i32:this.type&i?this.buffer.f32:this.buffer.f64)}return t.prototype.allocate=function(){delete this.data,delete this.buffer,this.buffer=new c(this.cols*s(this.type)*this.channel*this.rows),this.data=this.type&e?this.buffer.u8:this.type&a?this.buffer.i32:this.type&i?this.buffer.f32:this.buffer.f64},t.prototype.copy_to=function(t){for(var e=t.data,r=this.data,a=0,i=this.cols*this.rows*this.channel|0;a<i-4;a+=4)e[a]=r[a],e[a+1]=r[a+1],e[a+2]=r[a+2],e[a+3]=r[a+3];for(;a<i;++a)e[a]=r[a]},t.prototype.resize=function(t,e,r){void 0===r&&(r=this.channel);t*s(this.type)*r*e>this.buffer.size?(this.cols=t,this.rows=e,this.channel=r,this.allocate()):(this.cols=t,this.rows=e,this.channel=r)},t}(),h=function(){function t(t){this.levels=0|t,this.data=new Array(t),this.pyrdown=r.imgproc.pyrdown}return t.prototype.allocate=function(t,e,r){for(var a=this.levels;--a>=0;)this.data[a]=new u(t>>a,e>>a,r)},t.prototype.build=function(t,e){void 0===e&&(e=!0);var r=2,a=t,i=this.data[0];if(!e)for(var f=t.cols*t.rows;--f>=0;)i.data[f]=t.data[f];for(i=this.data[1],this.pyrdown(a,i);r<this.levels;++r)a=i,i=this.data[r],this.pyrdown(a,i)},t}(),d=function(){return function(t,e,r,a,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===i&&(i=-1),this.x=t,this.y=e,this.score=r,this.level=a,this.angle=i}}();t.U8_t=e,t.S32_t=a,t.F32_t=i,t.S64_t=2048,t.F64_t=4096,t.C1_t=1,t.C2_t=2,t.C3_t=3,t.C4_t=4,t.U8C1_t=1|e,t.U8C3_t=3|e,t.U8C4_t=4|e,t.F32C1_t=1|i,t.F32C2_t=2|i,t.S32C1_t=1|a,t.S32C2_t=2|a,t.EPSILON=1.192092896e-7,t.FLT_MIN=1e-37,t.COLOR_RGBA2GRAY=0,t.COLOR_RGB2GRAY=1,t.COLOR_BGRA2GRAY=2,t.COLOR_BGR2GRAY=3,t.BOX_BLUR_NOSCALE=1,t.SVD_U_T=1,t.SVD_V_T=2,t.get_data_type=o,t.get_channel=n,t.get_data_type_size=s,t.data_t=c,t.matrix_t=u,t.pyramid_t=h,t.keypoint_t=d}(r),function(t){"use strict";var e=function(){var t,e,a=function(){function t(t){this.next=null,this.data=new r.data_t(t),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64}return t.prototype.resize=function(t){delete this.data,this.data=new r.data_t(t),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64},t}(),i=0;return{allocate:function(r,f){t=e=new a(f);for(var o=0;o<r;++o){var n=new a(f);e=e.next=n,i++}},get_buffer:function(e){var r=t;return t=t.next,i--,e>r.size&&r.resize(e),r},put_buffer:function(t){e=e.next=t,i++}}}();t.cache=e,e.allocate(30,2560)}(r),function(t){"use strict";var e=function(){var t=new Int32Array(96);return{get_gaussian_kernel:function(t,e,a,i){var f=0,o=0,n=0,s=0,c=0,u=0,h=r.cache.get_buffer(t<<2),d=h.f32;if(1==(1&t)&&t<=7&&e<=0)switch(t>>1){case 0:d[0]=1,u=1;break;case 1:d[0]=.25,d[1]=.5,d[2]=.25,u=1;break;case 2:d[0]=.0625,d[1]=.25,d[2]=.375,d[3]=.25,d[4]=.0625,u=1;break;case 3:d[0]=.03125,d[1]=.109375,d[2]=.21875,d[3]=.28125,d[4]=.21875,d[5]=.109375,d[6]=.03125,u=1}else for(c=-.5/((s=e>0?e:.3*(.5*(t-1)-1)+.8)*s);f<t;++f)o=f-.5*(t-1),n=Math.exp(c*o*o),d[f]=n,u+=n;if(i&r.U8_t)for(u=256/u,f=0;f<t;++f)a[f]=d[f]*u+.5|0;else for(u=1/u,f=0;f<t;++f)a[f]=d[f]*u;r.cache.put_buffer(h)},perspective_4point_transform:function(t,e,r,a,i,f,o,n,s,c,u,h,d,l,_,v,p){var b=e,m=c,y=o,w=b*m*y,x=_,g=b*x,M=m*g,k=u,z=b*k,A=f,C=r,O=l,R=C*O,E=R*A,L=O*A*k,S=O*y,U=O*k,B=m*y,F=x*m,T=x*A,G=k*A,I=1/(S-U-B+F-T+G),q=b*O,P=C*A,V=y*b,N=x*V,j=C*m,W=R*k,D=C*k*A,H=y*x*m,Y=x*C,Q=-(M-w+z*A-A*g-R*m+E-L+S*m)*I,X=(w-M-q*y+q*k+E-m*P+T*m-L)*I,J=b,K=(-k*g+N+j*y-R*y+W-D+T*k-H)*I,Z=(V*k-N-Y*m+W-D+Y*A+H-S*k)*I,$=C,tt=(-z+V+j-P+U-S-F+T)*I,et=(-g+z+R-j+T-G-S+B)*I,rt=-((M=(m=h)*(g=(b=a)*(x=p)))-(w=b*m*(y=s))+(z=b*(k=d))*(A=n)-A*g-(R=(C=i)*(O=v))*m+(E=R*A)-(L=O*A*k)+(S=O*y)*m)*(I=1/(S-(U=O*k)-(B=m*y)+(F=x*m)-(T=x*A)+(G=k*A))),at=(w-M-(q=b*O)*y+q*k+E-m*(P=C*A)+T*m-L)*I,it=b,ft=(-k*g+(N=x*(V=y*b))+(j=C*m)*y-R*y+(W=R*k)-(D=C*k*A)+T*k-(H=y*x*m))*I,ot=(V*k-N-(Y=x*C)*m+W-D+Y*A+H-S*k)*I,nt=C,st=(-z+V+j-P+U-S-F+T)*I,ct=(-g+z+R-j+T-G-S+B)*I,ut=J*tt;E=$*tt-K;var ht=-K*et+Z*tt,dt=Q-ut;P=Q*et-(z=X*tt);var lt=(w=Q*$)-(M=J*K),_t=(y=Q*Z)-(g=K*X);D=(m=Z-et*$)*(O=1/(y-w*et-g+M*et+z*$-ut*Z));var vt=(G=J*et-X)*O,pt=(V=-X*$+J*Z)*O,bt=t.data;bt[0]=rt*D+at*(E*O)-it*(ht*O),bt[1]=rt*vt+at*(dt*O)-it*(P*O),bt[2]=-rt*pt-at*(lt*O)+it*(_t*O),bt[3]=ft*D+ot*(E*O)-nt*(ht*O),bt[4]=ft*vt+ot*(dt*O)-nt*(P*O),bt[5]=-ft*pt-ot*(lt*O)+nt*(_t*O),bt[6]=st*D+ct*(E*O)-ht*O,bt[7]=st*vt+ct*(dt*O)-P*O,bt[8]=-st*pt-ct*(lt*O)+_t*O},qsort:function(e,r,a,i){var f,o,n,s,c=0,u=0,h=0,d=0,l=0,_=0,v=0,p=0,b=0,m=0,y=0,w=0,x=0,g=0,M=0,k=0,z=0,A=0,C=t;if(!(a-r+1<=1))for(C[0]=r,C[1]=a;c>=0;)for(u=C[c<<1],h=C[1+(c<<1)],c--;;){if((l=h-u+1)<=7){for(v=u+1;v<=h;v++)for(p=v;p>u&&i(e[p],e[p-1]);p--)f=e[p],e[p]=e[p-1],e[p-1]=f;break}for(A=0,m=u,w=h,g=u+(l>>1),l>40&&(k=u+(b=l>>3),z=u+(b<<1),o=e[M=u],n=e[k],s=e[z],u=i(o,n)?i(n,s)?k:i(o,s)?z:M:i(s,n)?k:i(o,s)?M:z,k=g,z=g+b,o=e[M=g-b],n=e[k],s=e[z],g=i(o,n)?i(n,s)?k:i(o,s)?z:M:i(s,n)?k:i(o,s)?M:z,k=h-b,z=h,o=e[M=h-(b<<1)],n=e[k],s=e[z],h=i(o,n)?i(n,s)?k:i(o,s)?z:M:i(s,n)?k:i(o,s)?M:z),k=g,z=h,o=e[M=u],n=e[k],s=e[z],(g=i(o,n)?i(n,s)?k:i(o,s)?z:M:i(s,n)?k:i(o,s)?M:z)!=m&&(f=e[g],e[g]=e[m],e[m]=f,g=m),u=y=m+1,h=x=w,o=e[g];;){for(;u<=h&&!i(o,e[u]);)i(e[u],o)||(u>y&&(f=e[y],e[y]=e[u],e[u]=f),A=1,y++),u++;for(;u<=h&&!i(e[h],o);)i(o,e[h])||(h<x&&(f=e[x],e[x]=e[h],e[h]=f),A=1,x--),h--;if(u>h)break;f=e[u],e[u]=e[h],e[h]=f,A=1,u++,h--}if(0==A){for(h=w,v=(u=m)+1;v<=h;v++)for(p=v;p>u&&i(e[p],e[p-1]);p--)f=e[p],e[p]=e[p-1],e[p-1]=f;break}for(_=u-(l=Math.min(y-m,u-y))|0,d=0;d<l;++d,++_)f=e[m+d],e[m+d]=e[_],e[_]=f;for(_=w-(l=Math.min(w-x,x-h))+1|0,d=0;d<l;++d,++_)f=e[u+d],e[u+d]=e[_],e[_]=f;if(l=u-y,_=x-h,l>1)_>1?l>_?(C[++c<<1]=m,C[1+(c<<1)]=m+l-1,u=w-_+1,h=w):(C[++c<<1]=w-_+1,C[1+(c<<1)]=w,u=m,h=m+l-1):(u=m,h=m+l-1);else{if(!(_>1))break;u=w-_+1,h=w}}},median:function(t,e,r){for(var a,i=0,f=0,o=0,n=e+r>>1;;){if(r<=e)return t[n];if(r==e+1)return t[e]>t[r]&&(a=t[e],t[e]=t[r],t[r]=a),t[n];for(t[i=e+r>>1]>t[r]&&(a=t[i],t[i]=t[r],t[r]=a),t[e]>t[r]&&(a=t[e],t[e]=t[r],t[r]=a),t[i]>t[e]&&(a=t[i],t[i]=t[e],t[e]=a),f=e+1,a=t[i],t[i]=t[f],t[f]=a,o=r;;){do{++f}while(t[e]>t[f]);do{--o}while(t[o]>t[e]);if(o<f)break;a=t[f],t[f]=t[o],t[o]=a}a=t[e],t[e]=t[o],t[o]=a,o<=n?e=f:o>=n&&(r=o-1)}return 0}}}();t.math=e}(r),function(t){"use strict";var e={identity:function(t,e){void 0===e&&(e=1);for(var r=t.data,a=t.rows,i=t.cols,f=i+1|0,o=a*i,n=o;--o>=0;)r[o]=0;for(o=n,n=0;n<o;)r[n]=e,n+=f},transpose:function(t,e){for(var r=0,a=0,i=e.rows,f=e.cols,o=0,n=0,s=0,c=e.data,u=t.data;r<i;n+=1,o+=f,r++)for(s=n,a=0;a<f;s+=i,a++)u[s]=c[o+a]},multiply:function(t,e,r){for(var a=0,i=0,f=0,o=0,n=0,s=0,c=0,u=0,h=e.cols,d=e.rows,l=r.cols,_=e.data,v=r.data,p=t.data,b=0;a<d;o+=h,a++)for(c=0,i=0;i<l;u++,c++,i++){for(s=c,n=o,b=0,f=0;f<h;n++,s+=l,f++)b+=_[n]*v[s];p[u]=b}},multiply_ABt:function(t,e,r){for(var a=0,i=0,f=0,o=0,n=0,s=0,c=0,u=e.cols,h=e.rows,d=r.rows,l=e.data,_=r.data,v=t.data,p=0;a<h;o+=u,a++)for(s=0,i=0;i<d;c++,i++){for(n=o,p=0,f=0;f<u;n++,s++,f++)p+=l[n]*_[s];v[c]=p}},multiply_AtB:function(t,e,r){for(var a=0,i=0,f=0,o=0,n=0,s=0,c=0,u=0,h=e.cols,d=e.rows,l=r.cols,_=e.data,v=r.data,p=t.data,b=0;a<h;o++,a++)for(c=0,i=0;i<l;u++,c++,i++){for(s=c,n=o,b=0,f=0;f<d;n+=h,s+=l,f++)b+=_[n]*v[s];p[u]=b}},multiply_AAt:function(t,e){for(var r=0,a=0,i=0,f=0,o=0,n=0,s=0,c=0,u=0,h=e.cols,d=e.rows,l=e.data,_=t.data,v=0;r<d;f+=d+1,o=n,r++)for(c=f,u=f,s=o,a=r;a<d;c++,u+=d,a++){for(n=o,v=0,i=0;i<h;i++)v+=l[n++]*l[s++];_[c]=v,_[u]=v}},multiply_AtA:function(t,e){for(var r=0,a=0,i=0,f=0,o=0,n=0,s=0,c=0,u=0,h=e.cols,d=e.rows,l=e.data,_=t.data,v=0;r<h;s+=h,r++)for(f=r,c=u=s+r,a=r;a<h;c++,u+=h,a++){for(o=f,n=a,v=0,i=0;i<d;o+=h,n+=h,i++)v+=l[o]*l[n];_[c]=v,_[u]=v}},identity_3x3:function(t,e){void 0===e&&(e=1);var r=t.data;r[0]=r[4]=r[8]=e,r[1]=r[2]=r[3]=0,r[5]=r[6]=r[7]=0},invert_3x3:function(t,e){var r=t.data,a=e.data,i=r[4],f=r[8],o=r[5],n=r[7],s=r[0],c=s*i,u=s*o,h=r[3],d=r[1],l=h*d,_=r[2],v=h*_,p=r[6],b=p*d,m=p*_,y=1/(c*f-u*n-l*f+v*n+b*o-m*i);a[0]=(i*f-o*n)*y,a[1]=-(d*f-_*n)*y,a[2]=-(-d*o+_*i)*y,a[3]=-(h*f-o*p)*y,a[4]=(s*f-m)*y,a[5]=-(u-v)*y,a[6]=-(-h*n+i*p)*y,a[7]=-(s*n-b)*y,a[8]=(c-l)*y},multiply_3x3:function(t,e,r){var a=t.data,i=e.data,f=r.data,o=i[0],n=i[1],s=i[2],c=i[3],u=i[4],h=i[5],d=i[6],l=i[7],_=i[8],v=f[0],p=f[1],b=f[2],m=f[3],y=f[4],w=f[5],x=f[6],g=f[7],M=f[8];a[0]=o*v+n*m+s*x,a[1]=o*p+n*y+s*g,a[2]=o*b+n*w+s*M,a[3]=c*v+u*m+h*x,a[4]=c*p+u*y+h*g,a[5]=c*b+u*w+h*M,a[6]=d*v+l*m+_*x,a[7]=d*p+l*y+_*g,a[8]=d*b+l*w+_*M},mat3x3_determinant:function(t){var e=t.data;return e[0]*e[4]*e[8]-e[0]*e[5]*e[7]-e[3]*e[1]*e[8]+e[3]*e[2]*e[7]+e[6]*e[1]*e[5]-e[6]*e[2]*e[4]},determinant_3x3:function(t,e,r,a,i,f,o,n,s){return t*i*s-t*f*n-a*e*s+a*r*n+o*e*f-o*r*i}};r.matmath=e}(),function(t){"use strict";var e=function(){var t=function(t,e,r,a){a=t[e],t[e]=t[r],t[r]=a},e=function(t,e){return t=Math.abs(t),e=Math.abs(e),t>e?(e/=t,t*Math.sqrt(1+e*e)):e>0?(t/=e,e*Math.sqrt(1+t*t)):0};return{lu_solve:function(e,a){var i,f,o,n,s=0,c=0,u=0,h=1,d=e.cols,l=e.data,_=a.data;for(s=0;s<d;s++){for(u=s,c=s+1;c<d;c++)Math.abs(l[c*d+s])>Math.abs(l[u*d+s])&&(u=c);if(Math.abs(l[u*d+s])<r.EPSILON)return 0;if(u!=s){for(c=s;c<d;c++)t(l,s*d+c,u*d+c,i);t(_,s,u,i),h=-h}for(o=-1/l[s*d+s],c=s+1;c<d;c++){for(f=l[c*d+s]*o,u=s+1;u<d;u++)l[c*d+u]+=f*l[s*d+u];_[c]+=f*_[s]}l[s*d+s]=-o}for(s=d-1;s>=0;s--){for(n=_[s],u=s+1;u<d;u++)n-=l[s*d+u]*_[u];_[s]=n*l[s*d+s]}return 1},cholesky_solve:function(t,e){var r,a,i=0,f=0,o=0,n=0,s=0,c=0,u=0,h=t.cols,d=t.data,l=e.data;for(i=0;i<h;i++)for(a=1,s=n=i*h,f=i;f<h;f++){for(r=d[s+i],o=0;o<i;o++)r-=d[o*h+i]*d[s+o];if(f==i){if(d[s+i]=r,0==r)return 0;a=1/r}else d[n+f]=r,d[s+i]=r*a;s+=h}for(n=0,c=0;c<h;c++){for(r=l[c],u=0;u<c;u++)r-=d[n+u]*l[u];l[c]=r,n+=h}for(n=0,c=0;c<h;c++)l[c]/=d[n+c],n+=h;for(c=h-1;c>=0;c--){for(r=l[c],n=(u=c+1)*h;u<h;u++)r-=d[n+c]*l[u],n+=h;l[c]=r}return 1},svd_decompose:function(a,i,f,o,n){void 0===n&&(n=0);var s=0,c=0,u=a.rows,h=a.cols,d=u,l=h,_=a.type|r.C1_t;d<l&&(s=1,c=d,d=l,l=c);var v=r.cache.get_buffer(d*d<<3),p=r.cache.get_buffer(l<<3),b=r.cache.get_buffer(l*l<<3),m=new r.matrix_t(d,d,_,v.data),y=new r.matrix_t(1,l,_,p.data),w=new r.matrix_t(l,l,_,b.data);if(0==s)r.matmath.transpose(m,a);else{for(c=0;c<h*u;c++)m.data[c]=a.data[c];for(;c<l*d;c++)m.data[c]=0}if(function(a,i,f,o,n,s,c,u){for(var h=2*r.EPSILON,d=r.FLT_MIN,l=0,_=0,v=0,p=0,b=Math.max(s,30),m=0,y=0,w=0,x=0,g=0,M=0,k=0,z=0,A=0,C=0,O=0,R=0,E=0,L=0,S=0,U=0,B=0,F=4660,T=0,G=0,I=0,q=r.cache.get_buffer(c<<3),P=q.f64;l<c;l++){for(v=0,O=0;v<s;v++)O+=(z=a[l*i+v])*z;if(P[l]=O,o){for(v=0;v<c;v++)o[l*n+v]=0;o[l*n+l]=1}}for(;p<b;p++){for(g=0,l=0;l<c-1;l++)for(_=l+1;_<c;_++){for(m=l*i|0,y=_*i|0,S=P[l],U=0,B=P[_],v=2,U+=a[m]*a[y],U+=a[m+1]*a[y+1];v<s;v++)U+=a[m+v]*a[y+v];if(!(Math.abs(U)<=h*Math.sqrt(S*B))){for(E=e(U*=2,R=S-B),R<0?(L=.5*(E-R),M=U/(E*(k=Math.sqrt(L/E))*2)):k=U/(E*(M=Math.sqrt((E+R)/(2*E)))*2),S=0,B=0,v=2,A=M*a[m]+k*a[y],C=-k*a[m]+M*a[y],a[m]=A,a[y]=C,S+=A*A,B+=C*C,A=M*a[m+1]+k*a[y+1],C=-k*a[m+1]+M*a[y+1],a[m+1]=A,a[y+1]=C,S+=A*A,B+=C*C;v<s;v++)A=M*a[m+v]+k*a[y+v],C=-k*a[m+v]+M*a[y+v],a[m+v]=A,a[y+v]=C,S+=A*A,B+=C*C;if(P[l]=S,P[_]=B,g=1,o)for(x=_*n|0,v=2,A=M*o[w=l*n|0]+k*o[x],C=-k*o[w]+M*o[x],o[w]=A,o[x]=C,A=M*o[w+1]+k*o[x+1],C=-k*o[w+1]+M*o[x+1],o[w+1]=A,o[x+1]=C;v<c;v++)A=M*o[w+v]+k*o[x+v],C=-k*o[w+v]+M*o[x+v],o[w+v]=A,o[x+v]=C}}if(0==g)break}for(l=0;l<c;l++){for(v=0,O=0;v<s;v++)O+=(z=a[l*i+v])*z;P[l]=Math.sqrt(O)}for(l=0;l<c-1;l++){for(_=l,v=l+1;v<c;v++)P[_]<P[v]&&(_=v);if(l!=_&&(t(P,l,_,O),o)){for(v=0;v<s;v++)t(a,l*i+v,_*i+v,z);for(v=0;v<c;v++)t(o,l*n+v,_*n+v,z)}}for(l=0;l<c;l++)f[l]=P[l];if(o){for(l=0;l<u;l++){for(O=l<c?P[l]:0;O<=d;){for(G=1/s,v=0;v<s;v++)T=0!=(256&(F=214013*F+2531011)>>16)?G:-G,a[l*i+v]=T;for(p=0;p<2;p++)for(_=0;_<l;_++){for(O=0,v=0;v<s;v++)O+=a[l*i+v]*a[_*i+v];for(I=0,v=0;v<s;v++)z=a[l*i+v]-O*a[_*i+v],a[l*i+v]=z,I+=Math.abs(z);for(I=I?1/I:0,v=0;v<s;v++)a[l*i+v]*=I}for(O=0,v=0;v<s;v++)O+=(z=a[l*i+v])*z;O=Math.sqrt(O)}for(k=1/O,v=0;v<s;v++)a[l*i+v]*=k}r.cache.put_buffer(q)}else r.cache.put_buffer(q)}(m.data,d,y.data,w.data,l,d,l,d),i){for(c=0;c<l;c++)i.data[c]=y.data[c];for(;c<h;c++)i.data[c]=0}if(0==s){if(f&&n&r.SVD_U_T)for(c=d*d;--c>=0;)f.data[c]=m.data[c];else f&&r.matmath.transpose(f,m);if(o&&n&r.SVD_V_T)for(c=l*l;--c>=0;)o.data[c]=w.data[c];else o&&r.matmath.transpose(o,w)}else{if(f&&n&r.SVD_U_T)for(c=l*l;--c>=0;)f.data[c]=w.data[c];else f&&r.matmath.transpose(f,w);if(o&&n&r.SVD_V_T)for(c=d*d;--c>=0;)o.data[c]=m.data[c];else o&&r.matmath.transpose(o,m)}r.cache.put_buffer(v),r.cache.put_buffer(p),r.cache.put_buffer(b)},svd_solve:function(t,e,a){var i=0,f=0,o=0,n=0,s=0,c=t.rows,u=t.cols,h=0,d=0,l=0,_=t.type|r.C1_t,v=r.cache.get_buffer(c*c<<3),p=r.cache.get_buffer(u<<3),b=r.cache.get_buffer(u*u<<3),m=new r.matrix_t(c,c,_,v.data),y=new r.matrix_t(1,u,_,p.data),w=new r.matrix_t(u,u,_,b.data),x=a.data,g=m.data,M=y.data,k=w.data;for(this.svd_decompose(t,y,m,w,0),l=r.EPSILON*M[0]*u;i<u;i++,s+=u){for(d=0,f=0;f<u;f++)if(M[f]>l){for(o=0,h=0,n=0;o<c;o++,n+=u)h+=g[n+f]*x[o];d+=h*k[s+f]/M[f]}e.data[i]=d}r.cache.put_buffer(v),r.cache.put_buffer(p),r.cache.put_buffer(b)},svd_invert:function(t,e){var a=0,i=0,f=0,o=0,n=0,s=0,c=e.rows,u=e.cols,h=0,d=0,l=e.type|r.C1_t,_=r.cache.get_buffer(c*c<<3),v=r.cache.get_buffer(u<<3),p=r.cache.get_buffer(u*u<<3),b=new r.matrix_t(c,c,l,_.data),m=new r.matrix_t(1,u,l,v.data),y=new r.matrix_t(u,u,l,p.data),w=t.data,x=b.data,g=m.data,M=y.data;for(this.svd_decompose(e,m,b,y,0),d=r.EPSILON*g[0]*u;a<u;a++,n+=u)for(i=0,o=0;i<c;i++,s++){for(f=0,h=0;f<u;f++,o++)g[f]>d&&(h+=M[n+f]*x[o]/g[f]);w[s]=h}r.cache.put_buffer(_),r.cache.put_buffer(v),r.cache.put_buffer(p)},eigenVV:function(a,i,f){for(var o=a.cols,n=o*o,s=a.type|r.C1_t,c=r.cache.get_buffer(o*o<<3),u=r.cache.get_buffer(o<<3),h=new r.matrix_t(o,o,s,c.data),d=new r.matrix_t(1,o,s,u.data);--n>=0;)h.data[n]=a.data[n];if(function(a,i,f,o,n,s){var c=r.EPSILON,u=0,h=0,d=0,l=0,_=0,v=0,p=0,b=0,m=0,y=s*s*30,w=0,x=0,g=0,M=0,k=0,z=0,A=0,C=0,O=0,R=r.cache.get_buffer(s<<2),E=r.cache.get_buffer(s<<2),L=R.i32,S=E.i32;if(o)for(;u<s;u++){for(d=u*n,h=0;h<s;h++)o[d+h]=0;o[d+u]=1}for(d=0;d<s;d++){if(f[d]=a[(i+1)*d],d<s-1){for(l=d+1,w=Math.abs(a[i*d+l]),u=d+2;u<s;u++)w<(x=Math.abs(a[i*d+u]))&&(w=x,l=u);L[d]=l}if(d>0){for(l=0,w=Math.abs(a[d]),u=1;u<d;u++)w<(x=Math.abs(a[i*u+d]))&&(w=x,l=u);S[d]=l}}if(s>1)for(;m<y;m++){for(d=0,w=Math.abs(a[L[0]]),u=1;u<s-1;u++)w<(x=Math.abs(a[i*u+L[u]]))&&(w=x,d=u);for(_=L[d],u=1;u<s;u++)w<(x=Math.abs(a[i*S[u]+u]))&&(w=x,d=S[u],_=u);if(g=a[i*d+_],Math.abs(g)<=c)break;for(M=.5*(f[_]-f[d]),A=(k=Math.abs(M)+e(g,M))/(z=e(g,k)),z=g/z,k=g/k*g,M<0&&(z=-z,k=-k),a[i*d+_]=0,f[d]-=k,f[_]+=k,u=0;u<d;u++)b=i*u+_,C=a[p=i*u+d],O=a[b],a[p]=C*A-O*z,a[b]=C*z+O*A;for(u=d+1;u<_;u++)b=i*u+_,C=a[p=i*d+u],O=a[b],a[p]=C*A-O*z,a[b]=C*z+O*A;for(p=i*d+(u=_+1),b=i*_+u;u<s;u++,p++,b++)C=a[p],O=a[b],a[p]=C*A-O*z,a[b]=C*z+O*A;if(o)for(p=n*d,b=n*_,u=0;u<s;u++,p++,b++)C=o[p],O=o[b],o[p]=C*A-O*z,o[b]=C*z+O*A;for(h=0;h<2;h++){if((v=0==h?d:_)<s-1){for(l=v+1,w=Math.abs(a[i*v+l]),u=v+2;u<s;u++)w<(x=Math.abs(a[i*v+u]))&&(w=x,l=u);L[v]=l}if(v>0){for(l=0,w=Math.abs(a[v]),u=1;u<v;u++)w<(x=Math.abs(a[i*u+v]))&&(w=x,l=u);S[v]=l}}}for(d=0;d<s-1;d++){for(l=d,u=d+1;u<s;u++)f[l]<f[u]&&(l=u);if(d!=l&&(t(f,l,d,w),o))for(u=0;u<s;u++)t(o,n*l+u,n*d+u,w)}r.cache.put_buffer(R),r.cache.put_buffer(E)}(h.data,o,d.data,i?i.data:null,o,o),f)for(;--o>=0;)f.data[o]=d.data[o];r.cache.put_buffer(c),r.cache.put_buffer(u)}}}();t.linalg=e}(r),function(t){"use strict";var e=function(){var t=function(t){return t*t},e=new r.matrix_t(3,3,r.F32_t|r.C1_t),a=new r.matrix_t(3,3,r.F32_t|r.C1_t),i=new r.matrix_t(6,6,r.F32_t|r.C1_t),f=new r.matrix_t(6,1,r.F32_t|r.C1_t),o=function(){function o(){}return o.prototype.run=function(t,o,n,s){var c,u,h=0,d=0,l=n.type|r.C1_t,_=n.data,v=e.data,p=a.data,b=0,m=0;!function(t,e,r,a,i){for(var f=0,o=0,n=0,s=0,c=0,u=0,h=0,d=0,l=0,_=0,v=0;f<i;++f)o+=t[f].x,n+=t[f].y,u+=e[f].x,h+=e[f].y;for(o/=i,n/=i,u/=i,h/=i,f=0;f<i;++f)_=t[f].x-o,v=t[f].y-n,s+=Math.sqrt(_*_+v*v),_=e[f].x-u,v=e[f].y-h,d+=Math.sqrt(_*_+v*v);s/=i,d/=i,c=Math.SQRT2/s,l=Math.SQRT2/d,r[0]=r[4]=c,r[2]=-o*c,r[5]=-n*c,r[1]=r[3]=r[6]=r[7]=0,r[8]=1,a[0]=a[4]=l,a[2]=-u*l,a[5]=-h*l,a[1]=a[3]=a[6]=a[7]=0,a[8]=1}(t,o,v,p,s);for(var y=r.cache.get_buffer(2*s*6<<3),w=r.cache.get_buffer(2*s<<3),x=new r.matrix_t(6,2*s,l,y.data),g=new r.matrix_t(1,2*s,l,w.data),M=x.data,k=g.data;h<s;++h)c=t[h],u=o[h],b=v[0]*c.x+v[1]*c.y+v[2],m=v[3]*c.x+v[4]*c.y+v[5],M[d=2*h*6]=b,M[d+1]=m,M[d+2]=1,M[d+3]=0,M[d+4]=0,M[d+5]=0,M[d+=6]=0,M[d+1]=0,M[d+2]=0,M[d+3]=b,M[d+4]=m,M[d+5]=1,k[h<<1]=p[0]*u.x+p[1]*u.y+p[2],k[1+(h<<1)]=p[3]*u.x+p[4]*u.y+p[5];return r.matmath.multiply_AtA(i,x),r.matmath.multiply_AtB(f,x,g),r.linalg.lu_solve(i,f),_[0]=f.data[0],_[1]=f.data[1],_[2]=f.data[2],_[3]=f.data[3],_[4]=f.data[4],_[5]=f.data[5],_[6]=0,_[7]=0,_[8]=1,r.matmath.invert_3x3(a,a),r.matmath.multiply_3x3(n,a,n),r.matmath.multiply_3x3(n,n,e),r.cache.put_buffer(y),r.cache.put_buffer(w),1},o.prototype.error=function(e,r,a,i,f){for(var o,n,s=0,c=a.data;s<f;++s)o=e[s],n=r[s],i[s]=t(n.x-c[0]*o.x-c[1]*o.y-c[2])+t(n.y-c[3]*o.x-c[4]*o.y-c[5])},o.prototype.check_subset=function(t,e,r){return!0},o}(),n=new r.matrix_t(9,9,r.F32_t|r.C1_t),s=new r.matrix_t(9,9,r.F32_t|r.C1_t);return{affine2d:o,homography2d:function(){function t(){}return t.prototype.run=function(t,i,f,o){for(var c=0,u=0,h=f.data,d=e.data,l=a.data,_=n.data,v=s.data,p=0,b=0,m=0,y=0,w=0,x=0,g=0,M=0,k=0,z=0,A=0,C=0;c<o;++c)g+=i[c].x,M+=i[c].y,A+=t[c].x,C+=t[c].y;for(g/=o,M/=o,A/=o,C/=o,c=0;c<o;++c)w+=Math.abs(i[c].x-g),x+=Math.abs(i[c].y-M),k+=Math.abs(t[c].x-A),z+=Math.abs(t[c].y-C);if(Math.abs(w)<r.EPSILON||Math.abs(x)<r.EPSILON||Math.abs(k)<r.EPSILON||Math.abs(z)<r.EPSILON)return 0;for(w=o/w,x=o/x,k=o/k,z=o/z,d[0]=k,d[1]=0,d[2]=-A*k,d[3]=0,d[4]=z,d[5]=-C*z,d[6]=0,d[7]=0,d[8]=1,l[0]=1/w,l[1]=0,l[2]=g,l[3]=0,l[4]=1/x,l[5]=M,l[6]=0,l[7]=0,l[8]=1,c=81;--c>=0;)_[c]=0;for(c=0;c<o;++c)p=(i[c].x-g)*w,b=(i[c].y-M)*x,m=(t[c].x-A)*k,y=(t[c].y-C)*z,_[0]+=m*m,_[1]+=m*y,_[2]+=m,_[6]+=m*-p*m,_[7]+=m*-p*y,_[8]+=m*-p,_[10]+=y*y,_[11]+=y,_[15]+=y*-p*m,_[16]+=y*-p*y,_[17]+=y*-p,_[20]+=1,_[24]+=-p*m,_[25]+=-p*y,_[26]+=-p,_[30]+=m*m,_[31]+=m*y,_[32]+=m,_[33]+=m*-b*m,_[34]+=m*-b*y,_[35]+=m*-b,_[40]+=y*y,_[41]+=y,_[42]+=y*-b*m,_[43]+=y*-b*y,_[44]+=y*-b,_[50]+=1,_[51]+=-b*m,_[52]+=-b*y,_[53]+=-b,_[60]+=-p*m*-p*m+-b*m*-b*m,_[61]+=-p*m*-p*y+-b*m*-b*y,_[62]+=-p*m*-p+-b*m*-b,_[70]+=-p*y*-p*y+-b*y*-b*y,_[71]+=-p*y*-p+-b*y*-b,_[80]+=-p*-p+-b*-b;for(c=0;c<9;++c)for(u=0;u<c;++u)_[9*c+u]=_[9*u+c];return r.linalg.eigenVV(n,s),h[0]=v[72],h[1]=v[73],h[2]=v[74],h[3]=v[75],h[4]=v[76],h[5]=v[77],h[6]=v[78],h[7]=v[79],h[8]=v[80],r.matmath.multiply_3x3(f,a,f),r.matmath.multiply_3x3(f,f,e),p=1/h[8],h[0]*=p,h[1]*=p,h[2]*=p,h[3]*=p,h[4]*=p,h[5]*=p,h[6]*=p,h[7]*=p,h[8]=1,1},t.prototype.error=function(t,e,r,a,i){for(var f,o,n=0,s=0,c=0,u=0,h=r.data;n<i;++n)f=t[n],o=e[n],s=1/(h[6]*f.x+h[7]*f.y+1),c=(h[0]*f.x+h[1]*f.y+h[2])*s-o.x,u=(h[3]*f.x+h[4]*f.y+h[5])*s-o.y,a[n]=c*c+u*u},t.prototype.check_subset=function(t,e,a){if(4==a){var i=0,f=t[0],o=t[1],n=t[2],s=t[3],c=e[0],u=e[1],h=e[2],d=e[3],l=f.x,_=f.y,v=o.x,p=o.y,b=n.x,m=n.y,y=c.x,w=c.y,x=u.x,g=u.y,M=h.x,k=h.y,z=r.matmath.determinant_3x3(l,_,1,v,p,1,b,m,1),A=r.matmath.determinant_3x3(y,w,1,x,g,1,M,k,1);if(z*A<0&&i++,l=o.x,_=o.y,v=n.x,p=n.y,b=s.x,m=s.y,y=u.x,w=u.y,x=h.x,g=h.y,M=d.x,k=d.y,z=r.matmath.determinant_3x3(l,_,1,v,p,1,b,m,1),A=r.matmath.determinant_3x3(y,w,1,x,g,1,M,k,1),z*A<0&&i++,l=f.x,_=f.y,v=n.x,p=n.y,b=s.x,m=s.y,y=c.x,w=c.y,x=h.x,g=h.y,M=d.x,k=d.y,z=r.matmath.determinant_3x3(l,_,1,v,p,1,b,m,1),A=r.matmath.determinant_3x3(y,w,1,x,g,1,M,k,1),z*A<0&&i++,l=f.x,_=f.y,v=o.x,p=o.y,b=s.x,m=s.y,y=c.x,w=c.y,x=u.x,g=u.y,M=d.x,k=d.y,z=r.matmath.determinant_3x3(l,_,1,v,p,1,b,m,1),A=r.matmath.determinant_3x3(y,w,1,x,g,1,M,k,1),z*A<0&&i++,0!=i&&4!=i)return!1}return!0},t}()}}(),a=function(){function t(t,e,r,a){void 0===t&&(t=0),void 0===e&&(e=.5),void 0===r&&(r=.5),void 0===a&&(a=.99),this.size=t,this.thresh=e,this.eps=r,this.prob=a}return t.prototype.update_iters=function(t,e){var r=Math.log(1-this.prob),a=Math.log(1-Math.pow(1-t,this.size));return 0|(a>=0||-r>=e*-a?e:Math.round(r/a))},t}(),i=function(){var t=function(t,e,r,a,i,f,o){for(var n=[],s=0,c=0,u=0,h=0,d=!1;u<1e3;++u){for(s=0;s<a&&u<1e3;){for(d=!1,h=0;!d;)for(d=!0,h=n[s]=0|Math.floor(Math.random()*i),c=0;c<s;++c)if(h==n[c]){d=!1;break}f[s]=e[h],o[s]=r[h],t.check_subset(f,o,s+1)?++s:u++}break}return s==a&&u<1e3},e=function(t,e,r,a,i,f,o,n){var s=0,c=0,u=0,h=f*f;for(t.error(r,a,e,o,i);c<i;++c)u=o[c]<=h,n[c]=u,s+=u;return s};return{ransac:function(a,i,f,o,n,s,c,u){if(void 0===u&&(u=1e3),n<a.size)return!1;var h=a.size,d=u,l=0,_=!1,v=[],p=[],b=s.cols,m=s.rows,y=s.type|r.C1_t,w=r.cache.get_buffer(b*m<<3),x=r.cache.get_buffer(n),g=r.cache.get_buffer(n<<2),M=new r.matrix_t(b,m,y,w.data),k=new r.matrix_t(n,1,r.U8C1_t,x.data),z=-1,A=0,C=g.f32;if(n==h){if(i.run(f,o,M,n)<=0)return r.cache.put_buffer(w),r.cache.put_buffer(x),r.cache.put_buffer(g),!1;if(M.copy_to(s),c)for(;--n>=0;)c.data[n]=1;return r.cache.put_buffer(w),r.cache.put_buffer(x),r.cache.put_buffer(g),!0}for(;l<d;++l){if(!t(i,f,o,h,n,v,p)){if(0==l)return r.cache.put_buffer(w),r.cache.put_buffer(x),r.cache.put_buffer(g),!1;break}i.run(v,p,M,h)<=0||(A=e(i,M,f,o,n,a.thresh,C,k.data))>Math.max(z,h-1)&&(M.copy_to(s),z=A,c&&k.copy_to(c),d=a.update_iters((n-A)/n,d),_=!0)}return r.cache.put_buffer(w),r.cache.put_buffer(x),r.cache.put_buffer(g),_},lmeds:function(a,i,f,o,n,s,c,u){if(void 0===u&&(u=1e3),n<a.size)return!1;var h=a.size,d=u,l=0,_=!1,v=[],p=[],b=s.cols,m=s.rows,y=s.type|r.C1_t,w=r.cache.get_buffer(b*m<<3),x=r.cache.get_buffer(n),g=r.cache.get_buffer(n<<2),M=new r.matrix_t(b,m,y,w.data),k=new r.matrix_t(n,1,r.U8_t|r.C1_t,x.data),z=0,A=g.f32,C=1e9,O=0,R=0;if(a.eps=.45,d=a.update_iters(a.eps,d),n==h){if(i.run(f,o,M,n)<=0)return r.cache.put_buffer(w),r.cache.put_buffer(x),r.cache.put_buffer(g),!1;if(M.copy_to(s),c)for(;--n>=0;)c.data[n]=1;return r.cache.put_buffer(w),r.cache.put_buffer(x),r.cache.put_buffer(g),!0}for(;l<d;++l){if(!t(i,f,o,h,n,v,p)){if(0==l)return r.cache.put_buffer(w),r.cache.put_buffer(x),r.cache.put_buffer(g),!1;break}i.run(v,p,M,h)<=0||(i.error(f,o,M,A,n),(R=r.math.median(A,0,n-1))<C&&(C=R,M.copy_to(s),_=!0))}return _&&(O=2.5*1.4826*(1+5/(n-h))*Math.sqrt(C),O=Math.max(O,.001),z=e(i,s,f,o,n,O,A,k.data),c&&k.copy_to(c),_=z>=h),r.cache.put_buffer(w),r.cache.put_buffer(x),r.cache.put_buffer(g),_}}}();t.ransac_params_t=a,t.motion_model=e,t.motion_estimator=i}(r),function(t){"use strict";var e={grayscale:function(t,e,a,i,f){void 0===f&&(f=r.COLOR_RGBA2GRAY);var o=0,n=0,s=0,c=0,u=0,h=0,d=4899,l=1868,_=4;f!=r.COLOR_BGRA2GRAY&&f!=r.COLOR_BGR2GRAY||(d=1868,l=4899),f!=r.COLOR_RGB2GRAY&&f!=r.COLOR_BGR2GRAY||(_=3);var v=_<<1,p=3*_|0;i.resize(e,a,1);var b=i.data;for(n=0;n<a;++n,c+=e,s+=e*_){for(o=0,u=s,h=c;o<=e-4;o+=4,u+=_<<2,h+=4)b[h]=t[u]*d+9617*t[u+1]+t[u+2]*l+8192>>14,b[h+1]=t[u+_]*d+9617*t[u+_+1]+t[u+_+2]*l+8192>>14,b[h+2]=t[u+v]*d+9617*t[u+v+1]+t[u+v+2]*l+8192>>14,b[h+3]=t[u+p]*d+9617*t[u+p+1]+t[u+p+2]*l+8192>>14;for(;o<e;++o,++h,u+=_)b[h]=t[u]*d+9617*t[u+1]+t[u+2]*l+8192>>14}},resample:function(t,e,a,i){var f=t.rows,o=t.cols;f>i&&o>a&&(e.resize(a,i,t.channel),t.type&r.U8_t&&e.type&r.U8_t&&f*o/(i*a)<256?function(t,e,a,i){for(var f=0,o=t.channel,n=t.cols,s=t.rows,c=t.data,u=e.data,h=n/a,d=s/i,l=h*d*65536|0,_=0,v=0,p=0,b=0,m=0,y=0,w=0,x=0,g=0,M=0,k=0,z=0,A=0,C=0,O=0,R=0,E=r.cache.get_buffer(a*o<<2),L=r.cache.get_buffer(a*o<<2),S=r.cache.get_buffer(2*n*3<<2),U=E.i32,B=L.i32,F=S.i32;_<a;_++){for(m=1+(g=_*h)-1e-6|0,y=0|(M=g+h),m=Math.min(m,n-1),y=Math.min(y,n-1),m>g&&(F[x++]=_*o|0,F[x++]=(m-1)*o|0,F[x++]=256*(m-g)|0,f++),p=m;p<y;p++)f++,F[x++]=_*o|0,F[x++]=p*o|0,F[x++]=256;M-y>.001&&(f++,F[x++]=_*o|0,F[x++]=y*o|0,F[x++]=256*(M-y)|0)}for(_=0;_<a*o;_++)U[_]=B[_]=0;for(v=0,b=0;b<s;b++){for(k=n*b,x=0;x<f;x++)for(A=F[3*x],m=F[3*x+1],C=F[3*x+2],w=0;w<o;w++)U[A+w]+=c[k+m+w]*C;if((v+1)*d<=b+1||b==s-1){if(O=256*Math.max(b+1-(v+1)*d,0)|0,R=256-O,z=a*v,O<=0)for(_=0;_<a*o;_++)u[z+_]=Math.min(Math.max((B[_]+256*U[_])/l,0),255),B[_]=U[_]=0;else for(_=0;_<a*o;_++)u[z+_]=Math.min(Math.max((B[_]+U[_]*R)/l,0),255),B[_]=U[_]*O,U[_]=0;v++}else for(_=0;_<a*o;_++)B[_]+=256*U[_],U[_]=0}r.cache.put_buffer(L),r.cache.put_buffer(E),r.cache.put_buffer(S)}(t,e,a,i):function(t,e,a,i){for(var f=0,o=t.channel,n=t.cols,s=t.rows,c=t.data,u=e.data,h=n/a,d=s/i,l=1/(h*d),_=0,v=0,p=0,b=0,m=0,y=0,w=0,x=0,g=0,M=0,k=0,z=0,A=0,C=0,O=0,R=0,E=r.cache.get_buffer(a*o<<2),L=r.cache.get_buffer(a*o<<2),S=r.cache.get_buffer(2*n*3<<2),U=E.f32,B=L.f32,F=S.f32;_<a;_++){for(m=1+(g=_*h)-1e-6|0,y=0|(M=g+h),m=Math.min(m,n-1),y=Math.min(y,n-1),m>g&&(f++,F[x++]=(m-1)*o|0,F[x++]=_*o|0,F[x++]=(m-g)*l),p=m;p<y;p++)f++,F[x++]=p*o|0,F[x++]=_*o|0,F[x++]=l;M-y>.001&&(f++,F[x++]=y*o|0,F[x++]=_*o|0,F[x++]=(M-y)*l)}for(_=0;_<a*o;_++)U[_]=B[_]=0;for(v=0,b=0;b<s;b++){for(k=n*b,x=0;x<f;x++)for(m=0|F[3*x],A=0|F[3*x+1],C=F[3*x+2],w=0;w<o;w++)U[A+w]+=c[k+m+w]*C;if((v+1)*d<=b+1||b==s-1){if(O=Math.max(b+1-(v+1)*d,0),R=1-O,z=a*v,Math.abs(O)<.001)for(_=0;_<a*o;_++)u[z+_]=B[_]+U[_],B[_]=U[_]=0;else for(_=0;_<a*o;_++)u[z+_]=B[_]+U[_]*R,B[_]=U[_]*O,U[_]=0;v++}else for(_=0;_<a*o;_++)B[_]+=U[_],U[_]=0}r.cache.put_buffer(L),r.cache.put_buffer(E),r.cache.put_buffer(S)}(t,e,a,i))},box_blur_gray:function(t,e,a,i){void 0===i&&(i=0);var f=t.cols,o=t.rows,n=o<<1,s=f<<1,c=0,u=0,h=0,d=0,l=1+(a<<1)|0,_=a+1|0,v=_+1|0,p=i&r.BOX_BLUR_NOSCALE?1:1/(l*l),b=r.cache.get_buffer(f*o<<2),m=0,y=0,w=0,x=0,g=0,M=b.i32,k=t.data,z=0;for(e.resize(f,o,t.channel),h=0;h<o;++h){for(y=h,m=_*k[w],c=w+1|0,d=w+a|0;c<=d;++c)m+=k[c];for(x=w+_|0,z=k[g=w],u=0;u<a;++u,y+=o)M[y]=m,m+=k[x]-z,x++;for(;u<f-v;u+=2,y+=n)M[y]=m,m+=k[x]-k[g],M[y+o]=m,m+=k[x+1]-k[g+1],x+=2,g+=2;for(;u<f-_;++u,y+=o)M[y]=m,m+=k[x]-k[g],x++,g++;for(z=k[x-1];u<f;++u,y+=o)M[y]=m,m+=z-k[g],g++;w+=f}if(w=0,k=e.data,1==p)for(h=0;h<f;++h){for(y=h,m=_*M[w],c=w+1|0,d=w+a|0;c<=d;++c)m+=M[c];for(x=w+_,z=M[g=w],u=0;u<a;++u,y+=f)k[y]=m,m+=M[x]-z,x++;for(;u<o-v;u+=2,y+=s)k[y]=m,m+=M[x]-M[g],k[y+f]=m,m+=M[x+1]-M[g+1],x+=2,g+=2;for(;u<o-_;++u,y+=f)k[y]=m,m+=M[x]-M[g],x++,g++;for(z=M[x-1];u<o;++u,y+=f)k[y]=m,m+=z-M[g],g++;w+=o}else for(h=0;h<f;++h){for(y=h,m=_*M[w],c=w+1|0,d=w+a|0;c<=d;++c)m+=M[c];for(x=w+_,z=M[g=w],u=0;u<a;++u,y+=f)k[y]=m*p,m+=M[x]-z,x++;for(;u<o-v;u+=2,y+=s)k[y]=m*p,m+=M[x]-M[g],k[y+f]=m*p,m+=M[x+1]-M[g+1],x+=2,g+=2;for(;u<o-_;++u,y+=f)k[y]=m*p,m+=M[x]-M[g],x++,g++;for(z=M[x-1];u<o;++u,y+=f)k[y]=m*p,m+=z-M[g],g++;w+=o}r.cache.put_buffer(b)},gaussian_blur:function(t,e,a,i){void 0===i&&(i=0),void 0===a&&(a=0);var f=(a=0==a?2*Math.max(1,4*i+1-1e-8)+1|0:a)>>1,o=t.cols,n=t.rows,s=t.type,c=s&r.U8_t;e.resize(o,n,t.channel);var u,h,d=t.data,l=e.data,_=a+Math.max(n,o)|0,v=r.cache.get_buffer(_<<2),p=r.cache.get_buffer(a<<2);c?(u=v.i32,h=p.i32):s&r.S32_t?(u=v.i32,h=p.f32):(u=v.f32,h=p.f32),r.math.get_gaussian_kernel(a,i,h,s),c?function(t,e,r,a,i,f,o,n){for(var s=0,c=0,u=0,h=0,d=0,l=0,_=0,v=0,p=0,b=f[0],m=0,y=a<<1,w=3*a,x=a<<2;s<i;++s){for(l=e[h],c=0;c<n;++c)t[c]=l;for(c=0;c<=a-2;c+=2)t[c+n]=e[h+c],t[c+n+1]=e[h+c+1];for(;c<a;++c)t[c+n]=e[h+c];for(l=e[h+a-1],c=a;c<n+a;++c)t[c+n]=l;for(c=0;c<=a-4;c+=4){for(l=t[c]*b,_=t[c+1]*b,v=t[c+2]*b,p=t[c+3]*b,u=1;u<o;++u)m=f[u],l+=t[u+c]*m,_+=t[u+c+1]*m,v+=t[u+c+2]*m,p+=t[u+c+3]*m;r[d+c]=Math.min(l>>8,255),r[d+c+1]=Math.min(_>>8,255),r[d+c+2]=Math.min(v>>8,255),r[d+c+3]=Math.min(p>>8,255)}for(;c<a;++c){for(l=t[c]*b,u=1;u<o;++u)l+=t[u+c]*f[u];r[d+c]=Math.min(l>>8,255)}h+=a,d+=a}for(s=0;s<a;++s){for(l=r[s],c=0;c<n;++c)t[c]=l;for(u=s,c=0;c<=i-2;c+=2,u+=y)t[c+n]=r[u],t[c+n+1]=r[u+a];for(;c<i;++c,u+=a)t[c+n]=r[u];for(l=r[(i-1)*a+s],c=i;c<n+i;++c)t[c+n]=l;for(d=s,c=0;c<=i-4;c+=4,d+=x){for(l=t[c]*b,_=t[c+1]*b,v=t[c+2]*b,p=t[c+3]*b,u=1;u<o;++u)m=f[u],l+=t[u+c]*m,_+=t[u+c+1]*m,v+=t[u+c+2]*m,p+=t[u+c+3]*m;r[d]=Math.min(l>>8,255),r[d+a]=Math.min(_>>8,255),r[d+y]=Math.min(v>>8,255),r[d+w]=Math.min(p>>8,255)}for(;c<i;++c,d+=a){for(l=t[c]*b,u=1;u<o;++u)l+=t[u+c]*f[u];r[d]=Math.min(l>>8,255)}}}(u,d,l,o,n,h,a,f):function(t,e,r,a,i,f,o,n){for(var s=0,c=0,u=0,h=0,d=0,l=0,_=0,v=0,p=0,b=f[0],m=0,y=a<<1,w=3*a,x=a<<2;s<i;++s){for(l=e[h],c=0;c<n;++c)t[c]=l;for(c=0;c<=a-2;c+=2)t[c+n]=e[h+c],t[c+n+1]=e[h+c+1];for(;c<a;++c)t[c+n]=e[h+c];for(l=e[h+a-1],c=a;c<n+a;++c)t[c+n]=l;for(c=0;c<=a-4;c+=4){for(l=t[c]*b,_=t[c+1]*b,v=t[c+2]*b,p=t[c+3]*b,u=1;u<o;++u)m=f[u],l+=t[u+c]*m,_+=t[u+c+1]*m,v+=t[u+c+2]*m,p+=t[u+c+3]*m;r[d+c]=l,r[d+c+1]=_,r[d+c+2]=v,r[d+c+3]=p}for(;c<a;++c){for(l=t[c]*b,u=1;u<o;++u)l+=t[u+c]*f[u];r[d+c]=l}h+=a,d+=a}for(s=0;s<a;++s){for(l=r[s],c=0;c<n;++c)t[c]=l;for(u=s,c=0;c<=i-2;c+=2,u+=y)t[c+n]=r[u],t[c+n+1]=r[u+a];for(;c<i;++c,u+=a)t[c+n]=r[u];for(l=r[(i-1)*a+s],c=i;c<n+i;++c)t[c+n]=l;for(d=s,c=0;c<=i-4;c+=4,d+=x){for(l=t[c]*b,_=t[c+1]*b,v=t[c+2]*b,p=t[c+3]*b,u=1;u<o;++u)m=f[u],l+=t[u+c]*m,_+=t[u+c+1]*m,v+=t[u+c+2]*m,p+=t[u+c+3]*m;r[d]=l,r[d+a]=_,r[d+y]=v,r[d+w]=p}for(;c<i;++c,d+=a){for(l=t[c]*b,u=1;u<o;++u)l+=t[u+c]*f[u];r[d]=l}}}(u,d,l,o,n,h,a,f),r.cache.put_buffer(v),r.cache.put_buffer(p)},pyrdown:function(t,e,r,a){void 0===r&&(r=0),void 0===a&&(a=0);var i=t.cols,f=i>>1,o=t.rows>>1,n=f-(r<<1),s=o-(a<<1),c=0,u=0,h=r+a*i,d=0,l=0,_=0;e.resize(f,o,t.channel);var v=t.data,p=e.data;for(u=0;u<s;++u){for(d=h,_=l,c=0;c<=n-2;c+=2,_+=2,d+=4)p[_]=v[d]+v[d+1]+v[d+i]+v[d+i+1]+2>>2,p[_+1]=v[d+2]+v[d+3]+v[d+i+2]+v[d+i+3]+2>>2;for(;c<n;++c,++_,d+=2)p[_]=v[d]+v[d+1]+v[d+i]+v[d+i+1]+2>>2;h+=i<<1,l+=f}},scharr_derivatives:function(t,e){var a,i,f,o,n,s,c,u,h=t.cols,d=t.rows,l=h<<1,_=0,v=0,p=0,b=0,m=0,y=0,w=0;e.resize(h,d,2);var x=t.data,g=e.data,M=r.cache.get_buffer(h+2<<2),k=r.cache.get_buffer(h+2<<2);for(t.type&r.U8_t||t.type&r.S32_t?(c=M.i32,u=k.i32):(c=M.f32,u=k.f32);v<d;++v,m+=h){for(b=(v>0?v-1:1)*h|0,y=(v<d-1?v+1:d-2)*h|0,w=v*l|0,_=0,p=1;_<=h-2;_+=2,p+=2)a=x[b+_],i=x[y+_],c[p]=3*(a+i)+10*x[m+_],u[p]=i-a,a=x[b+_+1],i=x[y+_+1],c[p+1]=3*(a+i)+10*x[m+_+1],u[p+1]=i-a;for(;_<h;++_,++p)a=x[b+_],i=x[y+_],c[p]=3*(a+i)+10*x[m+_],u[p]=i-a;for(_=h+1|0,c[0]=c[1],c[_]=c[h],u[0]=u[1],u[_]=u[h],_=0;_<=h-4;_+=4)a=u[_+2],i=u[_+1],f=u[_+3],o=u[_+4],n=c[_+2],s=c[_+3],g[w++]=n-c[_],g[w++]=3*(a+u[_])+10*i,g[w++]=s-c[_+1],g[w++]=3*(f+i)+10*a,g[w++]=c[_+4]-n,g[w++]=3*(o+a)+10*f,g[w++]=c[_+5]-s,g[w++]=3*(u[_+5]+f)+10*o;for(;_<h;++_)g[w++]=c[_+2]-c[_],g[w++]=3*(u[_+2]+u[_])+10*u[_+1]}r.cache.put_buffer(M),r.cache.put_buffer(k)},sobel_derivatives:function(t,e){var a,i,f,o,n,s,c,u,h=t.cols,d=t.rows,l=h<<1,_=0,v=0,p=0,b=0,m=0,y=0,w=0;e.resize(h,d,2);var x=t.data,g=e.data,M=r.cache.get_buffer(h+2<<2),k=r.cache.get_buffer(h+2<<2);for(t.type&r.U8_t||t.type&r.S32_t?(c=M.i32,u=k.i32):(c=M.f32,u=k.f32);v<d;++v,m+=h){for(b=(v>0?v-1:1)*h|0,y=(v<d-1?v+1:d-2)*h|0,w=v*l|0,_=0,p=1;_<=h-2;_+=2,p+=2)a=x[b+_],i=x[y+_],c[p]=a+i+2*x[m+_],u[p]=i-a,a=x[b+_+1],i=x[y+_+1],c[p+1]=a+i+2*x[m+_+1],u[p+1]=i-a;for(;_<h;++_,++p)a=x[b+_],i=x[y+_],c[p]=a+i+2*x[m+_],u[p]=i-a;for(_=h+1|0,c[0]=c[1],c[_]=c[h],u[0]=u[1],u[_]=u[h],_=0;_<=h-4;_+=4)a=u[_+2],i=u[_+1],f=u[_+3],o=u[_+4],n=c[_+2],s=c[_+3],g[w++]=n-c[_],g[w++]=a+u[_]+2*i,g[w++]=s-c[_+1],g[w++]=f+i+2*a,g[w++]=c[_+4]-n,g[w++]=o+a+2*f,g[w++]=c[_+5]-s,g[w++]=u[_+5]+f+2*o;for(;_<h;++_)g[w++]=c[_+2]-c[_],g[w++]=u[_+2]+u[_]+2*u[_+1]}r.cache.put_buffer(M),r.cache.put_buffer(k)},compute_integral_image:function(t,e,r,a){var i=0|t.cols,f=0|t.rows,o=t.data,n=i+1|0,s=0,c=0,u=0,h=0,d=0,l=0,_=0,v=0;if(e&&r){for(;d<n;++d)e[d]=0,r[d]=0;for(u=n+1|0,h=1,d=0,v=0;d<f;++d,++u,++h){for(s=c=0,l=0;l<=i-2;l+=2,v+=2,u+=2,h+=2)s+=_=o[v],c+=_*_,e[u]=e[h]+s,r[u]=r[h]+c,s+=_=o[v+1],c+=_*_,e[u+1]=e[h+1]+s,r[u+1]=r[h+1]+c;for(;l<i;++l,++v,++u,++h)s+=_=o[v],c+=_*_,e[u]=e[h]+s,r[u]=r[h]+c}}else if(e){for(;d<n;++d)e[d]=0;for(u=n+1|0,h=1,d=0,v=0;d<f;++d,++u,++h){for(s=0,l=0;l<=i-2;l+=2,v+=2,u+=2,h+=2)s+=o[v],e[u]=e[h]+s,s+=o[v+1],e[u+1]=e[h+1]+s;for(;l<i;++l,++v,++u,++h)s+=o[v],e[u]=e[h]+s}}else if(r){for(;d<n;++d)r[d]=0;for(u=n+1|0,h=1,d=0,v=0;d<f;++d,++u,++h){for(c=0,l=0;l<=i-2;l+=2,v+=2,u+=2,h+=2)c+=(_=o[v])*_,r[u]=r[h]+c,c+=(_=o[v+1])*_,r[u+1]=r[h+1]+c;for(;l<i;++l,++v,++u,++h)c+=(_=o[v])*_,r[u]=r[h]+c}}if(a){for(d=0;d<n;++d)a[d]=0;for(u=n+1|0,h=0,d=0,v=0;d<f;++d,++u,++h){for(l=0;l<=i-2;l+=2,v+=2,u+=2,h+=2)a[u]=o[v]+a[h],a[u+1]=o[v+1]+a[h+1];for(;l<i;++l,++v,++u,++h)a[u]=o[v]+a[h]}for(u=n+i|0,h=i,d=0;d<f;++d,u+=n,h+=n)a[u]+=a[h];for(l=i-1;l>0;--l)for(h=(u=l+f*n)-n,d=f;d>0;--d,u-=n,h-=n)a[u]+=a[h]+a[h+1]}},equalize_histogram:function(t,e){var a=t.cols,i=t.rows,f=t.data;e.resize(a,i,t.channel);var o,n,s=e.data,c=a*i,u=0,h=0,d=r.cache.get_buffer(1024);for(o=d.i32;u<256;++u)o[u]=0;for(u=0;u<c;++u)++o[f[u]];for(h=o[0],u=1;u<256;++u)h=o[u]+=h;for(n=255/c,u=0;u<c;++u)s[u]=o[f[u]]*n+.5|0;r.cache.put_buffer(d)},canny:function(t,e,a,i){var f=t.cols,o=t.rows;t.data;e.resize(f,o,t.channel);var n=e.data,s=0,c=0,u=0,h=f<<1,d=0,l=0,_=0,v=0,p=0,b=0,m=0,y=0,w=r.cache.get_buffer(o*h<<2),x=r.cache.get_buffer(3*(f+2)<<2),g=r.cache.get_buffer((o+2)*(f+2)<<2),M=r.cache.get_buffer(o*f<<2),k=x.i32,z=g.i32,A=M.i32,C=w.i32,O=new r.matrix_t(f,o,r.S32C2_t,w.data),R=1,E=f+2+1|0,L=2*(f+2)+1|0,S=f+2|0,U=S+1|0,B=0;for(this.sobel_derivatives(t,O),a>i&&(s=a,a=i,i=s),s=3*(f+2)|0;--s>=0;)k[s]=0;for(s=(o+2)*(f+2)|0;--s>=0;)z[s]=0;for(;c<f;++c,u+=2)v=C[u],p=C[u+1],k[E+c]=(v^v>>31)-(v>>31)+((p^p>>31)-(p>>31));for(s=1;s<=o;++s,u+=h){if(s==o)for(c=L+f;--c>=L;)k[c]=0;else for(c=0;c<f;c++)v=C[u+(c<<1)],p=C[u+(c<<1)+1],k[L+c]=(v^v>>31)-(v>>31)+((p^p>>31)-(p>>31));for(d=u-h|0,z[U-1]=0,l=0,c=0;c<f;++c,d+=2){if((_=k[E+c])>a)if(v=C[d],p=C[d+1],b=v^p,v=(v^v>>31)-(v>>31)|0,p=(p^p>>31)-(p>>31)|0,m=13573*v,y=m+(v+v<<15),(p<<=15)<m){if(_>k[E+c-1]&&_>=k[E+c+1]){_>i&&!l&&2!=z[U+c-S]?(z[U+c]=2,l=1,A[B++]=U+c):z[U+c]=1;continue}}else if(p>y){if(_>k[R+c]&&_>=k[L+c]){_>i&&!l&&2!=z[U+c-S]?(z[U+c]=2,l=1,A[B++]=U+c):z[U+c]=1;continue}}else if(b=b<0?-1:1,_>k[R+c-b]&&_>k[L+c+b]){_>i&&!l&&2!=z[U+c-S]?(z[U+c]=2,l=1,A[B++]=U+c):z[U+c]=1;continue}z[U+c]=0,l=0}z[U+f]=0,U+=S,c=R,R=E,E=L,L=c}for(c=U-S-1,s=0;s<S;++s,++c)z[c]=0;for(;B>0;)U=A[--B],1==z[U-=S+1]&&(z[U]=2,A[B++]=U),1==z[U+=1]&&(z[U]=2,A[B++]=U),1==z[U+=1]&&(z[U]=2,A[B++]=U),1==z[U+=S]&&(z[U]=2,A[B++]=U),1==z[U-=2]&&(z[U]=2,A[B++]=U),1==z[U+=S]&&(z[U]=2,A[B++]=U),1==z[U+=1]&&(z[U]=2,A[B++]=U),1==z[U+=1]&&(z[U]=2,A[B++]=U);for(U=S+1,R=0,s=0;s<o;++s,U+=S)for(c=0;c<f;++c)n[R++]=255*(2==z[U+c]);r.cache.put_buffer(w),r.cache.put_buffer(x),r.cache.put_buffer(g),r.cache.put_buffer(M)},warp_perspective:function(t,e,r,a){void 0===a&&(a=0);for(var i=0|t.cols,f=0|t.rows,o=0|e.cols,n=0|e.rows,s=t.data,c=e.data,u=0,h=0,d=0,l=0,_=0,v=0,p=0,b=0,m=0,y=0,w=0,x=0,g=0,M=0,k=0,z=r.data,A=z[0],C=z[1],O=z[2],R=z[3],E=z[4],L=z[5],S=z[6],U=z[7],B=z[8],F=0;h<n;++h)for(b=C*h+O,m=E*h+L,y=U*h+B,u=0;u<o;++u,++F,b+=A,m+=R,y+=S)l=0|(v=b*(w=1/y)),_=0|(p=m*w),v>0&&p>0&&l<i-1&&_<f-1?(x=Math.max(v-l,0),g=Math.max(p-_,0),M=s[d=i*_+l|0]+x*(s[d+1]-s[d]),k=s[d+i]+x*(s[d+i+1]-s[d+i]),c[F]=M+g*(k-M)):c[F]=a},warp_affine:function(t,e,r,a){void 0===a&&(a=0);for(var i=t.cols,f=t.rows,o=e.cols,n=e.rows,s=t.data,c=e.data,u=0,h=0,d=0,l=0,_=0,v=0,p=0,b=0,m=0,y=0,w=0,x=r.data,g=x[0],M=x[1],k=x[2],z=x[3],A=x[4],C=x[5],O=0;h<n;++h)for(v=M*h+k,p=A*h+C,u=0;u<o;++u,++O,v+=g,p+=z)_=0|p,(l=0|v)>=0&&_>=0&&l<i-1&&_<f-1?(b=v-l,m=p-_,y=s[d=i*_+l]+b*(s[d+1]-s[d]),w=s[d+i]+b*(s[d+i+1]-s[d+i]),c[O]=y+m*(w-y)):c[O]=a},skindetector:function(t,e){for(var r,a,i,f,o=t.width*t.height;o--;)f=4*o,r=t.data[f],a=t.data[f+1],i=t.data[f+2],r>95&&a>40&&i>20&&r>a&&r>i&&r-Math.min(a,i)>15&&Math.abs(r-a)>15?e[o]=255:e[o]=0}};r.imgproc=e}(),function(t){"use strict";var e=function(){var t=new Int32Array([0,3,1,3,2,2,3,1,3,0,3,-1,2,-2,1,-3,0,-3,-1,-3,-2,-2,-3,-1,-3,0,-3,1,-2,2,-1,3]),e=new Uint8Array(512),a=new Int32Array(25),i=new Int32Array(25),f=function(t,e,r,a,i){for(var f=0,o=t[e],n=i,s=0,c=0,u=0;f<25;++f)a[f]=o-t[e+r[f]];for(f=0;f<16;f+=2)s=Math.min(a[f+1],a[f+2]),(s=Math.min(s,a[f+3]))<=n||(s=Math.min(s,a[f+4]),s=Math.min(s,a[f+5]),s=Math.min(s,a[f+6]),s=Math.min(s,a[f+7]),s=Math.min(s,a[f+8]),n=Math.max(n,Math.min(s,a[f])),n=Math.max(n,Math.min(s,a[f+9])));for(c=-n,f=0;f<16;f+=2)u=Math.max(a[f+1],a[f+2]),u=Math.max(u,a[f+3]),u=Math.max(u,a[f+4]),(u=Math.max(u,a[f+5]))>=c||(u=Math.max(u,a[f+6]),u=Math.max(u,a[f+7]),u=Math.max(u,a[f+8]),c=Math.min(c,Math.max(u,a[f])),c=Math.min(c,Math.max(u,a[f+9])));return-c-1},o=20;return{set_threshold:function(t){o=Math.min(Math.max(t,0),255);for(var r=-255;r<=255;++r)e[r+255]=r<-o?1:r>o?2:0;return o},detect:function(n,s,c){void 0===c&&(c=3);var u,h=n.data,d=n.cols,l=n.rows,_=0,v=0,p=0,b=0,m=0,y=r.cache.get_buffer(3*d),w=r.cache.get_buffer(3*(d+1)<<2),x=y.u8,g=w.i32,M=a,k=i,z=Math.max(3,c),A=Math.min(l-2,l-c),C=Math.max(3,c),O=Math.min(d-3,d-c),R=0,E=0,L=f,S=e,U=o,B=0,F=0,T=0,G=0,I=0,q=0,P=0,V=0,N=0,j=0,W=0,D=0;!function(e,r,a){for(var i=0,f=t;i<a;++i)e[i]=f[i<<1]+f[1+(i<<1)]*r;for(;i<25;++i)e[i]=e[i-a]}(M,d,16);var H=M[0],Y=M[1],Q=M[2],X=M[3],J=M[4],K=M[5],Z=M[6],$=M[7],tt=M[8],et=M[9],rt=M[10],at=M[11],it=M[12],ft=M[13],ot=M[14],nt=M[15];for(_=0;_<3*d;++_)x[_]=0;for(_=z;_<A;++_){for(P=_*d+C|0,q=(m=(_-3)%3)*d|0,I=m*(d+1)|0,v=0;v<d;++v)x[q+v]=0;if(G=0,_<A-1)for(v=C;v<O;++v,++P)if(B=h[P],F=255-B,0!=(T=S[F+h[P+H]]|S[F+h[P+tt]])&&(T&=S[F+h[P+Q]]|S[F+h[P+rt]],T&=S[F+h[P+J]]|S[F+h[P+it]],0!=(T&=S[F+h[P+Z]]|S[F+h[P+ot]]))){if(T&=S[F+h[P+Y]]|S[F+h[P+et]],T&=S[F+h[P+X]]|S[F+h[P+at]],T&=S[F+h[P+K]]|S[F+h[P+ft]],1&(T&=S[F+h[P+$]]|S[F+h[P+nt]]))for(b=B-U,R=0,p=0;p<25;++p)if(h[P+M[p]]<b){if(++R>8){g[I+ ++G]=v,x[q+v]=L(h,P,M,k,U);break}}else R=0;if(2&T)for(b=B+U,R=0,p=0;p<25;++p)if(h[P+M[p]]>b){if(++R>8){g[I+ ++G]=v,x[q+v]=L(h,P,M,k,U);break}}else R=0}if(g[I+d]=G,_!=z)for(V=(m=(_-4+3)%3)*d|0,I=m*(d+1)|0,N=(m=(_-5+3)%3)*d|0,G=g[I+d],p=0;p<G;++p)j=(v=g[I+p])+1|0,W=v-1|0,(D=x[V+v])>x[V+j]&&D>x[V+W]&&D>x[N+W]&&D>x[N+v]&&D>x[N+j]&&D>x[q+W]&&D>x[q+v]&&D>x[q+j]&&((u=s[E]).x=v,u.y=_-1,u.score=D,E++)}return r.cache.put_buffer(y),r.cache.put_buffer(w),E}}}();t.fast_corners=e,e.set_threshold(20)}(r),function(t){"use strict";var e=function(){var t=function(t,e,r,a,i,f,o){var n=-2*t[e]+t[e+a]+t[e-a],s=-2*t[e]+t[e+i]+t[e-i],c=t[e+f]+t[e-f]-t[e+o]-t[e-o],u=0|Math.sqrt((n-s)*(n-s)+4*c*c);return Math.min(Math.abs(r-u),Math.abs(-(r+u)))};return{laplacian_threshold:30,min_eigen_value_threshold:25,detect:function(e,a,i){void 0===i&&(i=5);var f,o=0,n=0,s=e.cols,c=e.rows,u=e.data,h=5*s|0,d=3+3*s|0,l=3-3*s|0,_=r.cache.get_buffer(s*c<<2),v=_.i32,p=0,b=0,m=0,y=0,w=0,x=this.laplacian_threshold,g=this.min_eigen_value_threshold,M=0|Math.max(5,i),k=0|Math.max(3,i),z=0|Math.min(s-5,s-i),A=0|Math.min(c-3,c-i);for(o=s*c;--o>=0;)v[o]=0;for(function(t,e,r,a,i,f,o,n,s,c){var u=0,h=0,d=n*r+o|0,l=d;for(u=n;u<c;++u,d+=r,l=d)for(h=o;h<s;++h,++l)e[l]=-4*t[l]+t[l+i]+t[l-i]+t[l+f]+t[l-f]}(u,v,s,0,5,h,M,k,z,A),b=k*s+M|0,n=k;n<A;++n,b+=s)for(o=M,m=b;o<z;++o,++m)((p=v[m])<-x&&p<v[m-1]&&p<v[m+1]&&p<v[m-s]&&p<v[m+s]&&p<v[m-s-1]&&p<v[m+s-1]&&p<v[m-s+1]&&p<v[m+s+1]||p>x&&p>v[m-1]&&p>v[m+1]&&p>v[m-s]&&p>v[m+s]&&p>v[m-s-1]&&p>v[m+s-1]&&p>v[m-s+1]&&p>v[m+s+1])&&(y=t(u,m,p,5,h,d,l))>g&&((f=a[w]).x=o,f.y=n,f.score=y,++w,++o,++m);return r.cache.put_buffer(_),w}}}();t.yape06=e}(r),function(t){"use strict";var e=function(){var t=function(t,e,r){var a,i,f=0;for(a=r,i=0;i<a;i++,f++)a=Math.sqrt(r*r-i*i)+.5|0,e[f]=a+t*i;for(a--;a<i&&a>=0;a--,f++)i=Math.sqrt(r*r-a*a)+.5|0,e[f]=a+t*i;for(;-a<i;a--,f++)i=Math.sqrt(r*r-a*a)+.5|0,e[f]=a+t*i;for(i--;i>=0;i--,f++)a=-Math.sqrt(r*r-i*i)-.5|0,e[f]=a+t*i;for(;i>a;i--,f++)a=-Math.sqrt(r*r-i*i)-.5|0,e[f]=a+t*i;for(a++;a<=0;a++,f++)i=-Math.sqrt(r*r-a*a)-.5|0,e[f]=a+t*i;for(;a<-i;a++,f++)i=-Math.sqrt(r*r-a*a)-.5|0,e[f]=a+t*i;for(i++;i<0;i++,f++)a=Math.sqrt(r*r-i*i)+.5|0,e[f]=a+t*i;return e[f]=e[0],e[f+1]=e[1],f},e=function(t,e,r){var a=0;return 0!=t[e+1]&&a++,0!=t[e-1]&&a++,0!=t[e+r]&&a++,0!=t[e+r+1]&&a++,0!=t[e+r-1]&&a++,0!=t[e-r]&&a++,0!=t[e-r+1]&&a++,0!=t[e-r-1]&&a++,a},r=function(t,e,r,a,i){var f,o;if(r>0)for(e-=a*i,o=-i;o<=i;++o){for(f=-i;f<=i;++f)if(t[e+f]>r)return!1;e+=a}else for(e-=a*i,o=-i;o<=i;++o){for(f=-i;f<=i;++f)if(t[e+f]<r)return!1;e+=a}return!0},a=function(t,e,r,a,i,f,o,n){var s=0,c=0,u=o-1|0,h=0,d=0,l=0,_=0,v=0;if((h=t[e+f[c]])<=i)if(h>=a)if((d=t[e+f[u]])<=i){if(d>=a)return void(r[e]=0);if(u++,(l=t[e+f[u]])>i)if(u++,(_=t[e+f[u]])>i)v=3;else{if(!(_<a))return void(r[e]=0);v=6}else if(u++,(_=t[e+f[u]])>i)v=7;else{if(!(_<a))return void(r[e]=0);v=2}}else if(u++,(l=t[e+f[u]])>i)if(u++,(_=t[e+f[u]])>i)v=3;else{if(!(_<a))return void(r[e]=0);v=6}else{if(!(l<a))return void(r[e]=0);if(u++,(_=t[e+f[u]])>i)v=7;else{if(!(_<a))return void(r[e]=0);v=2}}else{if((d=t[e+f[u]])>i)return void(r[e]=0);if(u++,(l=t[e+f[u]])>i)return void(r[e]=0);if(u++,(_=t[e+f[u]])>i)return void(r[e]=0);v=1}else{if((d=t[e+f[u]])<a)return void(r[e]=0);if(u++,(l=t[e+f[u]])<a)return void(r[e]=0);if(u++,(_=t[e+f[u]])<a)return void(r[e]=0);v=0}for(c=1;c<=o;c++)switch(h=t[e+f[c]],v){case 0:if(h>i){if(l=_,u++,(_=t[e+f[u]])<a)return void(r[e]=0);s-=h+l,v=0;break}if(h<a){if(l>i)return void(r[e]=0);if(_>i)return void(r[e]=0);if(l=_,u++,(_=t[e+f[u]])>i)return void(r[e]=0);s-=h+l,v=8;break}if(l<=i)return void(r[e]=0);if(_<=i)return void(r[e]=0);if(l=_,u++,(_=t[e+f[u]])>i){s-=h+l,v=3;break}if(_<a){s-=h+l,v=6;break}return void(r[e]=0);case 1:if(h<a){if(l=_,u++,(_=t[e+f[u]])>i)return void(r[e]=0);s-=h+l,v=1;break}if(h>i){if(l<a)return void(r[e]=0);if(_<a)return void(r[e]=0);if(l=_,u++,(_=t[e+f[u]])<a)return void(r[e]=0);s-=h+l,v=9;break}if(l>=a)return void(r[e]=0);if(_>=a)return void(r[e]=0);if(l=_,u++,(_=t[e+f[u]])<a){s-=h+l,v=2;break}if(_>i){s-=h+l,v=7;break}return void(r[e]=0);case 2:if(h>i)return void(r[e]=0);if(l=_,u++,_=t[e+f[u]],h<a){if(_>i)return void(r[e]=0);s-=h+l,v=4;break}if(_>i){s-=h+l,v=7;break}if(_<a){s-=h+l,v=2;break}return void(r[e]=0);case 3:if(h<a)return void(r[e]=0);if(l=_,u++,_=t[e+f[u]],h>i){if(_<a)return void(r[e]=0);s-=h+l,v=5;break}if(_>i){s-=h+l,v=3;break}if(_<a){s-=h+l,v=6;break}return void(r[e]=0);case 4:if(h>i)return void(r[e]=0);if(h<a){if(l=_,u++,(_=t[e+f[u]])>i)return void(r[e]=0);s-=h+l,v=1;break}if(_>=a)return void(r[e]=0);if(l=_,u++,(_=t[e+f[u]])<a){s-=h+l,v=2;break}if(_>i){s-=h+l,v=7;break}return void(r[e]=0);case 5:if(h<a)return void(r[e]=0);if(h>i){if(l=_,u++,(_=t[e+f[u]])<a)return void(r[e]=0);s-=h+l,v=0;break}if(_<=i)return void(r[e]=0);if(l=_,u++,(_=t[e+f[u]])>i){s-=h+l,v=3;break}if(_<a){s-=h+l,v=6;break}return void(r[e]=0);case 7:if(h>i)return void(r[e]=0);if(h<a)return void(r[e]=0);if(l=_,u++,(_=t[e+f[u]])>i){s-=h+l,v=3;break}if(_<a){s-=h+l,v=6;break}return void(r[e]=0);case 6:if(h>i)return void(r[e]=0);if(h<a)return void(r[e]=0);if(l=_,u++,(_=t[e+f[u]])<a){s-=h+l,v=2;break}if(_>i){s-=h+l,v=7;break}return void(r[e]=0);case 8:if(h>i){if(_<a)return void(r[e]=0);if(l=_,u++,(_=t[e+f[u]])<a)return void(r[e]=0);s-=h+l,v=9;break}if(h<a){if(l=_,u++,(_=t[e+f[u]])>i)return void(r[e]=0);s-=h+l,v=1;break}return void(r[e]=0);case 9:if(h<a){if(_>i)return void(r[e]=0);if(l=_,u++,(_=t[e+f[u]])>i)return void(r[e]=0);s-=h+l,v=8;break}if(h>i){if(l=_,u++,(_=t[e+f[u]])<a)return void(r[e]=0);s-=h+l,v=0;break}return void(r[e]=0)}r[e]=s+n*t[e]},i=function(){return function(e,r,a){this.dirs=new Int32Array(1024),this.dirs_count=0|t(e,this.dirs,a),this.scores=new Int32Array(e*r),this.radius=0|a}}();return{level_tables:[],tau:7,init:function(t,e,r,a){void 0===a&&(a=1);var f;for(r=Math.min(r,7),r=Math.max(r,3),f=0;f<a;++f)this.level_tables[f]=new i(t>>f,e>>f,r)},detect:function(t,i,f){void 0===f&&(f=4);var o,n=this.level_tables[0],s=0|n.radius,c=s-1|0,u=n.dirs,h=0|n.dirs_count,d=h>>1,l=t.data,_=0|t.cols,v=0|t.rows,p=_>>1,b=n.scores,m=0,y=0,w=0,x=0,g=0,M=0,k=0,z=0,A=0|this.tau,C=0,O=0|Math.max(s+1,f),R=0|Math.max(s+1,f),E=0|Math.min(_-s-2,_-f),L=0|Math.min(v-s-2,v-f);for(w=R*_+O|0,y=R;y<L;++y,w+=_)for(m=O,x=w;m<E;++m,++x)g=l[x]+A,(M=l[x]-A)<l[x+s]&&l[x+s]<g&&M<l[x-s]&&l[x-s]<g?b[x]=0:a(l,x,b,M,g,u,d,h);for(w=R*_+O|0,y=R;y<L;++y,w+=_)for(m=O,x=w;m<E;++m,++x)z=b[x],(k=Math.abs(z))<5?(++m,++x):e(b,x,_)>=3&&r(b,x,z,p,s)&&((o=i[C]).x=m,o.y=y,o.score=k,++C,m+=c,x+=c);return C}}}();t.yape=e}(r),function(t){"use strict";var e=function(){var t=new Int32Array([8,-3,9,5,4,2,7,-12,-11,9,-8,2,7,-12,12,-13,2,-13,2,12,1,-7,1,6,-2,-10,-2,-4,-13,-13,-11,-8,-13,-3,-12,-9,10,4,11,9,-13,-8,-8,-9,-11,7,-9,12,7,7,12,6,-4,-5,-3,0,-13,2,-12,-3,-9,0,-7,5,12,-6,12,-1,-3,6,-2,12,-6,-13,-4,-8,11,-13,12,-8,4,7,5,1,5,-3,10,-3,3,-7,6,12,-8,-7,-6,-2,-2,11,-1,-10,-13,12,-8,10,-7,3,-5,-3,-4,2,-3,7,-10,-12,-6,11,5,-12,6,-7,5,-6,7,-1,1,0,4,-5,9,11,11,-13,4,7,4,12,2,-1,4,4,-4,-12,-2,7,-8,-5,-7,-10,4,11,9,12,0,-8,1,-13,-13,-2,-8,2,-3,-2,-2,3,-6,9,-4,-9,8,12,10,7,0,9,1,3,7,-5,11,-10,-13,-6,-11,0,10,7,12,1,-6,-3,-6,12,10,-9,12,-4,-13,8,-8,-12,-13,0,-8,-4,3,3,7,8,5,7,10,-7,-1,7,1,-12,3,-10,5,6,2,-4,3,-10,-13,0,-13,5,-13,-7,-12,12,-13,3,-11,8,-7,12,-4,7,6,-10,12,8,-9,-1,-7,-6,-2,-5,0,12,-12,5,-7,5,3,-10,8,-13,-7,-7,-4,5,-3,-2,-1,-7,2,9,5,-11,-11,-13,-5,-13,-1,6,0,-1,5,-3,5,2,-4,-13,-4,12,-9,-6,-9,6,-12,-10,-8,-4,10,2,12,-3,7,12,12,12,-7,-13,-6,5,-4,9,-3,4,7,-1,12,2,-7,6,-5,1,-13,11,-12,5,-3,7,-2,-6,7,-8,12,-7,-13,-7,-11,-12,1,-3,12,12,2,-6,3,0,-4,3,-2,-13,-1,-13,1,9,7,1,8,-6,1,-1,3,12,9,1,12,6,-1,-9,-1,3,-13,-13,-10,5,7,7,10,12,12,-5,12,9,6,3,7,11,5,-13,6,10,2,-12,2,3,3,8,4,-6,2,6,12,-13,9,-12,10,3,-8,4,-7,9,-11,12,-4,-6,1,12,2,-8,6,-9,7,-4,2,3,3,-2,6,3,11,0,3,-3,8,-8,7,8,9,3,-11,-5,-6,-4,-10,11,-5,10,-5,-8,-3,12,-10,5,-9,0,8,-1,12,-6,4,-6,6,-11,-10,12,-8,7,4,-2,6,7,-2,0,-2,12,-5,-8,-5,2,7,-6,10,12,-9,-13,-8,-8,-5,-13,-5,-2,8,-8,9,-13,-9,-11,-9,0,1,-8,1,-2,7,-4,9,1,-2,1,-1,-4,11,-6,12,-11,-12,-9,-6,4,3,7,7,12,5,5,10,8,0,-4,2,8,-9,12,-5,-13,0,7,2,12,-1,2,1,7,5,11,7,-9,3,5,6,-8,-13,-4,-8,9,-5,9,-3,-3,-4,-7,-3,-12,6,5,8,0,-7,6,-6,12,-13,6,-5,-2,1,-10,3,10,4,1,8,-4,-2,-2,2,-13,2,-12,12,12,-2,-13,0,-6,4,1,9,3,-6,-10,-3,-5,-3,-13,-1,1,7,5,12,-11,4,-2,5,-7,-13,9,-9,-5,7,1,8,6,7,-8,7,6,-7,-4,-7,1,-8,11,-7,-8,-13,6,-12,-8,2,4,3,9,10,-5,12,3,-6,-5,-6,7,8,-3,9,-8,2,-12,2,8,-11,-2,-10,3,-12,-13,-7,-9,-11,0,-10,-5,5,-3,11,8,-2,-13,-1,12,-1,-8,0,9,-13,-11,-12,-5,-10,-2,-10,11,-3,9,-2,-13,2,-3,3,2,-9,-13,-4,0,-4,6,-3,-10,-4,12,-2,-7,-6,-11,-4,9,6,-3,6,11,-13,11,-5,5,11,11,12,6,7,-5,12,-2,-1,12,0,7,-4,-8,-3,-2,-7,1,-6,7,-13,-12,-8,-13,-7,-2,-6,-8,-8,5,-6,-9,-5,-1,-4,5,-13,7,-8,10,1,5,5,-13,1,0,10,-13,9,12,10,-1,5,-8,10,-9,-1,11,1,-13,-9,-3,-6,2,-1,-10,1,12,-13,1,-8,-10,8,-11,10,-6,2,-13,3,-6,7,-13,12,-9,-10,-10,-5,-7,-10,-8,-8,-13,4,-6,8,5,3,12,8,-13,-4,2,-3,-3,5,-13,10,-12,4,-13,5,-1,-9,9,-4,3,0,3,3,-9,-12,1,-6,1,3,2,4,-8,-10,-10,-10,9,8,-13,12,12,-8,-12,-6,-5,2,2,3,7,10,6,11,-8,6,8,8,-12,-7,10,-6,5,-3,-9,-3,9,-1,-13,-1,5,-3,-7,-3,4,-8,-2,-8,3,4,2,12,12,2,-5,3,11,6,-9,11,-13,3,-1,7,12,11,-1,12,4,-3,0,-3,6,4,-11,4,12,2,-4,2,1,-10,-6,-8,1,-13,7,-11,1,-13,12,-11,-13,6,0,11,-13,0,-1,1,4,-13,3,-9,-2,-9,8,-6,-3,-13,-6,-8,-2,5,-9,8,10,2,7,3,-9,-1,-6,-1,-1,9,5,11,-2,11,-3,12,-8,3,0,3,5,-1,4,0,10,3,-6,4,5,-13,0,-10,5,5,8,12,11,8,9,9,-6,7,-4,8,-12,-10,4,-10,9,7,3,12,4,9,-7,10,-2,7,0,12,-2,-1,-6,0,-11]),e=new r.matrix_t(3,3,r.F32_t|r.C1_t),a=new r.matrix_t(32,32,r.U8_t|r.C1_t),i=function(t,a,i,f,o,n){var s=Math.cos(i),c=Math.sin(i);e.data[0]=s,e.data[1]=-c,e.data[2]=(-s+c)*n*.5+f,e.data[3]=c,e.data[4]=s,e.data[5]=(-c-s)*n*.5+o,r.imgproc.warp_affine(t,a,e,128)};return{describe:function(e,f,o,n){var s=0,c=0,u=0,h=0,d=0,l=0,_=0,v=0,p=(e.data,e.cols,e.rows,a.data),b=0;n.type&r.U8_t?n.resize(32,o,1):(n.type=r.U8_t,n.cols=32,n.rows=o,n.channel=1,n.allocate());var m=n.data,y=0;for(s=0;s<o;++s){for(u=f[s].x,h=f[s].y,d=f[s].angle,i(e,a,d,u,h,32),b=0,c=0;c<32;++c)v=(l=p[528+32*t[b+1]+t[b]])<(_=p[528+32*t[(b+=2)+1]+t[b]])|0,v|=((l=p[528+32*t[(b+=2)+1]+t[b]])<(_=p[528+32*t[(b+=2)+1]+t[b]]))<<1,v|=((l=p[528+32*t[(b+=2)+1]+t[b]])<(_=p[528+32*t[(b+=2)+1]+t[b]]))<<2,v|=((l=p[528+32*t[(b+=2)+1]+t[b]])<(_=p[528+32*t[(b+=2)+1]+t[b]]))<<3,v|=((l=p[528+32*t[(b+=2)+1]+t[b]])<(_=p[528+32*t[(b+=2)+1]+t[b]]))<<4,v|=((l=p[528+32*t[(b+=2)+1]+t[b]])<(_=p[528+32*t[(b+=2)+1]+t[b]]))<<5,v|=((l=p[528+32*t[(b+=2)+1]+t[b]])<(_=p[528+32*t[(b+=2)+1]+t[b]]))<<6,l=p[528+32*t[(b+=2)+1]+t[b]],_=p[528+32*t[(b+=2)+1]+t[b]],b+=2,v|=(l<_)<<7,m[y+c]=v;y+=32}}}}();t.orb=e}(r),function(t){"use strict";var e=function(){var t=r.imgproc.scharr_derivatives;return{track:function(e,a,i,f,o,n,s,c,u,h){void 0===s&&(s=30),void 0===c&&(c=new Uint8Array(o)),void 0===u&&(u=.01),void 0===h&&(h=1e-4);var d=.5*(n-1),l=n*n|0,_=l<<1,v=e.data,p=a.data,b=v[0].data,m=p[0].data,y=v[0].cols,w=v[0].rows,x=0,g=0,M=r.cache.get_buffer(l<<2),k=r.cache.get_buffer(_<<2),z=r.cache.get_buffer(w*(y<<1)<<2),A=new r.matrix_t(y,w,r.S32C2_t,z.data),C=M.i32,O=k.i32,R=z.i32,E=0,L=0,S=0,U=0,B=0,F=0,T=0,G=0,I=0,q=0,P=0,V=0,N=0,j=0,W=0,D=0,H=0,Y=0,Q=0,X=0,J=0,K=0,Z=0,$=0,tt=0,et=0,rt=0,at=0,it=0,ft=0,ot=0,nt=0,st=0,ct=0,ut=0,ht=0,dt=0,lt=0,_t=0,vt=0,pt=0,bt=0,mt=0;for(u*=u;X<o;++X)c[X]=1;var yt=e.levels-1|0;for($=yt;$>=0;--$)for(T=1/(1<<$),g=w>>$,E=(x=y>>$)<<1,b=v[$].data,m=p[$].data,rt=x-n|0,at=g-n|0,t(v[$],A),tt=0;tt<o;++tt)if(X=tt<<1,J=X+1,G=i[X]*T,I=i[J]*T,$==yt?(q=G,P=I):(q=2*f[X],P=2*f[J]),f[X]=q,f[J]=P,G-=d,I-=d,D=0|G,H=0|I,0==(K=D<=0|D>=rt|H<=0|H>=at)){for(ht=16384-(st=(1-(it=G-D))*(1-(ft=I-H))*16384+.5|0)-(ct=it*(1-ft)*16384+.5|0)-(ut=(1-it)*ft*16384+.5|0),vt=0,pt=0,bt=0,Z=0;Z<n;++Z)for(S=(L=(Z+H)*x+D|0)<<1,B=(U=Z*n|0)<<1,K=0;K<n;++K,++L,++U,S+=2)dt=(dt=b[L]*st+b[L+1]*ct+b[L+x]*ut+b[L+x+1]*ht)+256>>9,lt=(lt=R[S]*st+R[S+2]*ct+R[S+E]*ut+R[S+E+2]*ht)+8192>>14,_t=(_t=R[S+1]*st+R[S+3]*ct+R[S+E+1]*ut+R[S+E+3]*ht)+8192>>14,C[U]=dt,O[B++]=lt,O[B++]=_t,vt+=lt*lt,pt+=lt*_t,bt+=_t*_t;if(vt*=1/(1<<20),pt*=1/(1<<20),bt*=1/(1<<20),mt=vt*bt-pt*pt,(bt+vt-Math.sqrt((vt-bt)*(vt-bt)+4*pt*pt))/_<h||mt<1.1920929e-7)0==$&&(c[tt]=0);else for(mt=1/mt,q-=d,P-=d,V=0,N=0,et=0;et<s;++et){if(Y=0|q,Q=0|P,0!=(K=Y<=0|Y>=rt|Q<=0|Q>=at)){0==$&&(c[tt]=0);break}for(ht=16384-(st=(1-(it=q-Y))*(1-(ft=P-Q))*16384+.5|0)-(ct=it*(1-ft)*16384+.5|0)-(ut=(1-it)*ft*16384+.5|0),ot=0,nt=0,Z=0;Z<n;++Z)for(F=(Z+Q)*x+Y|0,B=(U=Z*n|0)<<1,K=0;K<n;++K,++F,++U)dt=(dt=m[F]*st+m[F+1]*ct+m[F+x]*ut+m[F+x+1]*ht)+256>>9,ot+=(dt-=C[U])*O[B++],nt+=dt*O[B++];if(ot*=1/(1<<20),nt*=1/(1<<20),j=(pt*nt-bt*ot)*mt,W=(pt*ot-vt*nt)*mt,q+=j,P+=W,f[X]=q+d,f[J]=P+d,j*j+W*W<=u)break;if(et>0&&Math.abs(j+V)<.01&&Math.abs(W+N)<.01){f[X]-=.5*j,f[J]-=.5*W;break}V=j,N=W}}else 0==$&&(c[tt]=0);r.cache.put_buffer(M),r.cache.put_buffer(k),r.cache.put_buffer(z)}}}();t.optical_flow_lk=e}(r),function(t){"use strict";var e=function(){var t=function(t,e){var r=.25*t.width+.5|0;return e.x<=t.x+r&&e.x>=t.x-r&&e.y<=t.y+r&&e.y>=t.y-r&&e.width<=1.5*t.width+.5|0&&1.5*e.width+.5|0>=t.width};return{edges_density:.07,detect_single_scale:function(t,e,r,a,i,f,o,n){var s,c,u,h,d,l,_,v,p,b,m,y,w,x,g,M,k,z,A,C,O,R,E,L,S,U=n.size[0]*o|0,B=n.size[1]*o|0,F=.5*o+1.5|0,T=F,G=i-U|0,I=f-B|0,q=i+1|0,P=1/(U*B),V=!0,N=0,j=U,W=B*q,D=W+U,H=U*B*255*this.edges_density|0,Y=[];for(d=0;d<I;d+=T)for(N=d*q,h=0;h<G;h+=F,N+=F)if(l=t[N]-t[N+j]-t[N+W]+t[N+D],a&&(a[N]-a[N+j]-a[N+W]+a[N+D]<H||l<20))h+=F,N+=F;else{for(l*=P,v=(_=(e[N]-e[N+j]-e[N+W]+e[N+D])*P-l*l)>0?Math.sqrt(_):1,w=(p=n.complexClassifiers).length,V=!0,s=0;s<w;++s){for(M=(b=p[s]).threshold,x=(m=b.simpleClassifiers).length,k=0,c=0;c<x;++c){if(y=m[c],z=0,C=y.features,g=C.length,1===y.tilted)for(u=0;u<g;++u)O=~~(h+(A=C[u])[0]*o)+~~(d+A[1]*o)*q,R=(L=~~(A[2]*o))*q,E=(S=~~(A[3]*o))*q,z+=(r[O]-r[O+L+R]-r[O-S+E]+r[O+L-S+R+E])*A[4];else for(u=0;u<g;++u)O=~~(h+(A=C[u])[0]*o)+~~(d+A[1]*o)*q,L=~~(A[2]*o),E=(S=~~(A[3]*o))*q,z+=(t[O]-t[O+L]-t[O+E]+t[O+E+L])*A[4];k+=z*P<y.threshold*v?y.left_val:y.right_val}if(k<M){V=!1;break}}V&&(Y.push({x:h,y:d,width:U,height:B,neighbor:1,confidence:k}),h+=F,N+=F)}return Y},detect_multi_scale:function(t,e,r,a,i,f,o,n,s){void 0===n&&(n=1.2),void 0===s&&(s=1);for(var c=o.size[0],u=o.size[1],h=[];s*c<i&&s*u<f;)h=h.concat(this.detect_single_scale(t,e,r,a,i,f,s,o)),s*=n;return h},group_rectangles:function(e,r){void 0===r&&(r=1);var a,i,f=e.length,o=[];for(a=0;a<f;++a)o[a]={parent:-1,element:e[a],rank:0};for(a=0;a<f;++a)if(o[a].element){for(var n=a;-1!=o[n].parent;)n=o[n].parent;for(i=0;i<f;++i)if(a!=i&&o[i].element&&t(o[a].element,o[i].element)){for(var s=i;-1!=o[s].parent;)s=o[s].parent;if(s!=n){o[n].rank>o[s].rank?o[s].parent=n:(o[n].parent=s,o[n].rank==o[s].rank&&o[s].rank++,n=s);for(var c,u=i;-1!=o[u].parent;)c=u,u=o[u].parent,o[c].parent=n;for(u=a;-1!=o[u].parent;)c=u,u=o[u].parent,o[c].parent=n}}}var h=[],d=0;for(a=0;a<f;a++){i=-1;var l=a;if(o[l].element){for(;-1!=o[l].parent;)l=o[l].parent;o[l].rank>=0&&(o[l].rank=~d++),i=~o[l].rank}h[a]=i}var _=[];for(a=0;a<d+1;++a)_[a]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(a=0;a<f;++a){var v=e[a],p=h[a];0==_[p].neighbors&&(_[p].confidence=v.confidence),++_[p].neighbors,_[p].x+=v.x,_[p].y+=v.y,_[p].width+=v.width,_[p].height+=v.height,_[p].confidence=Math.max(_[p].confidence,v.confidence)}var b=[];for(a=0;a<d;++a)(f=_[a].neighbors)>=r&&b.push({x:(2*_[a].x+f)/(2*f),y:(2*_[a].y+f)/(2*f),width:(2*_[a].width+f)/(2*f),height:(2*_[a].height+f)/(2*f),neighbors:_[a].neighbors,confidence:_[a].confidence});var m=[];for(f=b.length,a=0;a<f;++a){var v=b[a],y=!0;for(i=0;i<f;++i){var w=b[i],x=.25*w.width+.5|0;if(a!=i&&v.x>=w.x-x&&v.y>=w.y-x&&v.x+v.width<=w.x+w.width+x&&v.y+v.height<=w.y+w.height+x&&(w.neighbors>Math.max(3,v.neighbors)||v.neighbors<3)){y=!1;break}}y&&m.push(v)}return m}}}();t.haar=e}(r),function(t){"use strict";var e=function(){var t=function(t,e){var r=.25*t.width+.5|0;return e.x<=t.x+r&&e.x>=t.x-r&&e.y<=t.y+r&&e.y>=t.y-r&&e.width<=1.5*t.width+.5|0&&1.5*e.width+.5|0>=t.width},e=new r.pyramid_t(1);return{interval:4,scale:1.1486,next:5,scale_to:1,prepare_cascade:function(t){for(var e=t.stage_classifier.length,r=0;r<e;r++)for(var a=t.stage_classifier[r].feature,i=t.stage_classifier[r].count,f=t.stage_classifier[r]._feature=new Array(i),o=0;o<i;o++)f[o]={size:a[o].size,px:new Array(a[o].size),pz:new Array(a[o].size),nx:new Array(a[o].size),nz:new Array(a[o].size)}},build_pyramid:function(t,a,i,f){void 0===f&&(f=4);var o=t.cols,n=t.rows,s=0,c=0,u=0,h=!1,d=t,l=t,_=r.U8_t|r.C1_t;this.interval=f,this.scale=Math.pow(2,1/(this.interval+1)),this.next=this.interval+1|0,this.scale_to=Math.log(Math.min(o/a,n/i))/Math.log(this.scale)|0;var v=4*(this.scale_to+2*this.next)|0;for(e.levels!=v&&(e.levels=v,e.data=new Array(v),h=!0,e.data[0]=t),s=1;s<=this.interval;++s)c=o/Math.pow(this.scale,s)|0,u=n/Math.pow(this.scale,s)|0,d=e.data[s<<2],(h||c!=d.cols||u!=d.rows)&&(e.data[s<<2]=new r.matrix_t(c,u,_),d=e.data[s<<2]),r.imgproc.resample(t,d,c,u);for(s=this.next;s<this.scale_to+2*this.next;++s)l=e.data[(s<<2)-(this.next<<2)],d=e.data[s<<2],c=l.cols>>1,u=l.rows>>1,(h||c!=d.cols||u!=d.rows)&&(e.data[s<<2]=new r.matrix_t(c,u,_),d=e.data[s<<2]),r.imgproc.pyrdown(l,d);for(s=2*this.next;s<this.scale_to+2*this.next;++s)c=(l=e.data[(s<<2)-(this.next<<2)]).cols>>1,u=l.rows>>1,d=e.data[1+(s<<2)],(h||c!=d.cols||u!=d.rows)&&(e.data[1+(s<<2)]=new r.matrix_t(c,u,_),d=e.data[1+(s<<2)]),r.imgproc.pyrdown(l,d,1,0),d=e.data[2+(s<<2)],(h||c!=d.cols||u!=d.rows)&&(e.data[2+(s<<2)]=new r.matrix_t(c,u,_),d=e.data[2+(s<<2)]),r.imgproc.pyrdown(l,d,0,1),d=e.data[3+(s<<2)],(h||c!=d.cols||u!=d.rows)&&(e.data[3+(s<<2)]=new r.matrix_t(c,u,_),d=e.data[3+(s<<2)]),r.imgproc.pyrdown(l,d,1,1);return e},detect:function(t,e){this.interval;var r,a,i,f,o,n=this.scale,s=this.next,c=this.scale_to,u=0,h=0,d=0,l=0,_=0,v=0,p=0,b=0,m=0,y=0,w=0,x=0,g=0,M=0,k=0,z=0,A=0,C=0,O=!0,R=!0,E=1,L=1,S=[0,1,0,1],U=[0,0,1,1],B=[],F=t.data,T=[],G=[0,0,0],I=[0,0,0],q=[0,0,0];for(u=0;u<c;u++){for(z=F[(k=u<<2)+(s<<3)].cols-(e.width>>2),A=F[k+(s<<3)].rows-(e.height>>2),I[0]=1*F[k].cols,I[1]=1*F[k+(s<<2)].cols,I[2]=1*F[k+(s<<3)].cols,q[0]=4*F[k].cols-4*z,q[1]=2*F[k+(s<<2)].cols-2*z,q[2]=1*F[k+(s<<3)].cols-1*z,b=e.stage_classifier.length,h=0;h<b;h++)for(i=e.stage_classifier[h].feature,a=e.stage_classifier[h]._feature,m=e.stage_classifier[h].count,d=0;d<m;d++)for(f=a[d],y=0|(o=i[d]).size,p=0;p<y;p++)f.px[p]=1*o.px[p]+o.py[p]*I[o.pz[p]],f.pz[p]=o.pz[p],f.nx[p]=1*o.nx[p]+o.ny[p]*I[o.nz[p]],f.nz[p]=o.nz[p];for(T[0]=F[k].data,T[1]=F[k+(s<<2)].data,p=0;p<4;p++)for(T[2]=F[k+(s<<3)+p].data,G[0]=2*S[p]+U[p]*(2*F[k].cols),G[1]=1*S[p]+U[p]*(1*F[k+(s<<2)].cols),G[2]=0,v=0;v<A;v++){for(_=0;_<z;_++){for(C=0,O=!0,b=e.stage_classifier.length,h=0;h<b;h++){for(C=0,r=e.stage_classifier[h].alpha,a=e.stage_classifier[h]._feature,m=e.stage_classifier[h].count,d=0;d<m;d++)if(f=a[d],x=T[f.pz[0]][G[f.pz[0]]+f.px[0]],g=T[f.nz[0]][G[f.nz[0]]+f.nx[0]],x<=g)C+=r[d<<1];else{for(R=!0,y=f.size,M=1;M<y;M++){if(f.pz[M]>=0&&(w=T[f.pz[M]][G[f.pz[M]]+f.px[M]])<x){if(w<=g){R=!1;break}x=w}if(f.nz[M]>=0&&(l=T[f.nz[M]][G[f.nz[M]]+f.nx[M]])>g){if(x<=l){R=!1;break}g=l}}C+=R?r[1+(d<<1)]:r[d<<1]}if(C<e.stage_classifier[h].threshold){O=!1;break}}O&&(B.push({x:(4*_+2*S[p])*E,y:(4*v+2*U[p])*L,width:e.width*E,height:e.height*L,neighbor:1,confidence:C}),++_,G[0]+=4,G[1]+=2,G[2]+=1),G[0]+=4,G[1]+=2,G[2]+=1}G[0]+=q[0],G[1]+=q[1],G[2]+=q[2]}E*=n,L*=n}return B},group_rectangles:function(e,r){void 0===r&&(r=1);var a,i,f=e.length,o=[];for(a=0;a<f;++a)o[a]={parent:-1,element:e[a],rank:0};for(a=0;a<f;++a)if(o[a].element){for(var n=a;-1!=o[n].parent;)n=o[n].parent;for(i=0;i<f;++i)if(a!=i&&o[i].element&&t(o[a].element,o[i].element)){for(var s=i;-1!=o[s].parent;)s=o[s].parent;if(s!=n){o[n].rank>o[s].rank?o[s].parent=n:(o[n].parent=s,o[n].rank==o[s].rank&&o[s].rank++,n=s);for(var c,u=i;-1!=o[u].parent;)c=u,u=o[u].parent,o[c].parent=n;for(u=a;-1!=o[u].parent;)c=u,u=o[u].parent,o[c].parent=n}}}var h=[],d=0;for(a=0;a<f;a++){i=-1;var l=a;if(o[l].element){for(;-1!=o[l].parent;)l=o[l].parent;o[l].rank>=0&&(o[l].rank=~d++),i=~o[l].rank}h[a]=i}var _=[];for(a=0;a<d+1;++a)_[a]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(a=0;a<f;++a){var v=e[a],p=h[a];0==_[p].neighbors&&(_[p].confidence=v.confidence),++_[p].neighbors,_[p].x+=v.x,_[p].y+=v.y,_[p].width+=v.width,_[p].height+=v.height,_[p].confidence=Math.max(_[p].confidence,v.confidence)}var b=[];for(a=0;a<d;++a)(f=_[a].neighbors)>=r&&b.push({x:(2*_[a].x+f)/(2*f),y:(2*_[a].y+f)/(2*f),width:(2*_[a].width+f)/(2*f),height:(2*_[a].height+f)/(2*f),neighbors:_[a].neighbors,confidence:_[a].confidence});var m=[];for(f=b.length,a=0;a<f;++a){var v=b[a],y=!0;for(i=0;i<f;++i){var w=b[i],x=.25*w.width+.5|0;if(a!=i&&v.x>=w.x-x&&v.y>=w.y-x&&v.x+v.width<=w.x+w.width+x&&v.y+v.height<=w.y+w.height+x&&(w.neighbors>Math.max(3,v.neighbors)||v.neighbors<3)){y=!1;break}}y&&m.push(v)}return m}}}();t.bbf=e}(r),function(e){"use strict";void 0===t||void 0===t.exports?window.jsfeat=e:t.exports=e}(r)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),i=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.arView=e,this.init()}return a(t,[{key:"init",value:function(){this.debugWindow=document.createElement("div"),this.debugWindow.id="debug-window",this.debugWindow.style.position="fixed",this.debugWindow.style.bottom="0px",this.debugWindow.style.left="0px",this.debugWindow.style.color="white",this.debugWindow.style.backgroundColor="transparent",this.debugWindow.style.whiteSpace="pre",this.debugWindow.style.padding="10px",document.body.append(this.debugWindow)}},{key:"update",value:function(){if(this.arView.transform)for(var t=0;t<this.arView.transform.data.length;t++)this.debugWindow.innerHTML=this.arView.transform.data[t]+"\n"}}]),t}();e.default=i}])});