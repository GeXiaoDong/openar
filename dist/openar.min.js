!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var a in r)("object"==typeof exports?exports:t)[a]=r[a]}}(this,function(){return function(t){function e(a){if(r[a])return r[a].exports;var i=r[a]={i:a,l:!1,exports:{}};return t[a].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var r={};return e.m=t,e.c=r,e.d=function(t,r,a){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:a})},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,r){"use strict";(function(t){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=a(r(2)),n=a(r(4));t.ARView=i.default,t.ARDebugger=n.default,e.default={ARView:i.default,ARDebugger:n.default}}).call(e,r(1))},function(t,e){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),i=function(t){return t&&t.__esModule?t:{default:t}}(r(3)),n=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.renderer=e,this.renderer.autoClear=!1,this.sceneCamera=r,this.cameraOrientation=null,this.cameraMotion=null,this.prevFrame=null,this.scene=new THREE.Scene,this.loaded=!1,this.camera=new THREE.OrthographicCamera(-1,1,1,-1),this.camera.position.z=1,i.default.fast_corners.set_threshold(20),this.init(),this.initListeners()}return a(t,[{key:"init",value:function(){var t=this;this.video=document.createElement("video"),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}).then(function(e){t.video.src=window.URL.createObjectURL(e)}),this.videoTexture=new THREE.VideoTexture(this.video),this.videoTexture.minFilter=THREE.LinearFilter,this.videoTexture.magFilter=THREE.LinearFilter;var e=new THREE.SpriteMaterial({map:this.videoTexture});this.screen=new THREE.Sprite(e),this.screen.scale.set(2,2),this.scene.add(this.screen)}},{key:"initListeners",value:function(){window.addEventListener("deviceorientation",this.handleOrientation.bind(this)),window.addEventListener("devicemotion",this.handleMotion.bind(this))}},{key:"handleOrientation",value:function(t){if(null!==this.cameraOrientation){var e=t.alpha-this.cameraOrientation.alpha,r=t.beta-this.cameraOrientation.beta,a=t.gamma-this.cameraOrientation.gamma,i=Math.cos(e)*r+Math.sin(e)*a,n=Math.sin(e)*r+Math.cos(e)*a;this.sceneCamera.rotation.x+=i,this.sceneCamera.rotation.y+=n}this.cameraOrientation=t}},{key:"handleMotion",value:function(t){this.cameraMotion=t}},{key:"update",value:function(){this.renderer.clear(),this.renderer.render(this.scene,this.camera),this.renderer.clearDepth(),this.loaded&&this.processFrame()}},{key:"processFrame",value:function(){var t=renderer.context,e=new Uint8Array(t.drawingBufferWidth*t.drawingBufferHeight*4);if(t.readPixels(0,0,t.drawingBufferWidth,t.drawingBufferHeight,t.RGBA,t.UNSIGNED_BYTE,e),null!==this.prevFrame){var r=new i.default.matrix_t(t.drawingBufferWidth,t.drawingBufferHeight,i.default.U8_t|i.default.C1_t),a=new i.default.matrix_t(t.drawingBufferWidth,t.drawingBufferHeight,i.default.U8_t|i.default.C1_t);i.default.imgproc.grayscale(e,t.drawingBufferWidth,t.drawingBufferHeight,r,i.default.COLOR_RGBA2GRAY),i.default.imgproc.grayscale(this.prevFrame,t.drawingBufferWidth,t.drawingBufferHeight,a,i.default.COLOR_RGBA2GRAY);for(var n=[],f=[],o=0;o<r.data.length;o++)n[o]=new i.default.keypoint_t,f[o]=new i.default.keypoint_t;i.default.fast_corners.detect(r,n,3),i.default.fast_corners.detect(a,f,3);var s=new i.default.pyramid_t,c=new i.default.pyramid_t;s.allocate(t.drawingBufferWidth,t.drawingBufferHeight,r.type),c.allocate(t.drawingBufferWidth,t.drawingBufferHeight,r.type),s.data[0]=r,c.data[0]=a;var u=[];i.default.optical_flow_lk.track(c,s,f,n,r.data.length,20,30,u,.01,1e-4)}this.prevFrame=e}}]),t}();e.default=n},function(t,e){var r=r||{REVISION:"ALPHA"};!function(t){"use strict";var e=256,a=512,i=1024,n=new Int32Array([-1,1,4,-1,4,-1,-1,-1,8,-1,-1,-1,-1,-1,-1,-1,8]),f=function(t){return 65280&t},o=function(t){return 255&t},s=function(t){return n[(65280&t)>>8]},c=function(){return function(t,e){this.size=-8&(t+7|0),void 0===e?this.buffer=new ArrayBuffer(this.size):(this.buffer=e,this.size=e.length),this.u8=new Uint8Array(this.buffer),this.i32=new Int32Array(this.buffer),this.f32=new Float32Array(this.buffer),this.f64=new Float64Array(this.buffer)}}(),u=function(){function t(t,r,n,s){this.type=0|f(n),this.channel=0|o(n),this.cols=0|t,this.rows=0|r,void 0===s?this.allocate():(this.buffer=s,this.data=this.type&e?this.buffer.u8:this.type&a?this.buffer.i32:this.type&i?this.buffer.f32:this.buffer.f64)}return t.prototype.allocate=function(){delete this.data,delete this.buffer,this.buffer=new c(this.cols*s(this.type)*this.channel*this.rows),this.data=this.type&e?this.buffer.u8:this.type&a?this.buffer.i32:this.type&i?this.buffer.f32:this.buffer.f64},t.prototype.copy_to=function(t){for(var e=t.data,r=this.data,a=0,i=this.cols*this.rows*this.channel|0;a<i-4;a+=4)e[a]=r[a],e[a+1]=r[a+1],e[a+2]=r[a+2],e[a+3]=r[a+3];for(;a<i;++a)e[a]=r[a]},t.prototype.resize=function(t,e,r){void 0===r&&(r=this.channel);t*s(this.type)*r*e>this.buffer.size?(this.cols=t,this.rows=e,this.channel=r,this.allocate()):(this.cols=t,this.rows=e,this.channel=r)},t}(),h=function(){function t(t){this.levels=0|t,this.data=new Array(t),this.pyrdown=r.imgproc.pyrdown}return t.prototype.allocate=function(t,e,r){for(var a=this.levels;--a>=0;)this.data[a]=new u(t>>a,e>>a,r)},t.prototype.build=function(t,e){void 0===e&&(e=!0);var r=2,a=t,i=this.data[0];if(!e)for(var n=t.cols*t.rows;--n>=0;)i.data[n]=t.data[n];for(i=this.data[1],this.pyrdown(a,i);r<this.levels;++r)a=i,i=this.data[r],this.pyrdown(a,i)},t}(),d=function(){return function(t,e,r,a,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===i&&(i=-1),this.x=t,this.y=e,this.score=r,this.level=a,this.angle=i}}();t.U8_t=e,t.S32_t=a,t.F32_t=i,t.S64_t=2048,t.F64_t=4096,t.C1_t=1,t.C2_t=2,t.C3_t=3,t.C4_t=4,t.U8C1_t=1|e,t.U8C3_t=3|e,t.U8C4_t=4|e,t.F32C1_t=1|i,t.F32C2_t=2|i,t.S32C1_t=1|a,t.S32C2_t=2|a,t.EPSILON=1.192092896e-7,t.FLT_MIN=1e-37,t.COLOR_RGBA2GRAY=0,t.COLOR_RGB2GRAY=1,t.COLOR_BGRA2GRAY=2,t.COLOR_BGR2GRAY=3,t.BOX_BLUR_NOSCALE=1,t.SVD_U_T=1,t.SVD_V_T=2,t.get_data_type=f,t.get_channel=o,t.get_data_type_size=s,t.data_t=c,t.matrix_t=u,t.pyramid_t=h,t.keypoint_t=d}(r),function(t){"use strict";var e=function(){var t,e,a=function(){function t(t){this.next=null,this.data=new r.data_t(t),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64}return t.prototype.resize=function(t){delete this.data,this.data=new r.data_t(t),this.size=this.data.size,this.buffer=this.data.buffer,this.u8=this.data.u8,this.i32=this.data.i32,this.f32=this.data.f32,this.f64=this.data.f64},t}(),i=0;return{allocate:function(r,n){t=e=new a(n);for(var f=0;f<r;++f){var o=new a(n);e=e.next=o,i++}},get_buffer:function(e){var r=t;return t=t.next,i--,e>r.size&&r.resize(e),r},put_buffer:function(t){e=e.next=t,i++}}}();t.cache=e,e.allocate(30,2560)}(r),function(t){"use strict";var e=function(){var t=new Int32Array(96);return{get_gaussian_kernel:function(t,e,a,i){var n=0,f=0,o=0,s=0,c=0,u=0,h=r.cache.get_buffer(t<<2),d=h.f32;if(1==(1&t)&&t<=7&&e<=0)switch(t>>1){case 0:d[0]=1,u=1;break;case 1:d[0]=.25,d[1]=.5,d[2]=.25,u=1;break;case 2:d[0]=.0625,d[1]=.25,d[2]=.375,d[3]=.25,d[4]=.0625,u=1;break;case 3:d[0]=.03125,d[1]=.109375,d[2]=.21875,d[3]=.28125,d[4]=.21875,d[5]=.109375,d[6]=.03125,u=1}else for(c=-.5/((s=e>0?e:.3*(.5*(t-1)-1)+.8)*s);n<t;++n)f=n-.5*(t-1),o=Math.exp(c*f*f),d[n]=o,u+=o;if(i&r.U8_t)for(u=256/u,n=0;n<t;++n)a[n]=d[n]*u+.5|0;else for(u=1/u,n=0;n<t;++n)a[n]=d[n]*u;r.cache.put_buffer(h)},perspective_4point_transform:function(t,e,r,a,i,n,f,o,s,c,u,h,d,l,_,v,p){var b=e,m=c,w=f,y=b*m*w,g=_,x=b*g,M=m*x,k=u,z=b*k,C=n,O=r,A=l,R=O*A,L=R*C,B=A*C*k,T=A*w,E=A*k,S=m*w,U=g*m,V=g*C,W=k*C,H=1/(T-E-S+U-V+W),F=b*A,G=O*C,I=w*b,q=g*I,P=O*m,N=R*k,j=O*k*C,D=w*g*m,Y=g*O,Q=-(M-y+z*C-C*x-R*m+L-B+T*m)*H,X=(y-M-F*w+F*k+L-m*G+V*m-B)*H,J=b,K=(-k*x+q+P*w-R*w+N-j+V*k-D)*H,Z=(I*k-q-Y*m+N-j+Y*C+D-T*k)*H,$=O,tt=(-z+I+P-G+E-T-U+V)*H,et=(-x+z+R-P+V-W-T+S)*H,rt=-((M=(m=h)*(x=(b=a)*(g=p)))-(y=b*m*(w=s))+(z=b*(k=d))*(C=o)-C*x-(R=(O=i)*(A=v))*m+(L=R*C)-(B=A*C*k)+(T=A*w)*m)*(H=1/(T-(E=A*k)-(S=m*w)+(U=g*m)-(V=g*C)+(W=k*C))),at=(y-M-(F=b*A)*w+F*k+L-m*(G=O*C)+V*m-B)*H,it=b,nt=(-k*x+(q=g*(I=w*b))+(P=O*m)*w-R*w+(N=R*k)-(j=O*k*C)+V*k-(D=w*g*m))*H,ft=(I*k-q-(Y=g*O)*m+N-j+Y*C+D-T*k)*H,ot=O,st=(-z+I+P-G+E-T-U+V)*H,ct=(-x+z+R-P+V-W-T+S)*H,ut=J*tt;L=$*tt-K;var ht=-K*et+Z*tt,dt=Q-ut;G=Q*et-(z=X*tt);var lt=(y=Q*$)-(M=J*K),_t=(w=Q*Z)-(x=K*X);j=(m=Z-et*$)*(A=1/(w-y*et-x+M*et+z*$-ut*Z));var vt=(W=J*et-X)*A,pt=(I=-X*$+J*Z)*A,bt=t.data;bt[0]=rt*j+at*(L*A)-it*(ht*A),bt[1]=rt*vt+at*(dt*A)-it*(G*A),bt[2]=-rt*pt-at*(lt*A)+it*(_t*A),bt[3]=nt*j+ft*(L*A)-ot*(ht*A),bt[4]=nt*vt+ft*(dt*A)-ot*(G*A),bt[5]=-nt*pt-ft*(lt*A)+ot*(_t*A),bt[6]=st*j+ct*(L*A)-ht*A,bt[7]=st*vt+ct*(dt*A)-G*A,bt[8]=-st*pt-ct*(lt*A)+_t*A},qsort:function(e,r,a,i){var n,f,o,s,c=0,u=0,h=0,d=0,l=0,_=0,v=0,p=0,b=0,m=0,w=0,y=0,g=0,x=0,M=0,k=0,z=0,C=0,O=t;if(!(a-r+1<=1))for(O[0]=r,O[1]=a;c>=0;)for(u=O[c<<1],h=O[1+(c<<1)],c--;;){if((l=h-u+1)<=7){for(v=u+1;v<=h;v++)for(p=v;p>u&&i(e[p],e[p-1]);p--)n=e[p],e[p]=e[p-1],e[p-1]=n;break}for(C=0,m=u,y=h,x=u+(l>>1),l>40&&(k=u+(b=l>>3),z=u+(b<<1),f=e[M=u],o=e[k],s=e[z],u=i(f,o)?i(o,s)?k:i(f,s)?z:M:i(s,o)?k:i(f,s)?M:z,k=x,z=x+b,f=e[M=x-b],o=e[k],s=e[z],x=i(f,o)?i(o,s)?k:i(f,s)?z:M:i(s,o)?k:i(f,s)?M:z,k=h-b,z=h,f=e[M=h-(b<<1)],o=e[k],s=e[z],h=i(f,o)?i(o,s)?k:i(f,s)?z:M:i(s,o)?k:i(f,s)?M:z),k=x,z=h,f=e[M=u],o=e[k],s=e[z],(x=i(f,o)?i(o,s)?k:i(f,s)?z:M:i(s,o)?k:i(f,s)?M:z)!=m&&(n=e[x],e[x]=e[m],e[m]=n,x=m),u=w=m+1,h=g=y,f=e[x];;){for(;u<=h&&!i(f,e[u]);)i(e[u],f)||(u>w&&(n=e[w],e[w]=e[u],e[u]=n),C=1,w++),u++;for(;u<=h&&!i(e[h],f);)i(f,e[h])||(h<g&&(n=e[g],e[g]=e[h],e[h]=n),C=1,g--),h--;if(u>h)break;n=e[u],e[u]=e[h],e[h]=n,C=1,u++,h--}if(0==C){for(h=y,v=(u=m)+1;v<=h;v++)for(p=v;p>u&&i(e[p],e[p-1]);p--)n=e[p],e[p]=e[p-1],e[p-1]=n;break}for(_=u-(l=Math.min(w-m,u-w))|0,d=0;d<l;++d,++_)n=e[m+d],e[m+d]=e[_],e[_]=n;for(_=y-(l=Math.min(y-g,g-h))+1|0,d=0;d<l;++d,++_)n=e[u+d],e[u+d]=e[_],e[_]=n;if(l=u-w,_=g-h,l>1)_>1?l>_?(O[++c<<1]=m,O[1+(c<<1)]=m+l-1,u=y-_+1,h=y):(O[++c<<1]=y-_+1,O[1+(c<<1)]=y,u=m,h=m+l-1):(u=m,h=m+l-1);else{if(!(_>1))break;u=y-_+1,h=y}}},median:function(t,e,r){for(var a,i=0,n=0,f=0,o=e+r>>1;;){if(r<=e)return t[o];if(r==e+1)return t[e]>t[r]&&(a=t[e],t[e]=t[r],t[r]=a),t[o];for(t[i=e+r>>1]>t[r]&&(a=t[i],t[i]=t[r],t[r]=a),t[e]>t[r]&&(a=t[e],t[e]=t[r],t[r]=a),t[i]>t[e]&&(a=t[i],t[i]=t[e],t[e]=a),n=e+1,a=t[i],t[i]=t[n],t[n]=a,f=r;;){do{++n}while(t[e]>t[n]);do{--f}while(t[f]>t[e]);if(f<n)break;a=t[n],t[n]=t[f],t[f]=a}a=t[e],t[e]=t[f],t[f]=a,f<=o?e=n:f>=o&&(r=f-1)}return 0}}}();t.math=e}(r),function(t){"use strict";var e={identity:function(t,e){void 0===e&&(e=1);for(var r=t.data,a=t.rows,i=t.cols,n=i+1|0,f=a*i,o=f;--f>=0;)r[f]=0;for(f=o,o=0;o<f;)r[o]=e,o+=n},transpose:function(t,e){for(var r=0,a=0,i=e.rows,n=e.cols,f=0,o=0,s=0,c=e.data,u=t.data;r<i;o+=1,f+=n,r++)for(s=o,a=0;a<n;s+=i,a++)u[s]=c[f+a]},multiply:function(t,e,r){for(var a=0,i=0,n=0,f=0,o=0,s=0,c=0,u=0,h=e.cols,d=e.rows,l=r.cols,_=e.data,v=r.data,p=t.data,b=0;a<d;f+=h,a++)for(c=0,i=0;i<l;u++,c++,i++){for(s=c,o=f,b=0,n=0;n<h;o++,s+=l,n++)b+=_[o]*v[s];p[u]=b}},multiply_ABt:function(t,e,r){for(var a=0,i=0,n=0,f=0,o=0,s=0,c=0,u=e.cols,h=e.rows,d=r.rows,l=e.data,_=r.data,v=t.data,p=0;a<h;f+=u,a++)for(s=0,i=0;i<d;c++,i++){for(o=f,p=0,n=0;n<u;o++,s++,n++)p+=l[o]*_[s];v[c]=p}},multiply_AtB:function(t,e,r){for(var a=0,i=0,n=0,f=0,o=0,s=0,c=0,u=0,h=e.cols,d=e.rows,l=r.cols,_=e.data,v=r.data,p=t.data,b=0;a<h;f++,a++)for(c=0,i=0;i<l;u++,c++,i++){for(s=c,o=f,b=0,n=0;n<d;o+=h,s+=l,n++)b+=_[o]*v[s];p[u]=b}},multiply_AAt:function(t,e){for(var r=0,a=0,i=0,n=0,f=0,o=0,s=0,c=0,u=0,h=e.cols,d=e.rows,l=e.data,_=t.data,v=0;r<d;n+=d+1,f=o,r++)for(c=n,u=n,s=f,a=r;a<d;c++,u+=d,a++){for(o=f,v=0,i=0;i<h;i++)v+=l[o++]*l[s++];_[c]=v,_[u]=v}},multiply_AtA:function(t,e){for(var r=0,a=0,i=0,n=0,f=0,o=0,s=0,c=0,u=0,h=e.cols,d=e.rows,l=e.data,_=t.data,v=0;r<h;s+=h,r++)for(n=r,c=u=s+r,a=r;a<h;c++,u+=h,a++){for(f=n,o=a,v=0,i=0;i<d;f+=h,o+=h,i++)v+=l[f]*l[o];_[c]=v,_[u]=v}},identity_3x3:function(t,e){void 0===e&&(e=1);var r=t.data;r[0]=r[4]=r[8]=e,r[1]=r[2]=r[3]=0,r[5]=r[6]=r[7]=0},invert_3x3:function(t,e){var r=t.data,a=e.data,i=r[4],n=r[8],f=r[5],o=r[7],s=r[0],c=s*i,u=s*f,h=r[3],d=r[1],l=h*d,_=r[2],v=h*_,p=r[6],b=p*d,m=p*_,w=1/(c*n-u*o-l*n+v*o+b*f-m*i);a[0]=(i*n-f*o)*w,a[1]=-(d*n-_*o)*w,a[2]=-(-d*f+_*i)*w,a[3]=-(h*n-f*p)*w,a[4]=(s*n-m)*w,a[5]=-(u-v)*w,a[6]=-(-h*o+i*p)*w,a[7]=-(s*o-b)*w,a[8]=(c-l)*w},multiply_3x3:function(t,e,r){var a=t.data,i=e.data,n=r.data,f=i[0],o=i[1],s=i[2],c=i[3],u=i[4],h=i[5],d=i[6],l=i[7],_=i[8],v=n[0],p=n[1],b=n[2],m=n[3],w=n[4],y=n[5],g=n[6],x=n[7],M=n[8];a[0]=f*v+o*m+s*g,a[1]=f*p+o*w+s*x,a[2]=f*b+o*y+s*M,a[3]=c*v+u*m+h*g,a[4]=c*p+u*w+h*x,a[5]=c*b+u*y+h*M,a[6]=d*v+l*m+_*g,a[7]=d*p+l*w+_*x,a[8]=d*b+l*y+_*M},mat3x3_determinant:function(t){var e=t.data;return e[0]*e[4]*e[8]-e[0]*e[5]*e[7]-e[3]*e[1]*e[8]+e[3]*e[2]*e[7]+e[6]*e[1]*e[5]-e[6]*e[2]*e[4]},determinant_3x3:function(t,e,r,a,i,n,f,o,s){return t*i*s-t*n*o-a*e*s+a*r*o+f*e*n-f*r*i}};r.matmath=e}(),function(t){"use strict";var e=function(){var t=function(t,e,r,a){a=t[e],t[e]=t[r],t[r]=a},e=function(t,e){return t=Math.abs(t),e=Math.abs(e),t>e?(e/=t,t*Math.sqrt(1+e*e)):e>0?(t/=e,e*Math.sqrt(1+t*t)):0};return{lu_solve:function(e,a){var i,n,f,o,s=0,c=0,u=0,h=1,d=e.cols,l=e.data,_=a.data;for(s=0;s<d;s++){for(u=s,c=s+1;c<d;c++)Math.abs(l[c*d+s])>Math.abs(l[u*d+s])&&(u=c);if(Math.abs(l[u*d+s])<r.EPSILON)return 0;if(u!=s){for(c=s;c<d;c++)t(l,s*d+c,u*d+c,i);t(_,s,u,i),h=-h}for(f=-1/l[s*d+s],c=s+1;c<d;c++){for(n=l[c*d+s]*f,u=s+1;u<d;u++)l[c*d+u]+=n*l[s*d+u];_[c]+=n*_[s]}l[s*d+s]=-f}for(s=d-1;s>=0;s--){for(o=_[s],u=s+1;u<d;u++)o-=l[s*d+u]*_[u];_[s]=o*l[s*d+s]}return 1},cholesky_solve:function(t,e){var r,a,i=0,n=0,f=0,o=0,s=0,c=0,u=0,h=t.cols,d=t.data,l=e.data;for(i=0;i<h;i++)for(a=1,s=o=i*h,n=i;n<h;n++){for(r=d[s+i],f=0;f<i;f++)r-=d[f*h+i]*d[s+f];if(n==i){if(d[s+i]=r,0==r)return 0;a=1/r}else d[o+n]=r,d[s+i]=r*a;s+=h}for(o=0,c=0;c<h;c++){for(r=l[c],u=0;u<c;u++)r-=d[o+u]*l[u];l[c]=r,o+=h}for(o=0,c=0;c<h;c++)l[c]/=d[o+c],o+=h;for(c=h-1;c>=0;c--){for(r=l[c],o=(u=c+1)*h;u<h;u++)r-=d[o+c]*l[u],o+=h;l[c]=r}return 1},svd_decompose:function(a,i,n,f,o){void 0===o&&(o=0);var s=0,c=0,u=a.rows,h=a.cols,d=u,l=h,_=a.type|r.C1_t;d<l&&(s=1,c=d,d=l,l=c);var v=r.cache.get_buffer(d*d<<3),p=r.cache.get_buffer(l<<3),b=r.cache.get_buffer(l*l<<3),m=new r.matrix_t(d,d,_,v.data),w=new r.matrix_t(1,l,_,p.data),y=new r.matrix_t(l,l,_,b.data);if(0==s)r.matmath.transpose(m,a);else{for(c=0;c<h*u;c++)m.data[c]=a.data[c];for(;c<l*d;c++)m.data[c]=0}if(function(a,i,n,f,o,s,c,u){for(var h=2*r.EPSILON,d=r.FLT_MIN,l=0,_=0,v=0,p=0,b=Math.max(s,30),m=0,w=0,y=0,g=0,x=0,M=0,k=0,z=0,C=0,O=0,A=0,R=0,L=0,B=0,T=0,E=0,S=0,U=4660,V=0,W=0,H=0,F=r.cache.get_buffer(c<<3),G=F.f64;l<c;l++){for(v=0,A=0;v<s;v++)A+=(z=a[l*i+v])*z;if(G[l]=A,f){for(v=0;v<c;v++)f[l*o+v]=0;f[l*o+l]=1}}for(;p<b;p++){for(x=0,l=0;l<c-1;l++)for(_=l+1;_<c;_++){for(m=l*i|0,w=_*i|0,T=G[l],E=0,S=G[_],v=2,E+=a[m]*a[w],E+=a[m+1]*a[w+1];v<s;v++)E+=a[m+v]*a[w+v];if(!(Math.abs(E)<=h*Math.sqrt(T*S))){for(L=e(E*=2,R=T-S),R<0?(B=.5*(L-R),M=E/(L*(k=Math.sqrt(B/L))*2)):k=E/(L*(M=Math.sqrt((L+R)/(2*L)))*2),T=0,S=0,v=2,C=M*a[m]+k*a[w],O=-k*a[m]+M*a[w],a[m]=C,a[w]=O,T+=C*C,S+=O*O,C=M*a[m+1]+k*a[w+1],O=-k*a[m+1]+M*a[w+1],a[m+1]=C,a[w+1]=O,T+=C*C,S+=O*O;v<s;v++)C=M*a[m+v]+k*a[w+v],O=-k*a[m+v]+M*a[w+v],a[m+v]=C,a[w+v]=O,T+=C*C,S+=O*O;if(G[l]=T,G[_]=S,x=1,f)for(g=_*o|0,v=2,C=M*f[y=l*o|0]+k*f[g],O=-k*f[y]+M*f[g],f[y]=C,f[g]=O,C=M*f[y+1]+k*f[g+1],O=-k*f[y+1]+M*f[g+1],f[y+1]=C,f[g+1]=O;v<c;v++)C=M*f[y+v]+k*f[g+v],O=-k*f[y+v]+M*f[g+v],f[y+v]=C,f[g+v]=O}}if(0==x)break}for(l=0;l<c;l++){for(v=0,A=0;v<s;v++)A+=(z=a[l*i+v])*z;G[l]=Math.sqrt(A)}for(l=0;l<c-1;l++){for(_=l,v=l+1;v<c;v++)G[_]<G[v]&&(_=v);if(l!=_&&(t(G,l,_,A),f)){for(v=0;v<s;v++)t(a,l*i+v,_*i+v,z);for(v=0;v<c;v++)t(f,l*o+v,_*o+v,z)}}for(l=0;l<c;l++)n[l]=G[l];if(f){for(l=0;l<u;l++){for(A=l<c?G[l]:0;A<=d;){for(W=1/s,v=0;v<s;v++)V=0!=(256&(U=214013*U+2531011)>>16)?W:-W,a[l*i+v]=V;for(p=0;p<2;p++)for(_=0;_<l;_++){for(A=0,v=0;v<s;v++)A+=a[l*i+v]*a[_*i+v];for(H=0,v=0;v<s;v++)z=a[l*i+v]-A*a[_*i+v],a[l*i+v]=z,H+=Math.abs(z);for(H=H?1/H:0,v=0;v<s;v++)a[l*i+v]*=H}for(A=0,v=0;v<s;v++)A+=(z=a[l*i+v])*z;A=Math.sqrt(A)}for(k=1/A,v=0;v<s;v++)a[l*i+v]*=k}r.cache.put_buffer(F)}else r.cache.put_buffer(F)}(m.data,d,w.data,y.data,l,d,l,d),i){for(c=0;c<l;c++)i.data[c]=w.data[c];for(;c<h;c++)i.data[c]=0}if(0==s){if(n&&o&r.SVD_U_T)for(c=d*d;--c>=0;)n.data[c]=m.data[c];else n&&r.matmath.transpose(n,m);if(f&&o&r.SVD_V_T)for(c=l*l;--c>=0;)f.data[c]=y.data[c];else f&&r.matmath.transpose(f,y)}else{if(n&&o&r.SVD_U_T)for(c=l*l;--c>=0;)n.data[c]=y.data[c];else n&&r.matmath.transpose(n,y);if(f&&o&r.SVD_V_T)for(c=d*d;--c>=0;)f.data[c]=m.data[c];else f&&r.matmath.transpose(f,m)}r.cache.put_buffer(v),r.cache.put_buffer(p),r.cache.put_buffer(b)},svd_solve:function(t,e,a){var i=0,n=0,f=0,o=0,s=0,c=t.rows,u=t.cols,h=0,d=0,l=0,_=t.type|r.C1_t,v=r.cache.get_buffer(c*c<<3),p=r.cache.get_buffer(u<<3),b=r.cache.get_buffer(u*u<<3),m=new r.matrix_t(c,c,_,v.data),w=new r.matrix_t(1,u,_,p.data),y=new r.matrix_t(u,u,_,b.data),g=a.data,x=m.data,M=w.data,k=y.data;for(this.svd_decompose(t,w,m,y,0),l=r.EPSILON*M[0]*u;i<u;i++,s+=u){for(d=0,n=0;n<u;n++)if(M[n]>l){for(f=0,h=0,o=0;f<c;f++,o+=u)h+=x[o+n]*g[f];d+=h*k[s+n]/M[n]}e.data[i]=d}r.cache.put_buffer(v),r.cache.put_buffer(p),r.cache.put_buffer(b)},svd_invert:function(t,e){var a=0,i=0,n=0,f=0,o=0,s=0,c=e.rows,u=e.cols,h=0,d=0,l=e.type|r.C1_t,_=r.cache.get_buffer(c*c<<3),v=r.cache.get_buffer(u<<3),p=r.cache.get_buffer(u*u<<3),b=new r.matrix_t(c,c,l,_.data),m=new r.matrix_t(1,u,l,v.data),w=new r.matrix_t(u,u,l,p.data),y=t.data,g=b.data,x=m.data,M=w.data;for(this.svd_decompose(e,m,b,w,0),d=r.EPSILON*x[0]*u;a<u;a++,o+=u)for(i=0,f=0;i<c;i++,s++){for(n=0,h=0;n<u;n++,f++)x[n]>d&&(h+=M[o+n]*g[f]/x[n]);y[s]=h}r.cache.put_buffer(_),r.cache.put_buffer(v),r.cache.put_buffer(p)},eigenVV:function(a,i,n){for(var f=a.cols,o=f*f,s=a.type|r.C1_t,c=r.cache.get_buffer(f*f<<3),u=r.cache.get_buffer(f<<3),h=new r.matrix_t(f,f,s,c.data),d=new r.matrix_t(1,f,s,u.data);--o>=0;)h.data[o]=a.data[o];if(function(a,i,n,f,o,s){var c=r.EPSILON,u=0,h=0,d=0,l=0,_=0,v=0,p=0,b=0,m=0,w=s*s*30,y=0,g=0,x=0,M=0,k=0,z=0,C=0,O=0,A=0,R=r.cache.get_buffer(s<<2),L=r.cache.get_buffer(s<<2),B=R.i32,T=L.i32;if(f)for(;u<s;u++){for(d=u*o,h=0;h<s;h++)f[d+h]=0;f[d+u]=1}for(d=0;d<s;d++){if(n[d]=a[(i+1)*d],d<s-1){for(l=d+1,y=Math.abs(a[i*d+l]),u=d+2;u<s;u++)y<(g=Math.abs(a[i*d+u]))&&(y=g,l=u);B[d]=l}if(d>0){for(l=0,y=Math.abs(a[d]),u=1;u<d;u++)y<(g=Math.abs(a[i*u+d]))&&(y=g,l=u);T[d]=l}}if(s>1)for(;m<w;m++){for(d=0,y=Math.abs(a[B[0]]),u=1;u<s-1;u++)y<(g=Math.abs(a[i*u+B[u]]))&&(y=g,d=u);for(_=B[d],u=1;u<s;u++)y<(g=Math.abs(a[i*T[u]+u]))&&(y=g,d=T[u],_=u);if(x=a[i*d+_],Math.abs(x)<=c)break;for(M=.5*(n[_]-n[d]),C=(k=Math.abs(M)+e(x,M))/(z=e(x,k)),z=x/z,k=x/k*x,M<0&&(z=-z,k=-k),a[i*d+_]=0,n[d]-=k,n[_]+=k,u=0;u<d;u++)b=i*u+_,O=a[p=i*u+d],A=a[b],a[p]=O*C-A*z,a[b]=O*z+A*C;for(u=d+1;u<_;u++)b=i*u+_,O=a[p=i*d+u],A=a[b],a[p]=O*C-A*z,a[b]=O*z+A*C;for(p=i*d+(u=_+1),b=i*_+u;u<s;u++,p++,b++)O=a[p],A=a[b],a[p]=O*C-A*z,a[b]=O*z+A*C;if(f)for(p=o*d,b=o*_,u=0;u<s;u++,p++,b++)O=f[p],A=f[b],f[p]=O*C-A*z,f[b]=O*z+A*C;for(h=0;h<2;h++){if((v=0==h?d:_)<s-1){for(l=v+1,y=Math.abs(a[i*v+l]),u=v+2;u<s;u++)y<(g=Math.abs(a[i*v+u]))&&(y=g,l=u);B[v]=l}if(v>0){for(l=0,y=Math.abs(a[v]),u=1;u<v;u++)y<(g=Math.abs(a[i*u+v]))&&(y=g,l=u);T[v]=l}}}for(d=0;d<s-1;d++){for(l=d,u=d+1;u<s;u++)n[l]<n[u]&&(l=u);if(d!=l&&(t(n,l,d,y),f))for(u=0;u<s;u++)t(f,o*l+u,o*d+u,y)}r.cache.put_buffer(R),r.cache.put_buffer(L)}(h.data,f,d.data,i?i.data:null,f,f),n)for(;--f>=0;)n.data[f]=d.data[f];r.cache.put_buffer(c),r.cache.put_buffer(u)}}}();t.linalg=e}(r),function(t){"use strict";var e=function(){var t=function(t){return t*t},e=new r.matrix_t(3,3,r.F32_t|r.C1_t),a=new r.matrix_t(3,3,r.F32_t|r.C1_t),i=new r.matrix_t(6,6,r.F32_t|r.C1_t),n=new r.matrix_t(6,1,r.F32_t|r.C1_t),f=function(){function f(){}return f.prototype.run=function(t,f,o,s){var c,u,h=0,d=0,l=o.type|r.C1_t,_=o.data,v=e.data,p=a.data,b=0,m=0;!function(t,e,r,a,i){for(var n=0,f=0,o=0,s=0,c=0,u=0,h=0,d=0,l=0,_=0,v=0;n<i;++n)f+=t[n].x,o+=t[n].y,u+=e[n].x,h+=e[n].y;for(f/=i,o/=i,u/=i,h/=i,n=0;n<i;++n)_=t[n].x-f,v=t[n].y-o,s+=Math.sqrt(_*_+v*v),_=e[n].x-u,v=e[n].y-h,d+=Math.sqrt(_*_+v*v);s/=i,d/=i,c=Math.SQRT2/s,l=Math.SQRT2/d,r[0]=r[4]=c,r[2]=-f*c,r[5]=-o*c,r[1]=r[3]=r[6]=r[7]=0,r[8]=1,a[0]=a[4]=l,a[2]=-u*l,a[5]=-h*l,a[1]=a[3]=a[6]=a[7]=0,a[8]=1}(t,f,v,p,s);for(var w=r.cache.get_buffer(2*s*6<<3),y=r.cache.get_buffer(2*s<<3),g=new r.matrix_t(6,2*s,l,w.data),x=new r.matrix_t(1,2*s,l,y.data),M=g.data,k=x.data;h<s;++h)c=t[h],u=f[h],b=v[0]*c.x+v[1]*c.y+v[2],m=v[3]*c.x+v[4]*c.y+v[5],M[d=2*h*6]=b,M[d+1]=m,M[d+2]=1,M[d+3]=0,M[d+4]=0,M[d+5]=0,M[d+=6]=0,M[d+1]=0,M[d+2]=0,M[d+3]=b,M[d+4]=m,M[d+5]=1,k[h<<1]=p[0]*u.x+p[1]*u.y+p[2],k[1+(h<<1)]=p[3]*u.x+p[4]*u.y+p[5];return r.matmath.multiply_AtA(i,g),r.matmath.multiply_AtB(n,g,x),r.linalg.lu_solve(i,n),_[0]=n.data[0],_[1]=n.data[1],_[2]=n.data[2],_[3]=n.data[3],_[4]=n.data[4],_[5]=n.data[5],_[6]=0,_[7]=0,_[8]=1,r.matmath.invert_3x3(a,a),r.matmath.multiply_3x3(o,a,o),r.matmath.multiply_3x3(o,o,e),r.cache.put_buffer(w),r.cache.put_buffer(y),1},f.prototype.error=function(e,r,a,i,n){for(var f,o,s=0,c=a.data;s<n;++s)f=e[s],o=r[s],i[s]=t(o.x-c[0]*f.x-c[1]*f.y-c[2])+t(o.y-c[3]*f.x-c[4]*f.y-c[5])},f.prototype.check_subset=function(t,e,r){return!0},f}(),o=new r.matrix_t(9,9,r.F32_t|r.C1_t),s=new r.matrix_t(9,9,r.F32_t|r.C1_t);return{affine2d:f,homography2d:function(){function t(){}return t.prototype.run=function(t,i,n,f){for(var c=0,u=0,h=n.data,d=e.data,l=a.data,_=o.data,v=s.data,p=0,b=0,m=0,w=0,y=0,g=0,x=0,M=0,k=0,z=0,C=0,O=0;c<f;++c)x+=i[c].x,M+=i[c].y,C+=t[c].x,O+=t[c].y;for(x/=f,M/=f,C/=f,O/=f,c=0;c<f;++c)y+=Math.abs(i[c].x-x),g+=Math.abs(i[c].y-M),k+=Math.abs(t[c].x-C),z+=Math.abs(t[c].y-O);if(Math.abs(y)<r.EPSILON||Math.abs(g)<r.EPSILON||Math.abs(k)<r.EPSILON||Math.abs(z)<r.EPSILON)return 0;for(y=f/y,g=f/g,k=f/k,z=f/z,d[0]=k,d[1]=0,d[2]=-C*k,d[3]=0,d[4]=z,d[5]=-O*z,d[6]=0,d[7]=0,d[8]=1,l[0]=1/y,l[1]=0,l[2]=x,l[3]=0,l[4]=1/g,l[5]=M,l[6]=0,l[7]=0,l[8]=1,c=81;--c>=0;)_[c]=0;for(c=0;c<f;++c)p=(i[c].x-x)*y,b=(i[c].y-M)*g,m=(t[c].x-C)*k,w=(t[c].y-O)*z,_[0]+=m*m,_[1]+=m*w,_[2]+=m,_[6]+=m*-p*m,_[7]+=m*-p*w,_[8]+=m*-p,_[10]+=w*w,_[11]+=w,_[15]+=w*-p*m,_[16]+=w*-p*w,_[17]+=w*-p,_[20]+=1,_[24]+=-p*m,_[25]+=-p*w,_[26]+=-p,_[30]+=m*m,_[31]+=m*w,_[32]+=m,_[33]+=m*-b*m,_[34]+=m*-b*w,_[35]+=m*-b,_[40]+=w*w,_[41]+=w,_[42]+=w*-b*m,_[43]+=w*-b*w,_[44]+=w*-b,_[50]+=1,_[51]+=-b*m,_[52]+=-b*w,_[53]+=-b,_[60]+=-p*m*-p*m+-b*m*-b*m,_[61]+=-p*m*-p*w+-b*m*-b*w,_[62]+=-p*m*-p+-b*m*-b,_[70]+=-p*w*-p*w+-b*w*-b*w,_[71]+=-p*w*-p+-b*w*-b,_[80]+=-p*-p+-b*-b;for(c=0;c<9;++c)for(u=0;u<c;++u)_[9*c+u]=_[9*u+c];return r.linalg.eigenVV(o,s),h[0]=v[72],h[1]=v[73],h[2]=v[74],h[3]=v[75],h[4]=v[76],h[5]=v[77],h[6]=v[78],h[7]=v[79],h[8]=v[80],r.matmath.multiply_3x3(n,a,n),r.matmath.multiply_3x3(n,n,e),p=1/h[8],h[0]*=p,h[1]*=p,h[2]*=p,h[3]*=p,h[4]*=p,h[5]*=p,h[6]*=p,h[7]*=p,h[8]=1,1},t.prototype.error=function(t,e,r,a,i){for(var n,f,o=0,s=0,c=0,u=0,h=r.data;o<i;++o)n=t[o],f=e[o],s=1/(h[6]*n.x+h[7]*n.y+1),c=(h[0]*n.x+h[1]*n.y+h[2])*s-f.x,u=(h[3]*n.x+h[4]*n.y+h[5])*s-f.y,a[o]=c*c+u*u},t.prototype.check_subset=function(t,e,a){if(4==a){var i=0,n=t[0],f=t[1],o=t[2],s=t[3],c=e[0],u=e[1],h=e[2],d=e[3],l=n.x,_=n.y,v=f.x,p=f.y,b=o.x,m=o.y,w=c.x,y=c.y,g=u.x,x=u.y,M=h.x,k=h.y,z=r.matmath.determinant_3x3(l,_,1,v,p,1,b,m,1),C=r.matmath.determinant_3x3(w,y,1,g,x,1,M,k,1);if(z*C<0&&i++,l=f.x,_=f.y,v=o.x,p=o.y,b=s.x,m=s.y,w=u.x,y=u.y,g=h.x,x=h.y,M=d.x,k=d.y,z=r.matmath.determinant_3x3(l,_,1,v,p,1,b,m,1),C=r.matmath.determinant_3x3(w,y,1,g,x,1,M,k,1),z*C<0&&i++,l=n.x,_=n.y,v=o.x,p=o.y,b=s.x,m=s.y,w=c.x,y=c.y,g=h.x,x=h.y,M=d.x,k=d.y,z=r.matmath.determinant_3x3(l,_,1,v,p,1,b,m,1),C=r.matmath.determinant_3x3(w,y,1,g,x,1,M,k,1),z*C<0&&i++,l=n.x,_=n.y,v=f.x,p=f.y,b=s.x,m=s.y,w=c.x,y=c.y,g=u.x,x=u.y,M=d.x,k=d.y,z=r.matmath.determinant_3x3(l,_,1,v,p,1,b,m,1),C=r.matmath.determinant_3x3(w,y,1,g,x,1,M,k,1),z*C<0&&i++,0!=i&&4!=i)return!1}return!0},t}()}}(),a=function(){function t(t,e,r,a){void 0===t&&(t=0),void 0===e&&(e=.5),void 0===r&&(r=.5),void 0===a&&(a=.99),this.size=t,this.thresh=e,this.eps=r,this.prob=a}return t.prototype.update_iters=function(t,e){var r=Math.log(1-this.prob),a=Math.log(1-Math.pow(1-t,this.size));return 0|(a>=0||-r>=e*-a?e:Math.round(r/a))},t}(),i=function(){var t=function(t,e,r,a,i,n,f){for(var o=[],s=0,c=0,u=0,h=0,d=!1;u<1e3;++u){for(s=0;s<a&&u<1e3;){for(d=!1,h=0;!d;)for(d=!0,h=o[s]=0|Math.floor(Math.random()*i),c=0;c<s;++c)if(h==o[c]){d=!1;break}n[s]=e[h],f[s]=r[h],t.check_subset(n,f,s+1)?++s:u++}break}return s==a&&u<1e3},e=function(t,e,r,a,i,n,f,o){var s=0,c=0,u=0,h=n*n;for(t.error(r,a,e,f,i);c<i;++c)u=f[c]<=h,o[c]=u,s+=u;return s};return{ransac:function(a,i,n,f,o,s,c,u){if(void 0===u&&(u=1e3),o<a.size)return!1;var h=a.size,d=u,l=0,_=!1,v=[],p=[],b=s.cols,m=s.rows,w=s.type|r.C1_t,y=r.cache.get_buffer(b*m<<3),g=r.cache.get_buffer(o),x=r.cache.get_buffer(o<<2),M=new r.matrix_t(b,m,w,y.data),k=new r.matrix_t(o,1,r.U8C1_t,g.data),z=-1,C=0,O=x.f32;if(o==h){if(i.run(n,f,M,o)<=0)return r.cache.put_buffer(y),r.cache.put_buffer(g),r.cache.put_buffer(x),!1;if(M.copy_to(s),c)for(;--o>=0;)c.data[o]=1;return r.cache.put_buffer(y),r.cache.put_buffer(g),r.cache.put_buffer(x),!0}for(;l<d;++l){if(!t(i,n,f,h,o,v,p)){if(0==l)return r.cache.put_buffer(y),r.cache.put_buffer(g),r.cache.put_buffer(x),!1;break}i.run(v,p,M,h)<=0||(C=e(i,M,n,f,o,a.thresh,O,k.data))>Math.max(z,h-1)&&(M.copy_to(s),z=C,c&&k.copy_to(c),d=a.update_iters((o-C)/o,d),_=!0)}return r.cache.put_buffer(y),r.cache.put_buffer(g),r.cache.put_buffer(x),_},lmeds:function(a,i,n,f,o,s,c,u){if(void 0===u&&(u=1e3),o<a.size)return!1;var h=a.size,d=u,l=0,_=!1,v=[],p=[],b=s.cols,m=s.rows,w=s.type|r.C1_t,y=r.cache.get_buffer(b*m<<3),g=r.cache.get_buffer(o),x=r.cache.get_buffer(o<<2),M=new r.matrix_t(b,m,w,y.data),k=new r.matrix_t(o,1,r.U8_t|r.C1_t,g.data),z=0,C=x.f32,O=1e9,A=0,R=0;if(a.eps=.45,d=a.update_iters(a.eps,d),o==h){if(i.run(n,f,M,o)<=0)return r.cache.put_buffer(y),r.cache.put_buffer(g),r.cache.put_buffer(x),!1;if(M.copy_to(s),c)for(;--o>=0;)c.data[o]=1;return r.cache.put_buffer(y),r.cache.put_buffer(g),r.cache.put_buffer(x),!0}for(;l<d;++l){if(!t(i,n,f,h,o,v,p)){if(0==l)return r.cache.put_buffer(y),r.cache.put_buffer(g),r.cache.put_buffer(x),!1;break}i.run(v,p,M,h)<=0||(i.error(n,f,M,C,o),(R=r.math.median(C,0,o-1))<O&&(O=R,M.copy_to(s),_=!0))}return _&&(A=2.5*1.4826*(1+5/(o-h))*Math.sqrt(O),A=Math.max(A,.001),z=e(i,s,n,f,o,A,C,k.data),c&&k.copy_to(c),_=z>=h),r.cache.put_buffer(y),r.cache.put_buffer(g),r.cache.put_buffer(x),_}}}();t.ransac_params_t=a,t.motion_model=e,t.motion_estimator=i}(r),function(t){"use strict";var e={grayscale:function(t,e,a,i,n){void 0===n&&(n=r.COLOR_RGBA2GRAY);var f=0,o=0,s=0,c=0,u=0,h=0,d=4899,l=1868,_=4;n!=r.COLOR_BGRA2GRAY&&n!=r.COLOR_BGR2GRAY||(d=1868,l=4899),n!=r.COLOR_RGB2GRAY&&n!=r.COLOR_BGR2GRAY||(_=3);var v=_<<1,p=3*_|0;i.resize(e,a,1);var b=i.data;for(o=0;o<a;++o,c+=e,s+=e*_){for(f=0,u=s,h=c;f<=e-4;f+=4,u+=_<<2,h+=4)b[h]=t[u]*d+9617*t[u+1]+t[u+2]*l+8192>>14,b[h+1]=t[u+_]*d+9617*t[u+_+1]+t[u+_+2]*l+8192>>14,b[h+2]=t[u+v]*d+9617*t[u+v+1]+t[u+v+2]*l+8192>>14,b[h+3]=t[u+p]*d+9617*t[u+p+1]+t[u+p+2]*l+8192>>14;for(;f<e;++f,++h,u+=_)b[h]=t[u]*d+9617*t[u+1]+t[u+2]*l+8192>>14}},resample:function(t,e,a,i){var n=t.rows,f=t.cols;n>i&&f>a&&(e.resize(a,i,t.channel),t.type&r.U8_t&&e.type&r.U8_t&&n*f/(i*a)<256?function(t,e,a,i){for(var n=0,f=t.channel,o=t.cols,s=t.rows,c=t.data,u=e.data,h=o/a,d=s/i,l=h*d*65536|0,_=0,v=0,p=0,b=0,m=0,w=0,y=0,g=0,x=0,M=0,k=0,z=0,C=0,O=0,A=0,R=0,L=r.cache.get_buffer(a*f<<2),B=r.cache.get_buffer(a*f<<2),T=r.cache.get_buffer(2*o*3<<2),E=L.i32,S=B.i32,U=T.i32;_<a;_++){for(m=1+(x=_*h)-1e-6|0,w=0|(M=x+h),m=Math.min(m,o-1),w=Math.min(w,o-1),m>x&&(U[g++]=_*f|0,U[g++]=(m-1)*f|0,U[g++]=256*(m-x)|0,n++),p=m;p<w;p++)n++,U[g++]=_*f|0,U[g++]=p*f|0,U[g++]=256;M-w>.001&&(n++,U[g++]=_*f|0,U[g++]=w*f|0,U[g++]=256*(M-w)|0)}for(_=0;_<a*f;_++)E[_]=S[_]=0;for(v=0,b=0;b<s;b++){for(k=o*b,g=0;g<n;g++)for(C=U[3*g],m=U[3*g+1],O=U[3*g+2],y=0;y<f;y++)E[C+y]+=c[k+m+y]*O;if((v+1)*d<=b+1||b==s-1){if(A=256*Math.max(b+1-(v+1)*d,0)|0,R=256-A,z=a*v,A<=0)for(_=0;_<a*f;_++)u[z+_]=Math.min(Math.max((S[_]+256*E[_])/l,0),255),S[_]=E[_]=0;else for(_=0;_<a*f;_++)u[z+_]=Math.min(Math.max((S[_]+E[_]*R)/l,0),255),S[_]=E[_]*A,E[_]=0;v++}else for(_=0;_<a*f;_++)S[_]+=256*E[_],E[_]=0}r.cache.put_buffer(B),r.cache.put_buffer(L),r.cache.put_buffer(T)}(t,e,a,i):function(t,e,a,i){for(var n=0,f=t.channel,o=t.cols,s=t.rows,c=t.data,u=e.data,h=o/a,d=s/i,l=1/(h*d),_=0,v=0,p=0,b=0,m=0,w=0,y=0,g=0,x=0,M=0,k=0,z=0,C=0,O=0,A=0,R=0,L=r.cache.get_buffer(a*f<<2),B=r.cache.get_buffer(a*f<<2),T=r.cache.get_buffer(2*o*3<<2),E=L.f32,S=B.f32,U=T.f32;_<a;_++){for(m=1+(x=_*h)-1e-6|0,w=0|(M=x+h),m=Math.min(m,o-1),w=Math.min(w,o-1),m>x&&(n++,U[g++]=(m-1)*f|0,U[g++]=_*f|0,U[g++]=(m-x)*l),p=m;p<w;p++)n++,U[g++]=p*f|0,U[g++]=_*f|0,U[g++]=l;M-w>.001&&(n++,U[g++]=w*f|0,U[g++]=_*f|0,U[g++]=(M-w)*l)}for(_=0;_<a*f;_++)E[_]=S[_]=0;for(v=0,b=0;b<s;b++){for(k=o*b,g=0;g<n;g++)for(m=0|U[3*g],C=0|U[3*g+1],O=U[3*g+2],y=0;y<f;y++)E[C+y]+=c[k+m+y]*O;if((v+1)*d<=b+1||b==s-1){if(A=Math.max(b+1-(v+1)*d,0),R=1-A,z=a*v,Math.abs(A)<.001)for(_=0;_<a*f;_++)u[z+_]=S[_]+E[_],S[_]=E[_]=0;else for(_=0;_<a*f;_++)u[z+_]=S[_]+E[_]*R,S[_]=E[_]*A,E[_]=0;v++}else for(_=0;_<a*f;_++)S[_]+=E[_],E[_]=0}r.cache.put_buffer(B),r.cache.put_buffer(L),r.cache.put_buffer(T)}(t,e,a,i))},box_blur_gray:function(t,e,a,i){void 0===i&&(i=0);var n=t.cols,f=t.rows,o=f<<1,s=n<<1,c=0,u=0,h=0,d=0,l=1+(a<<1)|0,_=a+1|0,v=_+1|0,p=i&r.BOX_BLUR_NOSCALE?1:1/(l*l),b=r.cache.get_buffer(n*f<<2),m=0,w=0,y=0,g=0,x=0,M=b.i32,k=t.data,z=0;for(e.resize(n,f,t.channel),h=0;h<f;++h){for(w=h,m=_*k[y],c=y+1|0,d=y+a|0;c<=d;++c)m+=k[c];for(g=y+_|0,z=k[x=y],u=0;u<a;++u,w+=f)M[w]=m,m+=k[g]-z,g++;for(;u<n-v;u+=2,w+=o)M[w]=m,m+=k[g]-k[x],M[w+f]=m,m+=k[g+1]-k[x+1],g+=2,x+=2;for(;u<n-_;++u,w+=f)M[w]=m,m+=k[g]-k[x],g++,x++;for(z=k[g-1];u<n;++u,w+=f)M[w]=m,m+=z-k[x],x++;y+=n}if(y=0,k=e.data,1==p)for(h=0;h<n;++h){for(w=h,m=_*M[y],c=y+1|0,d=y+a|0;c<=d;++c)m+=M[c];for(g=y+_,z=M[x=y],u=0;u<a;++u,w+=n)k[w]=m,m+=M[g]-z,g++;for(;u<f-v;u+=2,w+=s)k[w]=m,m+=M[g]-M[x],k[w+n]=m,m+=M[g+1]-M[x+1],g+=2,x+=2;for(;u<f-_;++u,w+=n)k[w]=m,m+=M[g]-M[x],g++,x++;for(z=M[g-1];u<f;++u,w+=n)k[w]=m,m+=z-M[x],x++;y+=f}else for(h=0;h<n;++h){for(w=h,m=_*M[y],c=y+1|0,d=y+a|0;c<=d;++c)m+=M[c];for(g=y+_,z=M[x=y],u=0;u<a;++u,w+=n)k[w]=m*p,m+=M[g]-z,g++;for(;u<f-v;u+=2,w+=s)k[w]=m*p,m+=M[g]-M[x],k[w+n]=m*p,m+=M[g+1]-M[x+1],g+=2,x+=2;for(;u<f-_;++u,w+=n)k[w]=m*p,m+=M[g]-M[x],g++,x++;for(z=M[g-1];u<f;++u,w+=n)k[w]=m*p,m+=z-M[x],x++;y+=f}r.cache.put_buffer(b)},gaussian_blur:function(t,e,a,i){void 0===i&&(i=0),void 0===a&&(a=0);var n=(a=0==a?2*Math.max(1,4*i+1-1e-8)+1|0:a)>>1,f=t.cols,o=t.rows,s=t.type,c=s&r.U8_t;e.resize(f,o,t.channel);var u,h,d=t.data,l=e.data,_=a+Math.max(o,f)|0,v=r.cache.get_buffer(_<<2),p=r.cache.get_buffer(a<<2);c?(u=v.i32,h=p.i32):s&r.S32_t?(u=v.i32,h=p.f32):(u=v.f32,h=p.f32),r.math.get_gaussian_kernel(a,i,h,s),c?function(t,e,r,a,i,n,f,o){for(var s=0,c=0,u=0,h=0,d=0,l=0,_=0,v=0,p=0,b=n[0],m=0,w=a<<1,y=3*a,g=a<<2;s<i;++s){for(l=e[h],c=0;c<o;++c)t[c]=l;for(c=0;c<=a-2;c+=2)t[c+o]=e[h+c],t[c+o+1]=e[h+c+1];for(;c<a;++c)t[c+o]=e[h+c];for(l=e[h+a-1],c=a;c<o+a;++c)t[c+o]=l;for(c=0;c<=a-4;c+=4){for(l=t[c]*b,_=t[c+1]*b,v=t[c+2]*b,p=t[c+3]*b,u=1;u<f;++u)m=n[u],l+=t[u+c]*m,_+=t[u+c+1]*m,v+=t[u+c+2]*m,p+=t[u+c+3]*m;r[d+c]=Math.min(l>>8,255),r[d+c+1]=Math.min(_>>8,255),r[d+c+2]=Math.min(v>>8,255),r[d+c+3]=Math.min(p>>8,255)}for(;c<a;++c){for(l=t[c]*b,u=1;u<f;++u)l+=t[u+c]*n[u];r[d+c]=Math.min(l>>8,255)}h+=a,d+=a}for(s=0;s<a;++s){for(l=r[s],c=0;c<o;++c)t[c]=l;for(u=s,c=0;c<=i-2;c+=2,u+=w)t[c+o]=r[u],t[c+o+1]=r[u+a];for(;c<i;++c,u+=a)t[c+o]=r[u];for(l=r[(i-1)*a+s],c=i;c<o+i;++c)t[c+o]=l;for(d=s,c=0;c<=i-4;c+=4,d+=g){for(l=t[c]*b,_=t[c+1]*b,v=t[c+2]*b,p=t[c+3]*b,u=1;u<f;++u)m=n[u],l+=t[u+c]*m,_+=t[u+c+1]*m,v+=t[u+c+2]*m,p+=t[u+c+3]*m;r[d]=Math.min(l>>8,255),r[d+a]=Math.min(_>>8,255),r[d+w]=Math.min(v>>8,255),r[d+y]=Math.min(p>>8,255)}for(;c<i;++c,d+=a){for(l=t[c]*b,u=1;u<f;++u)l+=t[u+c]*n[u];r[d]=Math.min(l>>8,255)}}}(u,d,l,f,o,h,a,n):function(t,e,r,a,i,n,f,o){for(var s=0,c=0,u=0,h=0,d=0,l=0,_=0,v=0,p=0,b=n[0],m=0,w=a<<1,y=3*a,g=a<<2;s<i;++s){for(l=e[h],c=0;c<o;++c)t[c]=l;for(c=0;c<=a-2;c+=2)t[c+o]=e[h+c],t[c+o+1]=e[h+c+1];for(;c<a;++c)t[c+o]=e[h+c];for(l=e[h+a-1],c=a;c<o+a;++c)t[c+o]=l;for(c=0;c<=a-4;c+=4){for(l=t[c]*b,_=t[c+1]*b,v=t[c+2]*b,p=t[c+3]*b,u=1;u<f;++u)m=n[u],l+=t[u+c]*m,_+=t[u+c+1]*m,v+=t[u+c+2]*m,p+=t[u+c+3]*m;r[d+c]=l,r[d+c+1]=_,r[d+c+2]=v,r[d+c+3]=p}for(;c<a;++c){for(l=t[c]*b,u=1;u<f;++u)l+=t[u+c]*n[u];r[d+c]=l}h+=a,d+=a}for(s=0;s<a;++s){for(l=r[s],c=0;c<o;++c)t[c]=l;for(u=s,c=0;c<=i-2;c+=2,u+=w)t[c+o]=r[u],t[c+o+1]=r[u+a];for(;c<i;++c,u+=a)t[c+o]=r[u];for(l=r[(i-1)*a+s],c=i;c<o+i;++c)t[c+o]=l;for(d=s,c=0;c<=i-4;c+=4,d+=g){for(l=t[c]*b,_=t[c+1]*b,v=t[c+2]*b,p=t[c+3]*b,u=1;u<f;++u)m=n[u],l+=t[u+c]*m,_+=t[u+c+1]*m,v+=t[u+c+2]*m,p+=t[u+c+3]*m;r[d]=l,r[d+a]=_,r[d+w]=v,r[d+y]=p}for(;c<i;++c,d+=a){for(l=t[c]*b,u=1;u<f;++u)l+=t[u+c]*n[u];r[d]=l}}}(u,d,l,f,o,h,a,n),r.cache.put_buffer(v),r.cache.put_buffer(p)},pyrdown:function(t,e,r,a){void 0===r&&(r=0),void 0===a&&(a=0);var i=t.cols,n=i>>1,f=t.rows>>1,o=n-(r<<1),s=f-(a<<1),c=0,u=0,h=r+a*i,d=0,l=0,_=0;e.resize(n,f,t.channel);var v=t.data,p=e.data;for(u=0;u<s;++u){for(d=h,_=l,c=0;c<=o-2;c+=2,_+=2,d+=4)p[_]=v[d]+v[d+1]+v[d+i]+v[d+i+1]+2>>2,p[_+1]=v[d+2]+v[d+3]+v[d+i+2]+v[d+i+3]+2>>2;for(;c<o;++c,++_,d+=2)p[_]=v[d]+v[d+1]+v[d+i]+v[d+i+1]+2>>2;h+=i<<1,l+=n}},scharr_derivatives:function(t,e){var a,i,n,f,o,s,c,u,h=t.cols,d=t.rows,l=h<<1,_=0,v=0,p=0,b=0,m=0,w=0,y=0;e.resize(h,d,2);var g=t.data,x=e.data,M=r.cache.get_buffer(h+2<<2),k=r.cache.get_buffer(h+2<<2);for(t.type&r.U8_t||t.type&r.S32_t?(c=M.i32,u=k.i32):(c=M.f32,u=k.f32);v<d;++v,m+=h){for(b=(v>0?v-1:1)*h|0,w=(v<d-1?v+1:d-2)*h|0,y=v*l|0,_=0,p=1;_<=h-2;_+=2,p+=2)a=g[b+_],i=g[w+_],c[p]=3*(a+i)+10*g[m+_],u[p]=i-a,a=g[b+_+1],i=g[w+_+1],c[p+1]=3*(a+i)+10*g[m+_+1],u[p+1]=i-a;for(;_<h;++_,++p)a=g[b+_],i=g[w+_],c[p]=3*(a+i)+10*g[m+_],u[p]=i-a;for(_=h+1|0,c[0]=c[1],c[_]=c[h],u[0]=u[1],u[_]=u[h],_=0;_<=h-4;_+=4)a=u[_+2],i=u[_+1],n=u[_+3],f=u[_+4],o=c[_+2],s=c[_+3],x[y++]=o-c[_],x[y++]=3*(a+u[_])+10*i,x[y++]=s-c[_+1],x[y++]=3*(n+i)+10*a,x[y++]=c[_+4]-o,x[y++]=3*(f+a)+10*n,x[y++]=c[_+5]-s,x[y++]=3*(u[_+5]+n)+10*f;for(;_<h;++_)x[y++]=c[_+2]-c[_],x[y++]=3*(u[_+2]+u[_])+10*u[_+1]}r.cache.put_buffer(M),r.cache.put_buffer(k)},sobel_derivatives:function(t,e){var a,i,n,f,o,s,c,u,h=t.cols,d=t.rows,l=h<<1,_=0,v=0,p=0,b=0,m=0,w=0,y=0;e.resize(h,d,2);var g=t.data,x=e.data,M=r.cache.get_buffer(h+2<<2),k=r.cache.get_buffer(h+2<<2);for(t.type&r.U8_t||t.type&r.S32_t?(c=M.i32,u=k.i32):(c=M.f32,u=k.f32);v<d;++v,m+=h){for(b=(v>0?v-1:1)*h|0,w=(v<d-1?v+1:d-2)*h|0,y=v*l|0,_=0,p=1;_<=h-2;_+=2,p+=2)a=g[b+_],i=g[w+_],c[p]=a+i+2*g[m+_],u[p]=i-a,a=g[b+_+1],i=g[w+_+1],c[p+1]=a+i+2*g[m+_+1],u[p+1]=i-a;for(;_<h;++_,++p)a=g[b+_],i=g[w+_],c[p]=a+i+2*g[m+_],u[p]=i-a;for(_=h+1|0,c[0]=c[1],c[_]=c[h],u[0]=u[1],u[_]=u[h],_=0;_<=h-4;_+=4)a=u[_+2],i=u[_+1],n=u[_+3],f=u[_+4],o=c[_+2],s=c[_+3],x[y++]=o-c[_],x[y++]=a+u[_]+2*i,x[y++]=s-c[_+1],x[y++]=n+i+2*a,x[y++]=c[_+4]-o,x[y++]=f+a+2*n,x[y++]=c[_+5]-s,x[y++]=u[_+5]+n+2*f;for(;_<h;++_)x[y++]=c[_+2]-c[_],x[y++]=u[_+2]+u[_]+2*u[_+1]}r.cache.put_buffer(M),r.cache.put_buffer(k)},compute_integral_image:function(t,e,r,a){var i=0|t.cols,n=0|t.rows,f=t.data,o=i+1|0,s=0,c=0,u=0,h=0,d=0,l=0,_=0,v=0;if(e&&r){for(;d<o;++d)e[d]=0,r[d]=0;for(u=o+1|0,h=1,d=0,v=0;d<n;++d,++u,++h){for(s=c=0,l=0;l<=i-2;l+=2,v+=2,u+=2,h+=2)s+=_=f[v],c+=_*_,e[u]=e[h]+s,r[u]=r[h]+c,s+=_=f[v+1],c+=_*_,e[u+1]=e[h+1]+s,r[u+1]=r[h+1]+c;for(;l<i;++l,++v,++u,++h)s+=_=f[v],c+=_*_,e[u]=e[h]+s,r[u]=r[h]+c}}else if(e){for(;d<o;++d)e[d]=0;for(u=o+1|0,h=1,d=0,v=0;d<n;++d,++u,++h){for(s=0,l=0;l<=i-2;l+=2,v+=2,u+=2,h+=2)s+=f[v],e[u]=e[h]+s,s+=f[v+1],e[u+1]=e[h+1]+s;for(;l<i;++l,++v,++u,++h)s+=f[v],e[u]=e[h]+s}}else if(r){for(;d<o;++d)r[d]=0;for(u=o+1|0,h=1,d=0,v=0;d<n;++d,++u,++h){for(c=0,l=0;l<=i-2;l+=2,v+=2,u+=2,h+=2)c+=(_=f[v])*_,r[u]=r[h]+c,c+=(_=f[v+1])*_,r[u+1]=r[h+1]+c;for(;l<i;++l,++v,++u,++h)c+=(_=f[v])*_,r[u]=r[h]+c}}if(a){for(d=0;d<o;++d)a[d]=0;for(u=o+1|0,h=0,d=0,v=0;d<n;++d,++u,++h){for(l=0;l<=i-2;l+=2,v+=2,u+=2,h+=2)a[u]=f[v]+a[h],a[u+1]=f[v+1]+a[h+1];for(;l<i;++l,++v,++u,++h)a[u]=f[v]+a[h]}for(u=o+i|0,h=i,d=0;d<n;++d,u+=o,h+=o)a[u]+=a[h];for(l=i-1;l>0;--l)for(h=(u=l+n*o)-o,d=n;d>0;--d,u-=o,h-=o)a[u]+=a[h]+a[h+1]}},equalize_histogram:function(t,e){var a=t.cols,i=t.rows,n=t.data;e.resize(a,i,t.channel);var f,o,s=e.data,c=a*i,u=0,h=0,d=r.cache.get_buffer(1024);for(f=d.i32;u<256;++u)f[u]=0;for(u=0;u<c;++u)++f[n[u]];for(h=f[0],u=1;u<256;++u)h=f[u]+=h;for(o=255/c,u=0;u<c;++u)s[u]=f[n[u]]*o+.5|0;r.cache.put_buffer(d)},canny:function(t,e,a,i){var n=t.cols,f=t.rows;t.data;e.resize(n,f,t.channel);var o=e.data,s=0,c=0,u=0,h=n<<1,d=0,l=0,_=0,v=0,p=0,b=0,m=0,w=0,y=r.cache.get_buffer(f*h<<2),g=r.cache.get_buffer(3*(n+2)<<2),x=r.cache.get_buffer((f+2)*(n+2)<<2),M=r.cache.get_buffer(f*n<<2),k=g.i32,z=x.i32,C=M.i32,O=y.i32,A=new r.matrix_t(n,f,r.S32C2_t,y.data),R=1,L=n+2+1|0,B=2*(n+2)+1|0,T=n+2|0,E=T+1|0,S=0;for(this.sobel_derivatives(t,A),a>i&&(s=a,a=i,i=s),s=3*(n+2)|0;--s>=0;)k[s]=0;for(s=(f+2)*(n+2)|0;--s>=0;)z[s]=0;for(;c<n;++c,u+=2)v=O[u],p=O[u+1],k[L+c]=(v^v>>31)-(v>>31)+((p^p>>31)-(p>>31));for(s=1;s<=f;++s,u+=h){if(s==f)for(c=B+n;--c>=B;)k[c]=0;else for(c=0;c<n;c++)v=O[u+(c<<1)],p=O[u+(c<<1)+1],k[B+c]=(v^v>>31)-(v>>31)+((p^p>>31)-(p>>31));for(d=u-h|0,z[E-1]=0,l=0,c=0;c<n;++c,d+=2){if((_=k[L+c])>a)if(v=O[d],p=O[d+1],b=v^p,v=(v^v>>31)-(v>>31)|0,p=(p^p>>31)-(p>>31)|0,m=13573*v,w=m+(v+v<<15),(p<<=15)<m){if(_>k[L+c-1]&&_>=k[L+c+1]){_>i&&!l&&2!=z[E+c-T]?(z[E+c]=2,l=1,C[S++]=E+c):z[E+c]=1;continue}}else if(p>w){if(_>k[R+c]&&_>=k[B+c]){_>i&&!l&&2!=z[E+c-T]?(z[E+c]=2,l=1,C[S++]=E+c):z[E+c]=1;continue}}else if(b=b<0?-1:1,_>k[R+c-b]&&_>k[B+c+b]){_>i&&!l&&2!=z[E+c-T]?(z[E+c]=2,l=1,C[S++]=E+c):z[E+c]=1;continue}z[E+c]=0,l=0}z[E+n]=0,E+=T,c=R,R=L,L=B,B=c}for(c=E-T-1,s=0;s<T;++s,++c)z[c]=0;for(;S>0;)E=C[--S],1==z[E-=T+1]&&(z[E]=2,C[S++]=E),1==z[E+=1]&&(z[E]=2,C[S++]=E),1==z[E+=1]&&(z[E]=2,C[S++]=E),1==z[E+=T]&&(z[E]=2,C[S++]=E),1==z[E-=2]&&(z[E]=2,C[S++]=E),1==z[E+=T]&&(z[E]=2,C[S++]=E),1==z[E+=1]&&(z[E]=2,C[S++]=E),1==z[E+=1]&&(z[E]=2,C[S++]=E);for(E=T+1,R=0,s=0;s<f;++s,E+=T)for(c=0;c<n;++c)o[R++]=255*(2==z[E+c]);r.cache.put_buffer(y),r.cache.put_buffer(g),r.cache.put_buffer(x),r.cache.put_buffer(M)},warp_perspective:function(t,e,r,a){void 0===a&&(a=0);for(var i=0|t.cols,n=0|t.rows,f=0|e.cols,o=0|e.rows,s=t.data,c=e.data,u=0,h=0,d=0,l=0,_=0,v=0,p=0,b=0,m=0,w=0,y=0,g=0,x=0,M=0,k=0,z=r.data,C=z[0],O=z[1],A=z[2],R=z[3],L=z[4],B=z[5],T=z[6],E=z[7],S=z[8],U=0;h<o;++h)for(b=O*h+A,m=L*h+B,w=E*h+S,u=0;u<f;++u,++U,b+=C,m+=R,w+=T)l=0|(v=b*(y=1/w)),_=0|(p=m*y),v>0&&p>0&&l<i-1&&_<n-1?(g=Math.max(v-l,0),x=Math.max(p-_,0),M=s[d=i*_+l|0]+g*(s[d+1]-s[d]),k=s[d+i]+g*(s[d+i+1]-s[d+i]),c[U]=M+x*(k-M)):c[U]=a},warp_affine:function(t,e,r,a){void 0===a&&(a=0);for(var i=t.cols,n=t.rows,f=e.cols,o=e.rows,s=t.data,c=e.data,u=0,h=0,d=0,l=0,_=0,v=0,p=0,b=0,m=0,w=0,y=0,g=r.data,x=g[0],M=g[1],k=g[2],z=g[3],C=g[4],O=g[5],A=0;h<o;++h)for(v=M*h+k,p=C*h+O,u=0;u<f;++u,++A,v+=x,p+=z)_=0|p,(l=0|v)>=0&&_>=0&&l<i-1&&_<n-1?(b=v-l,m=p-_,w=s[d=i*_+l]+b*(s[d+1]-s[d]),y=s[d+i]+b*(s[d+i+1]-s[d+i]),c[A]=w+m*(y-w)):c[A]=a},skindetector:function(t,e){for(var r,a,i,n,f=t.width*t.height;f--;)n=4*f,r=t.data[n],a=t.data[n+1],i=t.data[n+2],r>95&&a>40&&i>20&&r>a&&r>i&&r-Math.min(a,i)>15&&Math.abs(r-a)>15?e[f]=255:e[f]=0}};r.imgproc=e}(),function(t){"use strict";var e=function(){var t=new Int32Array([0,3,1,3,2,2,3,1,3,0,3,-1,2,-2,1,-3,0,-3,-1,-3,-2,-2,-3,-1,-3,0,-3,1,-2,2,-1,3]),e=new Uint8Array(512),a=new Int32Array(25),i=new Int32Array(25),n=function(t,e,r,a,i){for(var n=0,f=t[e],o=i,s=0,c=0,u=0;n<25;++n)a[n]=f-t[e+r[n]];for(n=0;n<16;n+=2)s=Math.min(a[n+1],a[n+2]),(s=Math.min(s,a[n+3]))<=o||(s=Math.min(s,a[n+4]),s=Math.min(s,a[n+5]),s=Math.min(s,a[n+6]),s=Math.min(s,a[n+7]),s=Math.min(s,a[n+8]),o=Math.max(o,Math.min(s,a[n])),o=Math.max(o,Math.min(s,a[n+9])));for(c=-o,n=0;n<16;n+=2)u=Math.max(a[n+1],a[n+2]),u=Math.max(u,a[n+3]),u=Math.max(u,a[n+4]),(u=Math.max(u,a[n+5]))>=c||(u=Math.max(u,a[n+6]),u=Math.max(u,a[n+7]),u=Math.max(u,a[n+8]),c=Math.min(c,Math.max(u,a[n])),c=Math.min(c,Math.max(u,a[n+9])));return-c-1},f=20;return{set_threshold:function(t){f=Math.min(Math.max(t,0),255);for(var r=-255;r<=255;++r)e[r+255]=r<-f?1:r>f?2:0;return f},detect:function(o,s,c){void 0===c&&(c=3);var u,h=o.data,d=o.cols,l=o.rows,_=0,v=0,p=0,b=0,m=0,w=r.cache.get_buffer(3*d),y=r.cache.get_buffer(3*(d+1)<<2),g=w.u8,x=y.i32,M=a,k=i,z=Math.max(3,c),C=Math.min(l-2,l-c),O=Math.max(3,c),A=Math.min(d-3,d-c),R=0,L=0,B=n,T=e,E=f,S=0,U=0,V=0,W=0,H=0,F=0,G=0,I=0,q=0,P=0,N=0,j=0;!function(e,r,a){for(var i=0,n=t;i<a;++i)e[i]=n[i<<1]+n[1+(i<<1)]*r;for(;i<25;++i)e[i]=e[i-a]}(M,d,16);var D=M[0],Y=M[1],Q=M[2],X=M[3],J=M[4],K=M[5],Z=M[6],$=M[7],tt=M[8],et=M[9],rt=M[10],at=M[11],it=M[12],nt=M[13],ft=M[14],ot=M[15];for(_=0;_<3*d;++_)g[_]=0;for(_=z;_<C;++_){for(G=_*d+O|0,F=(m=(_-3)%3)*d|0,H=m*(d+1)|0,v=0;v<d;++v)g[F+v]=0;if(W=0,_<C-1)for(v=O;v<A;++v,++G)if(S=h[G],U=255-S,0!=(V=T[U+h[G+D]]|T[U+h[G+tt]])&&(V&=T[U+h[G+Q]]|T[U+h[G+rt]],V&=T[U+h[G+J]]|T[U+h[G+it]],0!=(V&=T[U+h[G+Z]]|T[U+h[G+ft]]))){if(V&=T[U+h[G+Y]]|T[U+h[G+et]],V&=T[U+h[G+X]]|T[U+h[G+at]],V&=T[U+h[G+K]]|T[U+h[G+nt]],1&(V&=T[U+h[G+$]]|T[U+h[G+ot]]))for(b=S-E,R=0,p=0;p<25;++p)if(h[G+M[p]]<b){if(++R>8){x[H+ ++W]=v,g[F+v]=B(h,G,M,k,E);break}}else R=0;if(2&V)for(b=S+E,R=0,p=0;p<25;++p)if(h[G+M[p]]>b){if(++R>8){x[H+ ++W]=v,g[F+v]=B(h,G,M,k,E);break}}else R=0}if(x[H+d]=W,_!=z)for(I=(m=(_-4+3)%3)*d|0,H=m*(d+1)|0,q=(m=(_-5+3)%3)*d|0,W=x[H+d],p=0;p<W;++p)P=(v=x[H+p])+1|0,N=v-1|0,(j=g[I+v])>g[I+P]&&j>g[I+N]&&j>g[q+N]&&j>g[q+v]&&j>g[q+P]&&j>g[F+N]&&j>g[F+v]&&j>g[F+P]&&((u=s[L]).x=v,u.y=_-1,u.score=j,L++)}return r.cache.put_buffer(w),r.cache.put_buffer(y),L}}}();t.fast_corners=e,e.set_threshold(20)}(r),function(t){"use strict";var e=function(){var t=function(t,e,r,a,i,n,f){var o=-2*t[e]+t[e+a]+t[e-a],s=-2*t[e]+t[e+i]+t[e-i],c=t[e+n]+t[e-n]-t[e+f]-t[e-f],u=0|Math.sqrt((o-s)*(o-s)+4*c*c);return Math.min(Math.abs(r-u),Math.abs(-(r+u)))};return{laplacian_threshold:30,min_eigen_value_threshold:25,detect:function(e,a,i){void 0===i&&(i=5);var n,f=0,o=0,s=e.cols,c=e.rows,u=e.data,h=5*s|0,d=3+3*s|0,l=3-3*s|0,_=r.cache.get_buffer(s*c<<2),v=_.i32,p=0,b=0,m=0,w=0,y=0,g=this.laplacian_threshold,x=this.min_eigen_value_threshold,M=0|Math.max(5,i),k=0|Math.max(3,i),z=0|Math.min(s-5,s-i),C=0|Math.min(c-3,c-i);for(f=s*c;--f>=0;)v[f]=0;for(function(t,e,r,a,i,n,f,o,s,c){var u=0,h=0,d=o*r+f|0,l=d;for(u=o;u<c;++u,d+=r,l=d)for(h=f;h<s;++h,++l)e[l]=-4*t[l]+t[l+i]+t[l-i]+t[l+n]+t[l-n]}(u,v,s,0,5,h,M,k,z,C),b=k*s+M|0,o=k;o<C;++o,b+=s)for(f=M,m=b;f<z;++f,++m)((p=v[m])<-g&&p<v[m-1]&&p<v[m+1]&&p<v[m-s]&&p<v[m+s]&&p<v[m-s-1]&&p<v[m+s-1]&&p<v[m-s+1]&&p<v[m+s+1]||p>g&&p>v[m-1]&&p>v[m+1]&&p>v[m-s]&&p>v[m+s]&&p>v[m-s-1]&&p>v[m+s-1]&&p>v[m-s+1]&&p>v[m+s+1])&&(w=t(u,m,p,5,h,d,l))>x&&((n=a[y]).x=f,n.y=o,n.score=w,++y,++f,++m);return r.cache.put_buffer(_),y}}}();t.yape06=e}(r),function(t){"use strict";var e=function(){var t=function(t,e,r){var a,i,n=0;for(a=r,i=0;i<a;i++,n++)a=Math.sqrt(r*r-i*i)+.5|0,e[n]=a+t*i;for(a--;a<i&&a>=0;a--,n++)i=Math.sqrt(r*r-a*a)+.5|0,e[n]=a+t*i;for(;-a<i;a--,n++)i=Math.sqrt(r*r-a*a)+.5|0,e[n]=a+t*i;for(i--;i>=0;i--,n++)a=-Math.sqrt(r*r-i*i)-.5|0,e[n]=a+t*i;for(;i>a;i--,n++)a=-Math.sqrt(r*r-i*i)-.5|0,e[n]=a+t*i;for(a++;a<=0;a++,n++)i=-Math.sqrt(r*r-a*a)-.5|0,e[n]=a+t*i;for(;a<-i;a++,n++)i=-Math.sqrt(r*r-a*a)-.5|0,e[n]=a+t*i;for(i++;i<0;i++,n++)a=Math.sqrt(r*r-i*i)+.5|0,e[n]=a+t*i;return e[n]=e[0],e[n+1]=e[1],n},e=function(t,e,r){var a=0;return 0!=t[e+1]&&a++,0!=t[e-1]&&a++,0!=t[e+r]&&a++,0!=t[e+r+1]&&a++,0!=t[e+r-1]&&a++,0!=t[e-r]&&a++,0!=t[e-r+1]&&a++,0!=t[e-r-1]&&a++,a},r=function(t,e,r,a,i){var n,f;if(r>0)for(e-=a*i,f=-i;f<=i;++f){for(n=-i;n<=i;++n)if(t[e+n]>r)return!1;e+=a}else for(e-=a*i,f=-i;f<=i;++f){for(n=-i;n<=i;++n)if(t[e+n]<r)return!1;e+=a}return!0},a=function(t,e,r,a,i,n,f,o){var s=0,c=0,u=f-1|0,h=0,d=0,l=0,_=0,v=0;if((h=t[e+n[c]])<=i)if(h>=a)if((d=t[e+n[u]])<=i){if(d>=a)return void(r[e]=0);if(u++,(l=t[e+n[u]])>i)if(u++,(_=t[e+n[u]])>i)v=3;else{if(!(_<a))return void(r[e]=0);v=6}else if(u++,(_=t[e+n[u]])>i)v=7;else{if(!(_<a))return void(r[e]=0);v=2}}else if(u++,(l=t[e+n[u]])>i)if(u++,(_=t[e+n[u]])>i)v=3;else{if(!(_<a))return void(r[e]=0);v=6}else{if(!(l<a))return void(r[e]=0);if(u++,(_=t[e+n[u]])>i)v=7;else{if(!(_<a))return void(r[e]=0);v=2}}else{if((d=t[e+n[u]])>i)return void(r[e]=0);if(u++,(l=t[e+n[u]])>i)return void(r[e]=0);if(u++,(_=t[e+n[u]])>i)return void(r[e]=0);v=1}else{if((d=t[e+n[u]])<a)return void(r[e]=0);if(u++,(l=t[e+n[u]])<a)return void(r[e]=0);if(u++,(_=t[e+n[u]])<a)return void(r[e]=0);v=0}for(c=1;c<=f;c++)switch(h=t[e+n[c]],v){case 0:if(h>i){if(l=_,u++,(_=t[e+n[u]])<a)return void(r[e]=0);s-=h+l,v=0;break}if(h<a){if(l>i)return void(r[e]=0);if(_>i)return void(r[e]=0);if(l=_,u++,(_=t[e+n[u]])>i)return void(r[e]=0);s-=h+l,v=8;break}if(l<=i)return void(r[e]=0);if(_<=i)return void(r[e]=0);if(l=_,u++,(_=t[e+n[u]])>i){s-=h+l,v=3;break}if(_<a){s-=h+l,v=6;break}return void(r[e]=0);case 1:if(h<a){if(l=_,u++,(_=t[e+n[u]])>i)return void(r[e]=0);s-=h+l,v=1;break}if(h>i){if(l<a)return void(r[e]=0);if(_<a)return void(r[e]=0);if(l=_,u++,(_=t[e+n[u]])<a)return void(r[e]=0);s-=h+l,v=9;break}if(l>=a)return void(r[e]=0);if(_>=a)return void(r[e]=0);if(l=_,u++,(_=t[e+n[u]])<a){s-=h+l,v=2;break}if(_>i){s-=h+l,v=7;break}return void(r[e]=0);case 2:if(h>i)return void(r[e]=0);if(l=_,u++,_=t[e+n[u]],h<a){if(_>i)return void(r[e]=0);s-=h+l,v=4;break}if(_>i){s-=h+l,v=7;break}if(_<a){s-=h+l,v=2;break}return void(r[e]=0);case 3:if(h<a)return void(r[e]=0);if(l=_,u++,_=t[e+n[u]],h>i){if(_<a)return void(r[e]=0);s-=h+l,v=5;break}if(_>i){s-=h+l,v=3;break}if(_<a){s-=h+l,v=6;break}return void(r[e]=0);case 4:if(h>i)return void(r[e]=0);if(h<a){if(l=_,u++,(_=t[e+n[u]])>i)return void(r[e]=0);s-=h+l,v=1;break}if(_>=a)return void(r[e]=0);if(l=_,u++,(_=t[e+n[u]])<a){s-=h+l,v=2;break}if(_>i){s-=h+l,v=7;break}return void(r[e]=0);case 5:if(h<a)return void(r[e]=0);if(h>i){if(l=_,u++,(_=t[e+n[u]])<a)return void(r[e]=0);s-=h+l,v=0;break}if(_<=i)return void(r[e]=0);if(l=_,u++,(_=t[e+n[u]])>i){s-=h+l,v=3;break}if(_<a){s-=h+l,v=6;break}return void(r[e]=0);case 7:if(h>i)return void(r[e]=0);if(h<a)return void(r[e]=0);if(l=_,u++,(_=t[e+n[u]])>i){s-=h+l,v=3;break}if(_<a){s-=h+l,v=6;break}return void(r[e]=0);case 6:if(h>i)return void(r[e]=0);if(h<a)return void(r[e]=0);if(l=_,u++,(_=t[e+n[u]])<a){s-=h+l,v=2;break}if(_>i){s-=h+l,v=7;break}return void(r[e]=0);case 8:if(h>i){if(_<a)return void(r[e]=0);if(l=_,u++,(_=t[e+n[u]])<a)return void(r[e]=0);s-=h+l,v=9;break}if(h<a){if(l=_,u++,(_=t[e+n[u]])>i)return void(r[e]=0);s-=h+l,v=1;break}return void(r[e]=0);case 9:if(h<a){if(_>i)return void(r[e]=0);if(l=_,u++,(_=t[e+n[u]])>i)return void(r[e]=0);s-=h+l,v=8;break}if(h>i){if(l=_,u++,(_=t[e+n[u]])<a)return void(r[e]=0);s-=h+l,v=0;break}return void(r[e]=0)}r[e]=s+o*t[e]},i=function(){return function(e,r,a){this.dirs=new Int32Array(1024),this.dirs_count=0|t(e,this.dirs,a),this.scores=new Int32Array(e*r),this.radius=0|a}}();return{level_tables:[],tau:7,init:function(t,e,r,a){void 0===a&&(a=1);var n;for(r=Math.min(r,7),r=Math.max(r,3),n=0;n<a;++n)this.level_tables[n]=new i(t>>n,e>>n,r)},detect:function(t,i,n){void 0===n&&(n=4);var f,o=this.level_tables[0],s=0|o.radius,c=s-1|0,u=o.dirs,h=0|o.dirs_count,d=h>>1,l=t.data,_=0|t.cols,v=0|t.rows,p=_>>1,b=o.scores,m=0,w=0,y=0,g=0,x=0,M=0,k=0,z=0,C=0|this.tau,O=0,A=0|Math.max(s+1,n),R=0|Math.max(s+1,n),L=0|Math.min(_-s-2,_-n),B=0|Math.min(v-s-2,v-n);for(y=R*_+A|0,w=R;w<B;++w,y+=_)for(m=A,g=y;m<L;++m,++g)x=l[g]+C,(M=l[g]-C)<l[g+s]&&l[g+s]<x&&M<l[g-s]&&l[g-s]<x?b[g]=0:a(l,g,b,M,x,u,d,h);for(y=R*_+A|0,w=R;w<B;++w,y+=_)for(m=A,g=y;m<L;++m,++g)z=b[g],(k=Math.abs(z))<5?(++m,++g):e(b,g,_)>=3&&r(b,g,z,p,s)&&((f=i[O]).x=m,f.y=w,f.score=k,++O,m+=c,g+=c);return O}}}();t.yape=e}(r),function(t){"use strict";var e=function(){var t=new Int32Array([8,-3,9,5,4,2,7,-12,-11,9,-8,2,7,-12,12,-13,2,-13,2,12,1,-7,1,6,-2,-10,-2,-4,-13,-13,-11,-8,-13,-3,-12,-9,10,4,11,9,-13,-8,-8,-9,-11,7,-9,12,7,7,12,6,-4,-5,-3,0,-13,2,-12,-3,-9,0,-7,5,12,-6,12,-1,-3,6,-2,12,-6,-13,-4,-8,11,-13,12,-8,4,7,5,1,5,-3,10,-3,3,-7,6,12,-8,-7,-6,-2,-2,11,-1,-10,-13,12,-8,10,-7,3,-5,-3,-4,2,-3,7,-10,-12,-6,11,5,-12,6,-7,5,-6,7,-1,1,0,4,-5,9,11,11,-13,4,7,4,12,2,-1,4,4,-4,-12,-2,7,-8,-5,-7,-10,4,11,9,12,0,-8,1,-13,-13,-2,-8,2,-3,-2,-2,3,-6,9,-4,-9,8,12,10,7,0,9,1,3,7,-5,11,-10,-13,-6,-11,0,10,7,12,1,-6,-3,-6,12,10,-9,12,-4,-13,8,-8,-12,-13,0,-8,-4,3,3,7,8,5,7,10,-7,-1,7,1,-12,3,-10,5,6,2,-4,3,-10,-13,0,-13,5,-13,-7,-12,12,-13,3,-11,8,-7,12,-4,7,6,-10,12,8,-9,-1,-7,-6,-2,-5,0,12,-12,5,-7,5,3,-10,8,-13,-7,-7,-4,5,-3,-2,-1,-7,2,9,5,-11,-11,-13,-5,-13,-1,6,0,-1,5,-3,5,2,-4,-13,-4,12,-9,-6,-9,6,-12,-10,-8,-4,10,2,12,-3,7,12,12,12,-7,-13,-6,5,-4,9,-3,4,7,-1,12,2,-7,6,-5,1,-13,11,-12,5,-3,7,-2,-6,7,-8,12,-7,-13,-7,-11,-12,1,-3,12,12,2,-6,3,0,-4,3,-2,-13,-1,-13,1,9,7,1,8,-6,1,-1,3,12,9,1,12,6,-1,-9,-1,3,-13,-13,-10,5,7,7,10,12,12,-5,12,9,6,3,7,11,5,-13,6,10,2,-12,2,3,3,8,4,-6,2,6,12,-13,9,-12,10,3,-8,4,-7,9,-11,12,-4,-6,1,12,2,-8,6,-9,7,-4,2,3,3,-2,6,3,11,0,3,-3,8,-8,7,8,9,3,-11,-5,-6,-4,-10,11,-5,10,-5,-8,-3,12,-10,5,-9,0,8,-1,12,-6,4,-6,6,-11,-10,12,-8,7,4,-2,6,7,-2,0,-2,12,-5,-8,-5,2,7,-6,10,12,-9,-13,-8,-8,-5,-13,-5,-2,8,-8,9,-13,-9,-11,-9,0,1,-8,1,-2,7,-4,9,1,-2,1,-1,-4,11,-6,12,-11,-12,-9,-6,4,3,7,7,12,5,5,10,8,0,-4,2,8,-9,12,-5,-13,0,7,2,12,-1,2,1,7,5,11,7,-9,3,5,6,-8,-13,-4,-8,9,-5,9,-3,-3,-4,-7,-3,-12,6,5,8,0,-7,6,-6,12,-13,6,-5,-2,1,-10,3,10,4,1,8,-4,-2,-2,2,-13,2,-12,12,12,-2,-13,0,-6,4,1,9,3,-6,-10,-3,-5,-3,-13,-1,1,7,5,12,-11,4,-2,5,-7,-13,9,-9,-5,7,1,8,6,7,-8,7,6,-7,-4,-7,1,-8,11,-7,-8,-13,6,-12,-8,2,4,3,9,10,-5,12,3,-6,-5,-6,7,8,-3,9,-8,2,-12,2,8,-11,-2,-10,3,-12,-13,-7,-9,-11,0,-10,-5,5,-3,11,8,-2,-13,-1,12,-1,-8,0,9,-13,-11,-12,-5,-10,-2,-10,11,-3,9,-2,-13,2,-3,3,2,-9,-13,-4,0,-4,6,-3,-10,-4,12,-2,-7,-6,-11,-4,9,6,-3,6,11,-13,11,-5,5,11,11,12,6,7,-5,12,-2,-1,12,0,7,-4,-8,-3,-2,-7,1,-6,7,-13,-12,-8,-13,-7,-2,-6,-8,-8,5,-6,-9,-5,-1,-4,5,-13,7,-8,10,1,5,5,-13,1,0,10,-13,9,12,10,-1,5,-8,10,-9,-1,11,1,-13,-9,-3,-6,2,-1,-10,1,12,-13,1,-8,-10,8,-11,10,-6,2,-13,3,-6,7,-13,12,-9,-10,-10,-5,-7,-10,-8,-8,-13,4,-6,8,5,3,12,8,-13,-4,2,-3,-3,5,-13,10,-12,4,-13,5,-1,-9,9,-4,3,0,3,3,-9,-12,1,-6,1,3,2,4,-8,-10,-10,-10,9,8,-13,12,12,-8,-12,-6,-5,2,2,3,7,10,6,11,-8,6,8,8,-12,-7,10,-6,5,-3,-9,-3,9,-1,-13,-1,5,-3,-7,-3,4,-8,-2,-8,3,4,2,12,12,2,-5,3,11,6,-9,11,-13,3,-1,7,12,11,-1,12,4,-3,0,-3,6,4,-11,4,12,2,-4,2,1,-10,-6,-8,1,-13,7,-11,1,-13,12,-11,-13,6,0,11,-13,0,-1,1,4,-13,3,-9,-2,-9,8,-6,-3,-13,-6,-8,-2,5,-9,8,10,2,7,3,-9,-1,-6,-1,-1,9,5,11,-2,11,-3,12,-8,3,0,3,5,-1,4,0,10,3,-6,4,5,-13,0,-10,5,5,8,12,11,8,9,9,-6,7,-4,8,-12,-10,4,-10,9,7,3,12,4,9,-7,10,-2,7,0,12,-2,-1,-6,0,-11]),e=new r.matrix_t(3,3,r.F32_t|r.C1_t),a=new r.matrix_t(32,32,r.U8_t|r.C1_t),i=function(t,a,i,n,f,o){var s=Math.cos(i),c=Math.sin(i);e.data[0]=s,e.data[1]=-c,e.data[2]=(-s+c)*o*.5+n,e.data[3]=c,e.data[4]=s,e.data[5]=(-c-s)*o*.5+f,r.imgproc.warp_affine(t,a,e,128)};return{describe:function(e,n,f,o){var s=0,c=0,u=0,h=0,d=0,l=0,_=0,v=0,p=(e.data,e.cols,e.rows,a.data),b=0;o.type&r.U8_t?o.resize(32,f,1):(o.type=r.U8_t,o.cols=32,o.rows=f,o.channel=1,o.allocate());var m=o.data,w=0;for(s=0;s<f;++s){for(u=n[s].x,h=n[s].y,d=n[s].angle,i(e,a,d,u,h,32),b=0,c=0;c<32;++c)v=(l=p[528+32*t[b+1]+t[b]])<(_=p[528+32*t[(b+=2)+1]+t[b]])|0,v|=((l=p[528+32*t[(b+=2)+1]+t[b]])<(_=p[528+32*t[(b+=2)+1]+t[b]]))<<1,v|=((l=p[528+32*t[(b+=2)+1]+t[b]])<(_=p[528+32*t[(b+=2)+1]+t[b]]))<<2,v|=((l=p[528+32*t[(b+=2)+1]+t[b]])<(_=p[528+32*t[(b+=2)+1]+t[b]]))<<3,v|=((l=p[528+32*t[(b+=2)+1]+t[b]])<(_=p[528+32*t[(b+=2)+1]+t[b]]))<<4,v|=((l=p[528+32*t[(b+=2)+1]+t[b]])<(_=p[528+32*t[(b+=2)+1]+t[b]]))<<5,v|=((l=p[528+32*t[(b+=2)+1]+t[b]])<(_=p[528+32*t[(b+=2)+1]+t[b]]))<<6,l=p[528+32*t[(b+=2)+1]+t[b]],_=p[528+32*t[(b+=2)+1]+t[b]],b+=2,v|=(l<_)<<7,m[w+c]=v;w+=32}}}}();t.orb=e}(r),function(t){"use strict";var e=function(){var t=r.imgproc.scharr_derivatives;return{track:function(e,a,i,n,f,o,s,c,u,h){void 0===s&&(s=30),void 0===c&&(c=new Uint8Array(f)),void 0===u&&(u=.01),void 0===h&&(h=1e-4);var d=.5*(o-1),l=o*o|0,_=l<<1,v=e.data,p=a.data,b=v[0].data,m=p[0].data,w=v[0].cols,y=v[0].rows,g=0,x=0,M=r.cache.get_buffer(l<<2),k=r.cache.get_buffer(_<<2),z=r.cache.get_buffer(y*(w<<1)<<2),C=new r.matrix_t(w,y,r.S32C2_t,z.data),O=M.i32,A=k.i32,R=z.i32,L=0,B=0,T=0,E=0,S=0,U=0,V=0,W=0,H=0,F=0,G=0,I=0,q=0,P=0,N=0,j=0,D=0,Y=0,Q=0,X=0,J=0,K=0,Z=0,$=0,tt=0,et=0,rt=0,at=0,it=0,nt=0,ft=0,ot=0,st=0,ct=0,ut=0,ht=0,dt=0,lt=0,_t=0,vt=0,pt=0,bt=0,mt=0;for(u*=u;X<f;++X)c[X]=1;var wt=e.levels-1|0;for($=wt;$>=0;--$)for(V=1/(1<<$),x=y>>$,L=(g=w>>$)<<1,b=v[$].data,m=p[$].data,rt=g-o|0,at=x-o|0,t(v[$],C),tt=0;tt<f;++tt)if(X=tt<<1,J=X+1,W=i[X]*V,H=i[J]*V,$==wt?(F=W,G=H):(F=2*n[X],G=2*n[J]),n[X]=F,n[J]=G,W-=d,H-=d,j=0|W,D=0|H,0==(K=j<=0|j>=rt|D<=0|D>=at)){for(ht=16384-(st=(1-(it=W-j))*(1-(nt=H-D))*16384+.5|0)-(ct=it*(1-nt)*16384+.5|0)-(ut=(1-it)*nt*16384+.5|0),vt=0,pt=0,bt=0,Z=0;Z<o;++Z)for(T=(B=(Z+D)*g+j|0)<<1,S=(E=Z*o|0)<<1,K=0;K<o;++K,++B,++E,T+=2)dt=(dt=b[B]*st+b[B+1]*ct+b[B+g]*ut+b[B+g+1]*ht)+256>>9,lt=(lt=R[T]*st+R[T+2]*ct+R[T+L]*ut+R[T+L+2]*ht)+8192>>14,_t=(_t=R[T+1]*st+R[T+3]*ct+R[T+L+1]*ut+R[T+L+3]*ht)+8192>>14,O[E]=dt,A[S++]=lt,A[S++]=_t,vt+=lt*lt,pt+=lt*_t,bt+=_t*_t;if(vt*=1/(1<<20),pt*=1/(1<<20),bt*=1/(1<<20),mt=vt*bt-pt*pt,(bt+vt-Math.sqrt((vt-bt)*(vt-bt)+4*pt*pt))/_<h||mt<1.1920929e-7)0==$&&(c[tt]=0);else for(mt=1/mt,F-=d,G-=d,I=0,q=0,et=0;et<s;++et){if(Y=0|F,Q=0|G,0!=(K=Y<=0|Y>=rt|Q<=0|Q>=at)){0==$&&(c[tt]=0);break}for(ht=16384-(st=(1-(it=F-Y))*(1-(nt=G-Q))*16384+.5|0)-(ct=it*(1-nt)*16384+.5|0)-(ut=(1-it)*nt*16384+.5|0),ft=0,ot=0,Z=0;Z<o;++Z)for(U=(Z+Q)*g+Y|0,S=(E=Z*o|0)<<1,K=0;K<o;++K,++U,++E)dt=(dt=m[U]*st+m[U+1]*ct+m[U+g]*ut+m[U+g+1]*ht)+256>>9,ft+=(dt-=O[E])*A[S++],ot+=dt*A[S++];if(ft*=1/(1<<20),ot*=1/(1<<20),P=(pt*ot-bt*ft)*mt,N=(pt*ft-vt*ot)*mt,F+=P,G+=N,n[X]=F+d,n[J]=G+d,P*P+N*N<=u)break;if(et>0&&Math.abs(P+I)<.01&&Math.abs(N+q)<.01){n[X]-=.5*P,n[J]-=.5*N;break}I=P,q=N}}else 0==$&&(c[tt]=0);r.cache.put_buffer(M),r.cache.put_buffer(k),r.cache.put_buffer(z)}}}();t.optical_flow_lk=e}(r),function(t){"use strict";var e=function(){var t=function(t,e){var r=.25*t.width+.5|0;return e.x<=t.x+r&&e.x>=t.x-r&&e.y<=t.y+r&&e.y>=t.y-r&&e.width<=1.5*t.width+.5|0&&1.5*e.width+.5|0>=t.width};return{edges_density:.07,detect_single_scale:function(t,e,r,a,i,n,f,o){var s,c,u,h,d,l,_,v,p,b,m,w,y,g,x,M,k,z,C,O,A,R,L,B,T,E=o.size[0]*f|0,S=o.size[1]*f|0,U=.5*f+1.5|0,V=U,W=i-E|0,H=n-S|0,F=i+1|0,G=1/(E*S),I=!0,q=0,P=E,N=S*F,j=N+E,D=E*S*255*this.edges_density|0,Y=[];for(d=0;d<H;d+=V)for(q=d*F,h=0;h<W;h+=U,q+=U)if(l=t[q]-t[q+P]-t[q+N]+t[q+j],a&&(a[q]-a[q+P]-a[q+N]+a[q+j]<D||l<20))h+=U,q+=U;else{for(l*=G,v=(_=(e[q]-e[q+P]-e[q+N]+e[q+j])*G-l*l)>0?Math.sqrt(_):1,y=(p=o.complexClassifiers).length,I=!0,s=0;s<y;++s){for(M=(b=p[s]).threshold,g=(m=b.simpleClassifiers).length,k=0,c=0;c<g;++c){if(w=m[c],z=0,O=w.features,x=O.length,1===w.tilted)for(u=0;u<x;++u)A=~~(h+(C=O[u])[0]*f)+~~(d+C[1]*f)*F,R=(B=~~(C[2]*f))*F,L=(T=~~(C[3]*f))*F,z+=(r[A]-r[A+B+R]-r[A-T+L]+r[A+B-T+R+L])*C[4];else for(u=0;u<x;++u)A=~~(h+(C=O[u])[0]*f)+~~(d+C[1]*f)*F,B=~~(C[2]*f),L=(T=~~(C[3]*f))*F,z+=(t[A]-t[A+B]-t[A+L]+t[A+L+B])*C[4];k+=z*G<w.threshold*v?w.left_val:w.right_val}if(k<M){I=!1;break}}I&&(Y.push({x:h,y:d,width:E,height:S,neighbor:1,confidence:k}),h+=U,q+=U)}return Y},detect_multi_scale:function(t,e,r,a,i,n,f,o,s){void 0===o&&(o=1.2),void 0===s&&(s=1);for(var c=f.size[0],u=f.size[1],h=[];s*c<i&&s*u<n;)h=h.concat(this.detect_single_scale(t,e,r,a,i,n,s,f)),s*=o;return h},group_rectangles:function(e,r){void 0===r&&(r=1);var a,i,n=e.length,f=[];for(a=0;a<n;++a)f[a]={parent:-1,element:e[a],rank:0};for(a=0;a<n;++a)if(f[a].element){for(var o=a;-1!=f[o].parent;)o=f[o].parent;for(i=0;i<n;++i)if(a!=i&&f[i].element&&t(f[a].element,f[i].element)){for(var s=i;-1!=f[s].parent;)s=f[s].parent;if(s!=o){f[o].rank>f[s].rank?f[s].parent=o:(f[o].parent=s,f[o].rank==f[s].rank&&f[s].rank++,o=s);for(var c,u=i;-1!=f[u].parent;)c=u,u=f[u].parent,f[c].parent=o;for(u=a;-1!=f[u].parent;)c=u,u=f[u].parent,f[c].parent=o}}}var h=[],d=0;for(a=0;a<n;a++){i=-1;var l=a;if(f[l].element){for(;-1!=f[l].parent;)l=f[l].parent;f[l].rank>=0&&(f[l].rank=~d++),i=~f[l].rank}h[a]=i}var _=[];for(a=0;a<d+1;++a)_[a]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(a=0;a<n;++a){var v=e[a],p=h[a];0==_[p].neighbors&&(_[p].confidence=v.confidence),++_[p].neighbors,_[p].x+=v.x,_[p].y+=v.y,_[p].width+=v.width,_[p].height+=v.height,_[p].confidence=Math.max(_[p].confidence,v.confidence)}var b=[];for(a=0;a<d;++a)(n=_[a].neighbors)>=r&&b.push({x:(2*_[a].x+n)/(2*n),y:(2*_[a].y+n)/(2*n),width:(2*_[a].width+n)/(2*n),height:(2*_[a].height+n)/(2*n),neighbors:_[a].neighbors,confidence:_[a].confidence});var m=[];for(n=b.length,a=0;a<n;++a){var v=b[a],w=!0;for(i=0;i<n;++i){var y=b[i],g=.25*y.width+.5|0;if(a!=i&&v.x>=y.x-g&&v.y>=y.y-g&&v.x+v.width<=y.x+y.width+g&&v.y+v.height<=y.y+y.height+g&&(y.neighbors>Math.max(3,v.neighbors)||v.neighbors<3)){w=!1;break}}w&&m.push(v)}return m}}}();t.haar=e}(r),function(t){"use strict";var e=function(){var t=function(t,e){var r=.25*t.width+.5|0;return e.x<=t.x+r&&e.x>=t.x-r&&e.y<=t.y+r&&e.y>=t.y-r&&e.width<=1.5*t.width+.5|0&&1.5*e.width+.5|0>=t.width},e=new r.pyramid_t(1);return{interval:4,scale:1.1486,next:5,scale_to:1,prepare_cascade:function(t){for(var e=t.stage_classifier.length,r=0;r<e;r++)for(var a=t.stage_classifier[r].feature,i=t.stage_classifier[r].count,n=t.stage_classifier[r]._feature=new Array(i),f=0;f<i;f++)n[f]={size:a[f].size,px:new Array(a[f].size),pz:new Array(a[f].size),nx:new Array(a[f].size),nz:new Array(a[f].size)}},build_pyramid:function(t,a,i,n){void 0===n&&(n=4);var f=t.cols,o=t.rows,s=0,c=0,u=0,h=!1,d=t,l=t,_=r.U8_t|r.C1_t;this.interval=n,this.scale=Math.pow(2,1/(this.interval+1)),this.next=this.interval+1|0,this.scale_to=Math.log(Math.min(f/a,o/i))/Math.log(this.scale)|0;var v=4*(this.scale_to+2*this.next)|0;for(e.levels!=v&&(e.levels=v,e.data=new Array(v),h=!0,e.data[0]=t),s=1;s<=this.interval;++s)c=f/Math.pow(this.scale,s)|0,u=o/Math.pow(this.scale,s)|0,d=e.data[s<<2],(h||c!=d.cols||u!=d.rows)&&(e.data[s<<2]=new r.matrix_t(c,u,_),d=e.data[s<<2]),r.imgproc.resample(t,d,c,u);for(s=this.next;s<this.scale_to+2*this.next;++s)l=e.data[(s<<2)-(this.next<<2)],d=e.data[s<<2],c=l.cols>>1,u=l.rows>>1,(h||c!=d.cols||u!=d.rows)&&(e.data[s<<2]=new r.matrix_t(c,u,_),d=e.data[s<<2]),r.imgproc.pyrdown(l,d);for(s=2*this.next;s<this.scale_to+2*this.next;++s)c=(l=e.data[(s<<2)-(this.next<<2)]).cols>>1,u=l.rows>>1,d=e.data[1+(s<<2)],(h||c!=d.cols||u!=d.rows)&&(e.data[1+(s<<2)]=new r.matrix_t(c,u,_),d=e.data[1+(s<<2)]),r.imgproc.pyrdown(l,d,1,0),d=e.data[2+(s<<2)],(h||c!=d.cols||u!=d.rows)&&(e.data[2+(s<<2)]=new r.matrix_t(c,u,_),d=e.data[2+(s<<2)]),r.imgproc.pyrdown(l,d,0,1),d=e.data[3+(s<<2)],(h||c!=d.cols||u!=d.rows)&&(e.data[3+(s<<2)]=new r.matrix_t(c,u,_),d=e.data[3+(s<<2)]),r.imgproc.pyrdown(l,d,1,1);return e},detect:function(t,e){this.interval;var r,a,i,n,f,o=this.scale,s=this.next,c=this.scale_to,u=0,h=0,d=0,l=0,_=0,v=0,p=0,b=0,m=0,w=0,y=0,g=0,x=0,M=0,k=0,z=0,C=0,O=0,A=!0,R=!0,L=1,B=1,T=[0,1,0,1],E=[0,0,1,1],S=[],U=t.data,V=[],W=[0,0,0],H=[0,0,0],F=[0,0,0];for(u=0;u<c;u++){for(z=U[(k=u<<2)+(s<<3)].cols-(e.width>>2),C=U[k+(s<<3)].rows-(e.height>>2),H[0]=1*U[k].cols,H[1]=1*U[k+(s<<2)].cols,H[2]=1*U[k+(s<<3)].cols,F[0]=4*U[k].cols-4*z,F[1]=2*U[k+(s<<2)].cols-2*z,F[2]=1*U[k+(s<<3)].cols-1*z,b=e.stage_classifier.length,h=0;h<b;h++)for(i=e.stage_classifier[h].feature,a=e.stage_classifier[h]._feature,m=e.stage_classifier[h].count,d=0;d<m;d++)for(n=a[d],w=0|(f=i[d]).size,p=0;p<w;p++)n.px[p]=1*f.px[p]+f.py[p]*H[f.pz[p]],n.pz[p]=f.pz[p],n.nx[p]=1*f.nx[p]+f.ny[p]*H[f.nz[p]],n.nz[p]=f.nz[p];for(V[0]=U[k].data,V[1]=U[k+(s<<2)].data,p=0;p<4;p++)for(V[2]=U[k+(s<<3)+p].data,W[0]=2*T[p]+E[p]*(2*U[k].cols),W[1]=1*T[p]+E[p]*(1*U[k+(s<<2)].cols),W[2]=0,v=0;v<C;v++){for(_=0;_<z;_++){for(O=0,A=!0,b=e.stage_classifier.length,h=0;h<b;h++){for(O=0,r=e.stage_classifier[h].alpha,a=e.stage_classifier[h]._feature,m=e.stage_classifier[h].count,d=0;d<m;d++)if(n=a[d],g=V[n.pz[0]][W[n.pz[0]]+n.px[0]],x=V[n.nz[0]][W[n.nz[0]]+n.nx[0]],g<=x)O+=r[d<<1];else{for(R=!0,w=n.size,M=1;M<w;M++){if(n.pz[M]>=0&&(y=V[n.pz[M]][W[n.pz[M]]+n.px[M]])<g){if(y<=x){R=!1;break}g=y}if(n.nz[M]>=0&&(l=V[n.nz[M]][W[n.nz[M]]+n.nx[M]])>x){if(g<=l){R=!1;break}x=l}}O+=R?r[1+(d<<1)]:r[d<<1]}if(O<e.stage_classifier[h].threshold){A=!1;break}}A&&(S.push({x:(4*_+2*T[p])*L,y:(4*v+2*E[p])*B,width:e.width*L,height:e.height*B,neighbor:1,confidence:O}),++_,W[0]+=4,W[1]+=2,W[2]+=1),W[0]+=4,W[1]+=2,W[2]+=1}W[0]+=F[0],W[1]+=F[1],W[2]+=F[2]}L*=o,B*=o}return S},group_rectangles:function(e,r){void 0===r&&(r=1);var a,i,n=e.length,f=[];for(a=0;a<n;++a)f[a]={parent:-1,element:e[a],rank:0};for(a=0;a<n;++a)if(f[a].element){for(var o=a;-1!=f[o].parent;)o=f[o].parent;for(i=0;i<n;++i)if(a!=i&&f[i].element&&t(f[a].element,f[i].element)){for(var s=i;-1!=f[s].parent;)s=f[s].parent;if(s!=o){f[o].rank>f[s].rank?f[s].parent=o:(f[o].parent=s,f[o].rank==f[s].rank&&f[s].rank++,o=s);for(var c,u=i;-1!=f[u].parent;)c=u,u=f[u].parent,f[c].parent=o;for(u=a;-1!=f[u].parent;)c=u,u=f[u].parent,f[c].parent=o}}}var h=[],d=0;for(a=0;a<n;a++){i=-1;var l=a;if(f[l].element){for(;-1!=f[l].parent;)l=f[l].parent;f[l].rank>=0&&(f[l].rank=~d++),i=~f[l].rank}h[a]=i}var _=[];for(a=0;a<d+1;++a)_[a]={neighbors:0,x:0,y:0,width:0,height:0,confidence:0};for(a=0;a<n;++a){var v=e[a],p=h[a];0==_[p].neighbors&&(_[p].confidence=v.confidence),++_[p].neighbors,_[p].x+=v.x,_[p].y+=v.y,_[p].width+=v.width,_[p].height+=v.height,_[p].confidence=Math.max(_[p].confidence,v.confidence)}var b=[];for(a=0;a<d;++a)(n=_[a].neighbors)>=r&&b.push({x:(2*_[a].x+n)/(2*n),y:(2*_[a].y+n)/(2*n),width:(2*_[a].width+n)/(2*n),height:(2*_[a].height+n)/(2*n),neighbors:_[a].neighbors,confidence:_[a].confidence});var m=[];for(n=b.length,a=0;a<n;++a){var v=b[a],w=!0;for(i=0;i<n;++i){var y=b[i],g=.25*y.width+.5|0;if(a!=i&&v.x>=y.x-g&&v.y>=y.y-g&&v.x+v.width<=y.x+y.width+g&&v.y+v.height<=y.y+y.height+g&&(y.neighbors>Math.max(3,v.neighbors)||v.neighbors<3)){w=!1;break}}w&&m.push(v)}return m}}}();t.bbf=e}(r),function(e){"use strict";void 0===t||void 0===t.exports?window.jsfeat=e:t.exports=e}(r)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),i=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.arView=e,this.init()}return a(t,[{key:"init",value:function(){this.debugWindow=document.createElement("div"),this.debugWindow.id="debug-window",this.debugWindow.style.position="fixed",this.debugWindow.style.bottom="0px",this.debugWindow.style.left="0px",this.debugWindow.style.color="white",this.debugWindow.style.backgroundColor="transparent",this.debugWindow.style.whiteSpace="pre",this.debugWindow.style.padding="10px",document.body.append(this.debugWindow)}},{key:"update",value:function(){null!==this.arView.cameraOrientation&&null!==this.arView.cameraMotion&&(this.debugWindow.innerHTML="alpha: "+this.arView.cameraOrientation.alpha+"\n",this.debugWindow.innerHTML+="beta: "+this.arView.cameraOrientation.beta+"\n",this.debugWindow.innerHTML+="gamma: "+this.arView.cameraOrientation.gamma+"\n",this.debugWindow.innerHTML+="acceleration.x: "+this.arView.cameraMotion.acceleration.x+"\n",this.debugWindow.innerHTML+="acceleration.y: "+this.arView.cameraMotion.acceleration.y+"\n",this.debugWindow.innerHTML+="acceleration.z: "+this.arView.cameraMotion.acceleration.z+"\n",this.debugWindow.innerHTML+="camera.rotation.x: "+this.arView.sceneCamera.rotation.x+"\n",this.debugWindow.innerHTML+="camera.rotation.y: "+this.arView.sceneCamera.rotation.y+"\n",this.debugWindow.innerHTML+="camera.rotation.z: "+this.arView.sceneCamera.rotation.z+"\n",this.debugWindow.innerHTML+="camera.position.x: "+this.arView.sceneCamera.position.x+"\n",this.debugWindow.innerHTML+="camera.position.y: "+this.arView.sceneCamera.position.y+"\n",this.debugWindow.innerHTML+="camera.position.z: "+this.arView.sceneCamera.position.z+"\n")}}]),t}();e.default=i}])});